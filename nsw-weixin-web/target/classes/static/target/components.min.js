!function(){"use strict";var e;e="undefined"==typeof exports?window:module.exports;var t="http://localhost/wx/";if(e.location){var n=window.location.pathname.split("/"),i="";n.length=n.length-2,window.location.port&&(i=window.location.port),t=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+n.join("/")+"/"}e.globals={basAppRoot:t,basAppRoute:t+"app/",basFilePath:"http://192.168.4.160:8080/",basImagePath:"http://od28wfrv7.bkt.clouddn.com/",basImageDomain:"od28wfrv7.bkt.clouddn.com",cmsImagePath:"http://obdt9tuqa.bkt.clouddn.com/",defaultImg:t+"app/components/content/images/nsw.png",imageUrl:"material/image/upload?appId=@appId",menuSrc:"user/menu",debug:!0,spaMode:!0},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e}}(),function(e){"use strict";e.module("app",["platform","account","menu","materials","autoReply","member","massMessage","message","qrCode","messageTemplate","log","course","coursereg"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("","/wechat"),e.state("wechat",{url:"/wechat",templateProvider:["$http","$q","platformModalSvc","platformNswAuthSvc","$location","$sessionStorage",function(e,t,n,i,a,o){var r=a.$$search.projId||(o.selectedProject||{}).id;if(r){var s=t.defer(),l=n.showLoadingTip("页面加载中...."),c=i.loadAuthData();return e.get(globals.basAppRoute+"main/partials/main-view.html").then(function(e){s.resolve(e.data)}),t.all(c,s.promise).then(function(){l.close()}),s.promise}}]}).state("switchProject",{url:"/switchProject",controller:"switchProjectCtrl",templateUrl:globals.basAppRoute+"main/partials/switch-project-view.html"})}]);var t=$(".c-header").outerHeight(),n=$(window).outerHeight(),i=$(".c-footer").outerHeight();$(".c-container,.c-menu-container").css("minHeight",n-t-i+"px")}(angular),function(e){"use strict";e.module("app").factory("mainMenuSvc",["$http","$sessionStorage","platformMenuDataSvc","basDataSvc","accountDataSvc","$location",function(e,t,n,i,a,o){var r,s={requireAppId:!1,list:{enableSearch:!0,listUri:"user/loginUser",selectionMode:"single"}},l=i.createInstance(s);l.setLoginProject=function(n){t.selectedProject=r=n,e.defaults.headers.common.projectId=l.getProjectId()},l.setProjectId=function(t){e.defaults.headers.common.projectId=t};var c=o.$$search.projId||(t.selectedProject||{}).id;c&&l.setProjectId(c);var u={groups:[]};return l.setMenus=function(e){u=e},l.buildNavigation=function(e,t){var n=[],i=u.groups[0];if(i)return i.state!==e.state?e!==t?(n.push(i),n.push(t),n.push(e)):(n.push(i),n.push(t)):n.push(i),n},l.loadData(),n.registerMenuLoaded(function(e){l.setMenus(e)}),l.getProject=function(){return r||{}},l.getProjectId=function(){var e=l.getProject();return e.id},l}])}(angular),function(e){"use strict";e.module("app").factory("switchProjectSvc",["$http","$q",function(e,t){var n={},i={isMuilt:!1,message:""};return n.isMuiltEnterprise=function(){return i.isMuilt},n.getMuiltEnterprise=function(){return i},n.getProjects=function(){var t=globals.basAppRoot+"cms/getProjects";return e.get(t).then(function(e){return e.data.isSuccess?e.data.data:[]},function(e){console.error(e)})},n}])}(angular),function(e){"use strict";e.module("app").factory("wechatSvc",[function(){}])}(angular),function(e){"use strict";e.module("app").controller("switchProjectCtrl",["$scope","switchProjectSvc",function(e,t){e.hideMenu(),e.$parent.enableSwitchProject=!1,e.breadNavs=[{state:"wechat.switchProject",name:"我的服务"}];var n=function(){e.hideMenu()};e.getIconClass=function(e){switch(e.projectType){case 4:return"pc";case 5:return"phone";case 9:return"responsive";case 7:return"wechat"}},e.selectProject=function(e){window.open(e.weixinUrl)},e.$on("$destroy",function(){e.showMenu()}),n()}])}(angular),function(e){"use strict";e.module("app").controller("wechatCtrl",["$scope","$state","$location","$sessionStorage","mainMenuSvc","platformNavigationSvc","platformMenuDataSvc","nswGlobals","basListCtrlSvc","accountDataSvc","platformNswAuthSvc","switchProjectSvc",function(e,t,n,i,a,o,r,s,l,c,u,d){l.createInstance(e,a),e.isWelcome=!0,e.leftEdit=!1,e.showMenus=!0,e.enableSwitchProject=!0;var p=function(t){e.currentWechtInfo=t};e.goMaterials=function(){t.go("wechat.materialsAdd")};var m=function(t){t&&t.groups.length&&(e.menuOptions=t,a.setMenus(t),e.breadNavs=a.buildNavigation(r.getCurrentMenu(),r.getCurrentMenuGroup()))};r.registerMenuLoaded(m),o.registerRouteUpdated(function(t){e.isWelcome="welcome"===t.key});var f=function(e){var t,n,i;return e.length&&_.forEach(e,function(e){_.forEach(e.portfolios,function(e){if(e.info="",e.projects.length>1)e.info+="pc+手机";else switch(i=e.projects[0].websiteType){case"4":case"9":e.info+="pc";break;case"5":case"10":e.info+="手机"}switch(t=e.projects[0].projectType,n=e.projects[0].language,t){case"KXWEBSITE":e.info+="快效网站";break;case"WXGJ":e.info+="微信管家";break;case"STANDARDWEBSITE":e.info+="标准网站"}})}),e};d.getProjects().then(function(t){if(t){e.enterprises=f(t)||[];var o=[];_.map(t,function(e){var t=_.map(e.portfolios,function(e){_.each(e.projects,function(e){o.push(e)})});return t}),e.projects=o;var r=n.$$search.projId?{id:n.$$search.projId}:i.selectedProject;r&&r.id?a.setLoginProject(r):e.switchProject()}}),e.goToWechat=function(n){i.selectedProject=n,a.setLoginProject(n),t.go("wechat.account"),e.showMenu()},e.exit=function(t){s.setValue("accountId",null,!0),s.setValue("appId",null,!0),s.setValue("platform_menus_selectedMenu",null,!0),s.setValue("platform_menus_selectedMenuGroup",null,!0),i.selectedProject={},n.$$search.projId=null,e.$broadcast("app.exit"),window.location=t},e.$on("$stateChangeStart",function(t,n){e.isWelcome="wechat.account"===n.name||"wechat.authorizeMain.explain"===n.name||"wechat.authorizeMain.mode"===n.name||"wechat.authorizeMain.success"===n.name||"wechat.authorizeUrl"===n.name||"wechat.authorizeAbout"===n.name,e.leftEdit=!("wechat.accountAdd"===n.name||"wechat.accountEdit"===n.name)}),e.$on("$stateChangeSuccess",function(e,t){r.selectMenu(t.name,!1)}),e.editAccount=function(){r.selectMenu("公众号管理"),e.leftEdit=!0},e.hideMenu=function(){e.showMenus=!1},e.showMenu=function(){e.showMenus=!0},e.switchProject=function(){e.goState("switchProject")},e.checkAuthed=function(e){return u.getAuth(e)};var g=function(t,n){c.setEidtHistory(t.name),e.breadNavs=a.buildNavigation(t,n),e.currentGroup=n};c.registerCurrentItemChanged(function(e){p(e)}),r.registerMenuSelected(g),e.$on("$destroy",function(){o.unregisterMenuSelected(g),c.unregisterCurrentItemChanged()})}])}(angular),function(e){"use strict";e.module("platform",["ng","ui.router","ui.bootstrap","ngStorage","ngTable","pascalprecht.translate"]).config(["$translateProvider",function(e){e.useStaticFilesLoader({files:[{prefix:globals.basAppRoute+"components/content/json/validation-",suffix:".json"}]}),e.preferredLanguage("zh")}])}(angular),function(e){"use strict";e.module("platform").factory("platformDateSvc",[function(){var e={};return e.dateRange=function(e){var t={start:(new Date).valueOf(),range:7},n=$.extend({},t,e);return new Date(n.start-864e5*n.range).format("yyyy-MM-dd")},e.stringToDate=function(e){var t=e.split(" ")[0],n=e.split(" ")[1],i=t.split("-")[0],a=t.split("-")[1],o=t.split("-")[2],r=n.split(":")[0],s=n.split(":")[1],l=n.split(":")[2],c=Number(i)||2017,u=Number(a)||1,d=Number(o)||1,p=Number(r)||0,m=Number(s)||0,f=Number(l)||0;return new Date(c,u-1,d,p,m,f)},e.formateDate=function(e,t){return moment(e).format(t)},e}])}(angular),function(e){"use strict";e.module("platform").service("platformDomainSvc"[function(){var e={fastEdit:{},text:{},url:{regexp:"(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&*+?:_/=<>]*)?"},email:{},qq:{},mobile:{},skype:{},title:{},shortTitle:{},status:{},check:{},radio:{},money:{},number:{},date:{},datetime:{},year:{}};return function(){this.domainTypes=e}}])}(angular),function(e){"use strict";e.module("platform").service("platformFormDomainSvc",[function(){var e={},t={text:{template:"input",type:"text",size:5},textarea:{template:"textarea",rows:3,size:5},htmleditor:{template:"htmleditor",isSimple:!0,size:5},select:{template:"select",key:"id",display:"name",size:5},name:{template:"input",type:"text",maxLength:32,required:!0,size:5},description:{template:"input",maxLength:32,type:"text",required:!0,size:5},email:{template:"input",type:"email",size:5,validates:[{type:"email",message:"请填写正确的邮件地址!"}]},url:{template:"input",type:"url",size:5,validates:[{type:"url",message:"请填写正确的链接地址(http://)!"}]},radio:{template:"radio",key:"id",display:"name",size:5},checkbox:{template:"checkbox",key:"id",display:"name",size:5},singleimage:{template:"singleimage",key:"id",display:"name",size:5},adlib:{template:"adlib",key:"id",display:"name",size:5}};return e.getDomainConfig=function(e){return t[e]},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformHttpInterceptor",["$injector","$location",function(e,t){var n=function(){var t=e.get("platformModalSvc");t.showErrorMessage("登陆超时","温馨提示").then(function(){window.location="/wx/j_spring_cas_security_logout"})},i={request:function(e){return e},response:function(e){return e.data.isSuccess===!1&&401===e.data.state&&n(),"string"==typeof e.data&&e.data.indexOf instanceof Function&&e.data.indexOf('<div id="login_wrap" style="height: 775px;">')!==-1&&n(),e},requestError:function(e){return e},responseError:function(e){return 401===e.status&&n(),e}};return i}])}(angular),function(e){"use strict";e.module("platform").factory("platformImgUploaderSvc",["$rootScope","platformUploaderSvc","platformModalSvc","platformMessenger",function(e,t,n,i){var a={},o={filters:{max_file_size:"2mb",nsw_prevent_duplicates:!0,mime_types:[{title:"图片文件",extensions:"jpg,gif,jpeg,bmp,png"}]},uploadCompleted:new i},r=function(e){return(e||"").replace(/(^[^.]+).\s{2,4}/,"$1")},s=function(e,t){switch(console.error(t.message),t.code){case-600:n.showWarmingMessage("图片大小不能超过2MB！","提示");break;default:n.showWarmingMessage(t.message,"提示")}},l=function(t){return function(n,i){_.forEach(i,function(e){return e.fileName=r(e.name),e});var a=_.filter(i,{status:plupload.DONE}),o=_.map(a,function(e){({uploadId:e.id,name:r(e.name),url:"http://"+globals.basImageDomain+"/"+e.target_name})});t.uploadCompleted.fire(o),e.$apply()}};return a.createUploader=function(e){var n={};_.extend(n,o,e);var i=t.createUploader(n);return i.bind("Error",s).bind("UploadComplete",l(n)),i},a}])}(angular),function(e){"use strict";e.module("platform").factory("platformJsBeautiferSvc",[function(){function t(e){var n="",i="",a="",o=!1;do o=!1,/^\s*\/\*/.test(e)?(o=!0,i=e.substr(0,e.indexOf("*/")+2),e=e.substr(i.length).replace(/^\s+/,""),n+=i+"\n"):/^\s*\/\//.test(e)&&(o=!0,i=e.match(/^\s*\/\/.*/)[0],e=e.substr(i.length).replace(/^\s+/,""),n+=i+"\n");while(o);for(var r=[P_A_C_K_E_R,Urlencoded,MyObfuscate],s=0;s<r.length;s++)r[s].detect(e)&&(a=r[s].unpack(e),a!==e&&(e=t(a)));return n+e}function n(e){var t=e.replace(/^[ \t\n\r]+/,""),n="<!--";return t&&"<"===t.substring(0,1)&&t.substring(0,4)!==n}var i={},a={};i.setOptions=function(t){e.extend(a,t)};var o={use_codemirror:!window.location.href.match(/without-codemirror/),beautify_in_progress:!1,editor:null},r=function(e){if(!o.beautify_in_progress){o.beautify_in_progress=!0;var i,a={};return n(e)?i=html_beautify(e,a):($("#detect-packers").prop("checked")&&(e=t(e)),i=js_beautify(e,a)),i=i.replace(/\s*\}\s*\]\s*\]/g,"}]]").replace(/\[\s*\[\s*\$\s*\{\s*/g,"[[${"),o.beautify_in_progress=!1,i}};return i.beautify=function(t,n){return e.extend(a,n),r(t)},i}])}(angular),function(e){"use strict";e.module("platform").factory("platformKindEditorDataSvc",["nswmultiimagePluginSvc","spechartsPluginSvc","selectmodularPluginSvc","nswPreviewPluginSvc","reformatPluginSvc","nswPreviewPhonePluginSvc","nswimagePluginSvc",function(e,t,n,i,a,o,r){var s={},l=0;return s.wcItems=["source","emoticons","undo","redo","plainpaste","wordpaste","clearhtml","reformat","selectall","fullscreen","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","hr","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","nswimage","link","unlink"],s.simpleItems=["source","|","undo","redo","|","bold","italic","underline","|","forecolor","hilitecolor","fontname","fontsize","|","justifyleft","justifycenter","justifyright","justifyfull","link","fullscreen","|","clearhtml","reformat"],s.complexItems=["source","|","selectmodular","|","undo","redo","|","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","subscript","superscript","clearhtml","reformat","selectall","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","nswmultiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","spechars","|","nswpreview","nswpreviewphone"],s.htmlTags={font:["color","size","face",".background-color","class"],span:["style","class","id","onclick"],div:["class","align","style","id","data-src","fn"],table:["class","border","cellspacing","cellpadding","width","height","align","style","align","bgcolor","id","frame","rules","summary"],"td,th":["class","align","valign","width","height","colspan","rowspan","bgcolor","style","id"],a:["class","href","target","name","style","title","id","onclick"],"img,section":["src","width","height","id","border","alt","title","align","style","class","templocation","sid","columns","cssname","orderby","sqlwhere","columnname","columnnameurl","selectcount","controltype","datatype","controid","cwidth","cheight","oid","/","onclick"],hr:["class","/"],br:["/"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["align","style","class","id","onclick"],"strong,b,sub,sup,em,i,u,strike,tr":["style","class","id"],dl:["class","style","id"],dt:["class","style","id"],dd:["class","style","id"],ul:["class","style","id","data-src","fn"],li:["class","style","id"],iframe:["src","width","height","style","frameborder","data-ke-src","class"],style:["type","oid"],script:["src","type","oid"],object:["codebase","classid","width","height"],param:["name","value"],embed:["src","allowfullscreen","loop","style","autostart","flashvars","quality","pluginspage","type","width","height","wmode","align","allowscriptaccess"]},s.colorTable=[["#000000","#E56600","#64451D","#DFC5A4","#FFE500","#009900","#006600","#99BB00"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE","#666666","#6666ff"],["#E53333","#993300","#333300","#003300","#003366","#000080","#333399","#333333"],["#800000","#FF6600","#808000","#008080","#0000FF","#666699","#CCFFFF","#CCFFCC"],["#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#99CCFF"],["#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#CC99FF"],["#FF99CC","#FFCC99","#FFFF99","#808080","#999999","#C0C0C0","#CCCCCC","#FFFFFF"]],s.layout='<div class="container">       <div class="other container_top dn"></div>       <div class="tab container_top dn"></div>       <div class="reversals dn"></div>       <div class="toolbar"></div>       <div class="edit"></div>       <div class="position container_bottom"></div>       <div class="btns container_bottom dn"></div>       <div class="statusbar"></div>   </div>',s.getUUID=function(){return String((new Date).getTime())+l++},e.init(),t.init(),n.init(),i.init(),a.init(),o.init(),r.init(),s}])}(angular),function(e){"use strict";e.module("platform").factory("platformMessenger",[function(){return function(){var t=this||{},n=[];t.register=function(e){n.push(e)},t.unregister=function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)},t.fire=function(){var t=arguments;e.forEach(n,function(e){e.apply(this,t)})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("mobilePreviewSvc",[function(){var e={};return e.mobilePreview=function(e,t,n){t=t||"view",n=!!_.isUndefined(n)||n,window.open(globals.basAppRoot+"js/template/index.html#/template-setting?pageid="+e+"&state="+t+"&isPubTpl="+n)},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformModalSvc",["$modal","$rootScope","$q",function(t,n,i){var a={},o={animation:!0,backdrop:"static",keyboard:!1},r=function(e){var t=n.$new(!0);return e&&(t.modalOptions=e.options,t.userTemplate=e.userTemplate),t},s=function(e){var n=i.defer();e.scope=r(e),e.scope.closeModal=function(e,t){e?n.resolve(t):n.reject(t),_.isFunction(this.$close)&&this.$close(e)};var a=t.open(e),o=($('[ng-controller="desktopMainCtrl"]')[0]||$(window)[0]).clientHeight>$(window).height(),s=$("html").css("padding-right");return a.result.then(function(){o&&!e.isTip&&($("html").css("padding-right",s),$("html").css("overflow-y","auto"))},function(){o&&!e.isTip&&($("html").css("padding-right",s),$("html").css("overflow-y","auto"))}),o&&!e.isTip&&($("html").css("overflow-y","hidden"),$("html").css("padding-right","17px")),setTimeout(function(){o&&$(".nsw.modal").css("padding-right","17px"),e.isTip||e.disableDrag||$(".modal-dialog").draggable({cancel:".modal-body,.modal-footer"})},100),n.promise},l=function(t){e.forEach(o,function(e){t.hasOwnProperty(e)||(t[e]=o[e])}),t.title=t.title||"标题栏",t.size=t.size||"md";var n;"sm"===t.size?n=496:"md"===t.size?n=600:"xs"===t.size&&(n=300)},c=function(e){return e?'<div class="wrapInfo">'+e+"</div>":""},u=function(e){return e?'<div class="wrapMessage">'+e+"</div>":""};a.showErrorMessage=function(e,t,n){var i={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(n),commitIcon:"checkforward",cancelIcon:"",commitText:"确 定",cancelText:"",type:"error"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return a.showModal(i)},a.showWarmingMessage=function(e,t,n){var i={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(n),commitIcon:"checkforward",commitText:"确 定",type:"warming"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return a.showModal(i)},a.showConfirmMessage=function(e,t,n){var i={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(n),commitIcon:"checkforward",cancelIcon:"checkcance",commitText:"确 定",cancelText:"取 消",type:"confirm"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return a.showModal(i)},a.showSuccessMessage=function(e,t,n){var i={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(n),commitIcon:"checkforward",cancelIcon:"checkcance",commitText:"确 定",type:"success"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return a.showModal(i)},a.showWarmingTip=function(e){var t={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:e,type:"warming"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-tip.html"};return a.show(t)},a.showSuccessTip=function(e){var t={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:e,type:"success"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-tip.html"};return a.show(t)};var d=0,p=!1,m={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:"正在加载中",type:"loading"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-loading-tip.html"};return a.showLoadingTip=function(e){d++;var t={};return m.options.message=e,p||(t.promise=a.show(m),p=!0),t.close=function(e){e&&e["finally"]?e.then(t.close,t.close):(d--,d=d<0?0:d,setTimeout(function(){m&&!d&&p&&m.options.closeModal&&(m.options.closeModal(),p=!1)},100))},setTimeout(function(){t.close()},15e3),t},a.showModal=function(e){return l(e),e.backdrop="static",s(e)},a.show=function(e){return l(e),e.backdrop=!1,s(e)},a}]),e.module("template/modal/window.html",[]).run(["$templateCache",function(e){e.put("template/modal/window.html",'<div tabindex="-1" role="dialog" class="nsw modal fade " ng-class="{in: animate}" style="display: block;\tposition: fixed" ng-style="{\'z-index\': 811214 + index*10, display: \'block\'}">\n'+"    <div class=\"nsw modal-dialog nsw-modal-dialog\" ng-class=\"{'nsw-modal-sm': size == 'sm', 'nsw-modal-md': size == 'md','nsw-modal-lg': size == 'lg','nsw-modal-sg': size == 'sg','nsw-modal-xs': size == 'xs'}\">       <div class=\"modal-content {{modalOptions.modalClass}}\" modal-transclude></div>   </div>\n</div>"),e.put("template/modal/backdrop.html",'<div style="display: block;width: 100%; position: absolute;left: 0px;top: 0px;" class="modal-backdrop  fade {{ backdropClass }}"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 811213 + (index && 1 || 0) + index*10}"\n></div>\n')}])}(angular),function(e){"use strict";e.module("platform").factory("platformNavigationSvc",["$state","platformMenuDataSvc","platformMessenger","nswGlobals",function(e,t,n,i){var a={},o=new n,r=new n,s=new n;a.routes=[];var l=function(t,n){n=n||{},e.current.name===t?s.fire(t):(s.fire(t),e.go(t,n.params))},c=function(e,t){t&&t.promise?t.promise.then(function(){l(e)}):_.isFunction(t)?(t.apply(this,e),l(e)):l(e,t)};a.goState=function(e,n){var a={state:e};o.fire(a);var r=t.getCurrentMenu()||{};a.confirm&&a.confirm.then?a.confirm.then(function(){a.stop?r.name&&t.selectMenu(r.name,!1):c(e,n)}):(i.setValue("platform_menus_defaultState",{stop:!0},!0),c(e,n))};var u=function(e,t,n){var o,s=i.getValue("platform_menus_defaultState");if(i.setValue("platform_menus_defaultState",null,!0),t=t||{},n){if(_.isString(s))o=s;else{if(_.isObject(s)&&s.stop)return;if(o=t!==e&&t.state?t.state+"."+e.state:e.state,!o&&(o=(_.find(e.menus,{isDefault:!0})||{}).state,!o))return;/^wechat\./.test(o)||(o="wechat."+o)}a.goState(o),r.fire(e)}};return t.registerMenuSelected(u),a.registerRouteUpdated=function(e){r.register(e)},a.unregisterRouteUpdated=function(e){r.unregister(e)},a.registerStateUpdated=function(e){s.register(e)},a.unregisterStateUpdated=function(e){s.unregister(e)},a.registerRouteWillUpdated=function(e){o.register(e)},a.unregisterRouteWillUpdated=function(e){o.unregister(e)},a}])}(angular),function(e){"use strict";e.module("platform").factory("platformPreviewSvc",["platformModalSvc","nswGlobals","$http","platformMessenger","$q",function(e,t,n,i,a){var o,r={},s=new i;return r.showPreveivModal=function(t,n){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/materials/platform-preview-dir.html",controller:"platformPreviewCtrl",size:"lg",windowClass:"preview-bg",options:{information:t,type:n}}).then(function(e){return e},function(){return!1})},r.showPreveivSendModal=function(t){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/materials/platform-preview-send-dir.html",controller:"platformPreviewSendCtrl",size:"sm",options:{information:t}}).then(function(e){return e},function(){return!1})},r.loadArticle=function(e){var t=globals.basAppRoot+"material/materialInfo",i=a.defer();return n({method:"get",url:t,params:{type:"news",id:e}}).then(function(e){e.data.isSuccess?i.resolve(e.data.data):i.reject(e.data.data)}),i.promise},r.loadFans=function(){var e=globals.basAppRoot+"fans/fansList",i=a.defer();return n({method:"get",url:e,params:{appId:t.getValue("appId"),pageNum:1,pageSize:1e5}}).then(function(e){if(e.data.isSuccess){var t=[];_.forEach(e.data.data.dataList,function(e){t.push({id:e.openid,name:e.nickname})}),i.resolve(t)}else i.reject(e.data.data)}),i.promise},r.sendMassMsg=function(e){var i=globals.basAppRoot+"massmsg/sendMassMsg",o=a.defer();return n({method:"post",url:i,params:{appId:t.getValue("appId")},data:e}).then(function(e){e.data.isSuccess?o.resolve(e.data.data):o.reject(e.data.data)}),o.promise},r.mobilePreview=function(e){var i=globals.basAppRoot+"massmsg/preViewNews";e.appId=t.getValue("appId");var o=a.defer();return n({method:"post",url:i,data:e}).then(function(e){e.data.isSuccess?o.resolve(e.data.data):o.reject(e.data.data)}),o.promise},r.setCurrentItem=function(e){e.content&&(e.content=r.transformCmsArticle(e.content)),o=e},r.getCurrentItem=function(){return s.fire(),o},r.omitAttr=function(e){var t=_.toArray(arguments);e=t.shift(),_.forEach(t,function(t){e&&e.hasOwnProperty(t)&&delete e[t]})},r.transformCmsArticle=function(e){var t=/(src\S*=\S*")((?!http|https|ftp)\S+)"/gi;return e.replace(t,"$1"+globals.cmsImagePath+'$2"')},r.registerSwichShow=function(e){s.register(e)},r.unregisterSwichShow=function(e){s.unregister(e)},r}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("platformTemplatePreviewSvc",["desktopMainSvc",function(){var e={};return e.devices={pc:4,phone:5,reposive:9},e.preview=function(e,t,n,i){i?window.open(globals.basAppRoot+"js/template/index.html#/template-setting?state="+t+"&isPubTpl="+n+"&pageid="+e+"&device="+i):window.open(globals.basAppRoot+"js/template/index.html#/template-setting?state="+t+"&isPubTpl="+n+"&pageid="+e)},e.previewDetail=function(e,t){window.open(globals.basAppRoot+"js/template/index.html#/template-setting?&pageid="+t+"&template="+e+"&state=preview")},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformUploaderSvc",["$http","$q","platformModalSvc",function(t,n,i){var a,o={},r={unique_names:!0,runtimes:"html5,flash,html4",max_file_size:"2mb",chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:globals.basAppRoot+"file/getUpToken",domain:globals.basImageDomain,get_new_uptoken:!1,auto_start:!0,log_level:3,init:{}},s=1,l=[],c="images",u=function(){t.get(globals.basAppRoot+"file/getFileName").then(function(e){e.data.isSuccess?a=e.data.data:i.showWarmingMessage("生成图片库命名规则失败！","错误")})},d=function(){return a+"_"+s++};plupload.guid=function(){return"resource/"+c+"/"+d()},o.setResourceType=function(e){c=e||"images"},window.plupload.addFileFilter("max_count",function(e,t,n){var a=e.maxCount,o=e.listedCount();return a&&a<=o?void i.showWarmingMessage(e.errorTip,"提示"):void n(!0)}),plupload.addFileFilter("nsw_prevent_duplicates",function(e,t,n){if(e)for(var a=this.files.length;a--;)if(t.name===this.files[a].name&&t.size===this.files[a].size){var o=plupload.translate("Duplicate file error.")+"\r\n       '"+t.name+"'";return void i.showWarmingMessage(o,"提示").then(function(){n(!1)},function(){n(!1)})}n(!0)});var p=function(t){var n,i=this,a={},o={};return t=t||{},e.extend(o,r,t),i.nswHash=o.nswHash=d(),l.push(i),i.checkUploader=function(e){return o.nswHash===e},i.getOptions=function(){return o},i.runUploader=function(e){return o.browse_button=e||o.browse_button,n=Qiniu.uploader(o),_.forEach(a,function(e,t){_.forEach(e,function(e){e&&n.bind(t,e)})}),n},i.unbind=function(e,t){if(n)n.unbind(e,t);else{var o=a[e];_.forEach(a[e],function(e,n){if(t===e)return o[n]=null,!1})}return i},i.bind=function(e,t){return a[e]=a[e]||[],a[e].push(t),n&&n.bind(e,t),i},i.start=function(){n.start()},i.removeItem=function(e){n.removeFile(e)},i.remove=function(){n.unbindAll(),a=null,n.destroy()},i};return o.getUploaderSvc=function(e){return _.find(l,{nswHash:e})},o.createUploader=function(e){return new p(e)},o.resolveBase64=function(e){var t=n.defer();if(!/image\/\w+/.test(e.type))return i.showWarmingTip("请确保文件为图像类型"),!1;var a=new FileReader;return a.onload=function(){t.resolve(this.result)},a.readAsDataURL(e.getSource().getSource()),t.promise},o.resolveBaseFile=function(e){var t=n.defer();return t.resolve(e.getSource()),t.promise},u(),o}])}(angular),function(e){"use strict";e.module("platform").factory("platformWechatEmotionSvc",[function(){function e(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}var t={},n=[{code:"/微笑",key:"/::)",desc:"微笑",img:0},{code:"/撇嘴",key:"/::~",desc:"撇嘴",img:1},{code:"/色",key:"/::B",desc:"色",img:2},{code:"/发呆",key:"/::|",desc:"发呆",img:3},{code:"/得意",key:"/:8-)",desc:"得意",img:4},{code:"/流泪",key:"/::<",desc:"哭",img:5},{code:"/害羞",key:"/::$",desc:"羞",img:6},{code:"/闭嘴",key:"/::X",desc:"哑",img:7},{code:"/睡",key:"/::Z",desc:"睡",img:8},{code:"/大哭",key:"/::'(",desc:"哭",img:9},{code:"/尴尬",key:"/::-|",desc:"囧",img:10},{code:"/发怒",key:"/::@",desc:"怒",img:11},{code:"/调皮",key:"/::P",desc:"调皮",img:12},{code:"/呲牙",key:"/::D",desc:"笑",img:13},{code:"/惊讶",key:"/::O",desc:"惊讶",img:14},{code:"/难过",key:"/::(",desc:"难过",img:15},{code:"/酷",key:"/::+",desc:"酷",img:16},{code:"/冷汗",key:"/:--b",desc:"汗",img:17},{code:"/抓狂",key:"/::Q",desc:"抓狂",img:18},{code:"/吐",key:"/::T",desc:"吐",img:19},{code:"/偷笑",key:"/:,@P",desc:"笑",img:20},{code:"/:,@-D",key:"/:,@-D",desc:"愉快",img:21},{code:"/白眼",key:"/::d",desc:"奇",img:22},{code:"/傲慢",key:"/:,@o",desc:"傲",img:23},{code:"/饥饿",key:"/::g",desc:"饿",img:24},{code:"/困",key:"/:|-)",desc:"累",img:25},{code:"/惊恐",key:"/::!",desc:"吓",img:26},{code:"/流汗",key:"/::L",desc:"汗",img:27},{code:"/憨笑",key:"/::>",desc:"高兴",img:28},{code:"/::,@",key:"/::,@",desc:"闲",img:29},{code:"/奋斗",key:"/:,@f",desc:"努力",img:30},{code:"/咒骂",key:"/::-S",desc:"骂",img:31},{code:"/疑问",key:"/:?",desc:"疑问",img:32},{code:"/嘘",key:"/:,@x",desc:"秘密",img:33},{code:"/晕",key:"/:,@@",desc:"乱",img:34},{code:"/::8",key:"/::8",desc:"疯",img:35},{code:"/:,@!",key:"/:,@!",desc:"哀",img:36},{code:"/骷髅",key:"/:!!!",desc:"鬼",img:37},{code:"/敲打",key:"/:xx",desc:"打击",img:38},{code:"/再见",key:"/:bye",desc:"bye",img:39},{code:"/擦汗",key:"/:wipe",desc:"汗",img:40},{code:"/抠鼻",key:"/:dig",desc:"抠",img:41},{code:"/鼓掌",key:"/:handclap",desc:"鼓掌",img:42},{code:"/糗大了",key:"/:&-(",desc:"糟糕",img:43},{code:"/坏笑",key:"/:B-)",desc:"恶搞",img:44},{code:"/左哼哼",key:"/:<@",desc:"什么",img:45},{code:"/右哼哼",key:"/:@>",desc:"什么",img:46},{code:"/哈欠",key:"/::-O",desc:"累",img:47},{code:"/鄙视",key:"/:>-|",desc:"看",img:48},{code:"/委屈",key:"/:P-(",desc:"难过",img:49},{code:"/快哭了",key:"/::'|",desc:"快哭了",img:50},{code:"/阴险",key:"/:X-)",desc:"坏",img:51},{code:"/亲亲",key:"/::*",desc:"亲",img:52},{code:"/吓",key:"/:@x",desc:"吓",img:53},{code:"/可怜",key:"/:8*",desc:"可怜",img:54},{code:"/菜刀",key:"/:pd",desc:"刀",img:55},{code:"/西瓜",key:"/:<W>",desc:"水果",img:56},{code:"/啤酒",key:"/:beer",desc:"酒",img:57},{code:"/篮球",key:"/:basketb",desc:"篮球",img:58},{code:"/乒乓",key:"/:oo",desc:"乒乓",img:59},{code:"/咖啡",key:"/:coffee",desc:"咖啡",img:60},{code:"/饭",key:"/:eat",desc:"美食",img:61},{code:"/猪头",key:"/:pig",desc:"动物",img:62},{code:"/玫瑰",key:"/:rose",desc:"鲜花",img:63},{code:"/凋谢",key:"/:fade",desc:"枯",img:64},{code:"/:showlove",key:"/:showlove",desc:"唇",img:65},{code:"/爱心",key:"/:heart",desc:"爱",img:66},{code:"/心碎",key:"/:break",desc:"分手",img:67},{code:"/蛋糕",key:"/:cake",desc:"生日",img:68},{code:"/闪电",key:"/:li",desc:"电",img:69},{code:"/炸弹",key:"/:bome",desc:"炸弹",img:70},{code:"/刀",key:"/:kn",desc:"刀",img:71},{code:"/足球",key:"/:footb",desc:"足球",img:72},{code:"/瓢虫",key:"/:ladybug",desc:"虫",img:73},{code:"/便便",key:"/:shit",desc:"臭",img:74},{code:"/月亮",key:"/:moon",desc:"月亮",img:75},{code:"/太阳",key:"/:sun",desc:"太阳",img:76},{code:"/礼物",key:"/:gift",desc:"礼物",img:77},{code:"/拥抱",key:"/:hug",desc:"伙伴",img:78},{code:"/强",key:"/:strong",desc:"赞",img:79},{code:"/弱",key:"/:weak",desc:"差",img:80},{code:"/握手",key:"/:share",desc:"握手",img:81},{code:"/胜利",key:"/:v",desc:"优",img:82},{code:"/抱拳",key:"/:@)",desc:"恭",img:83},{code:"/勾引",key:"/:jj",desc:"勾",img:84},{code:"/拳头",key:"/:@@",desc:"顶",img:85},{code:"/差劲",key:"/:bad",desc:"坏",img:86},{code:"/爱你",key:"/:lvu",desc:"爱",img:87},{code:"/NO",key:"/:no",desc:"不",img:88},{code:"/OK",key:"/:ok",desc:"好的",img:89},{code:"/爱情",key:"/:love",desc:"爱",img:90},{code:"/飞吻",key:"/:<L>",desc:"吻",img:91},{code:"/跳跳",key:"/:jump",desc:"跳",img:92},{code:"/发抖",key:"/:shake",desc:"怕",img:93},{code:"/怄火",key:"/:<O>",desc:"尖叫",img:94},{code:"/转圈",key:"/:circle",desc:"圈",
img:95},{code:"/磕头",key:"/:kotow",desc:"拜",img:96},{code:"/回头",key:"/:turn",desc:"回头",img:97},{code:"/跳绳",key:"/:skip",desc:"跳",img:98},{code:"/:oY",key:"/:oY",desc:"天使",img:99},{code:"/激动",key:"/激动",desc:"激动",img:100},{code:"/:hiphot",key:"/:hiphot",desc:"跳舞",img:101},{code:"/献吻",key:"/献吻",desc:"吻",img:102},{code:"/左太极",key:"/左太极",desc:"瑜伽",img:103},{code:"/右太极",key:"/右太极",desc:"太极",img:104}],i=/\.*([|\*|\.|\?|\+|\$|\^|\[|\]|\(|\)|\{|\}|\||\\|\/])\.*/gi;return t.getImagePath=function(e){return globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/"+e+".gif"},t.imgToCode=function(t){return t=t||"",t=t.replace(/<img[^>]+src\s*=\s*['\"][^'\"]+\/(\d+).gif?[^'\"]+['\"][^>]*>/gi,function(e,t){return(_.find(n,{img:parseInt(t)})||{}).code}),t=t.replace(/[\n|\r\n]/gi,""),t=t.replace(/(<a[^<]+)(<br\s+\/>)([^<]{0,}<\/a>)/gi,"$1$3\n"),t=t.replace(/&nbsp;/gi," ").replace(/<br\s*[\/?]>/gi,"\n"),t=e(t),t=_.trimRight(t,"\n")},t.codeToImg=function(e){return e=e||"",_.forEach(n,function(n){var a=n.code.replace(i,"\\$1"),o=n.key.replace(i,"\\$1"),r=new RegExp(a,"ig"),s=new RegExp(o,"ig");r.test(e)?e=e.replace(r,'<img src="'+t.getImagePath(n.img)+'" alt="'+n.desc+'"/>'):s.test(e)&&(e=e.replace(s,'<img src="'+t.getImagePath(n.img)+'" alt="'+n.desc+'"/>'))}),e=e.replace(/\n/gi,"<br />"),e=e.replace(/[$|]\s/gi,"&nbsp;")},t.getEmotions=function(){return n},t}])}(angular),function(e){"use strict";e.module("platform").factory("platformWordCountSvc",[function(){var e={};return e.count=function(e){var t=0;e=e||"";for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);i>=1&&i<=126||65376<=i&&i<=65439?t++:t+=2}return t},e.slice=function(e,t,n){var i="",a=0;e=e||"";for(var o=0;o<e.length;o++){var r=e.charCodeAt(o);r>=1&&r<=126||65376<=r&&r<=65439?a++:a+=2,a>=t&&a<=t+n&&(i+=e[o])}return i},e.getSize=function(e){return e.replace(/<\/?a[^>]*>/gi,"").length},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformImgLibSvc",["$q","platformModalSvc","nswGlobals","$http","platformMessenger",function(t,n,i,a,o){var r={},s=new o;return r.showImgLibModal=function(t,i,a){return n.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/platform-image-lib-dir.html",controller:"imglibWinCtrl",size:"lg",options:{showAlign:a,imgConfig:t,selectedItem:e.copy(i)}}).then(function(e){return e},function(){return!1})},r.loadWechatData=function(){var e={method:"get",url:globals.basAppRoot+"material/materialInfoImage",params:{appId:i.getValue("appId"),pageNum:1,pageSize:8}};return a(e).then(function(e){return e.data.isSuccess?s.fire(e.data.data):n.showWarmingMessage(e.data.data,"获取数据失败"),e.data})},r.registerdataload=function(e){s.register(e)},r.unregisterdataload=function(e){s.unregister(e)},r}])}(angular),function(e){"use strict";e.module("platform").factory("platformMenuDataSvc",["$http","platformMessenger","nswGlobals",function(e,t,n){var i,a,o,r={},s="platform_menus_selectedMenu",l="platform_menus_selectedMenuGroup",c={groups:[]},u=new t,d=new t,p=function(e){i=m((i||n.getValue(s)||{}).name),a=h(i)||n.getValue(l)||{},a=f(a.name),i=i||a,_.forEach(e,function(e){_.has(e,"selected")&&delete e.selected,e.defaultSelected&&!a&&(a=e),_.forEach(e.menus,function(e){_.has(e,"selected")&&delete e.selected,e.defaultSelected&&!i&&(i=e)}),i=i||a,i.defaultSelected=!0}),u.fire(i,a)},m=function(e){var t;return _.forEach(c.groups,function(n){return n.name===e?(t=n,!1):void(n.menus&&_.forEach(n.menus,function(n){if(n.name===e)return t=n,!1}))}),t},f=function(e){return _.find(c.groups,{name:e})};r.getMenuByState=function(e){var t;return e=e.replace(/^wechat./,""),_.forEach(c.groups,function(n){return n.state===e||(e||"").slice(0,(n.state||"").length)===n.state?(t=n,!1):(n.menus&&_.forEach(n.menus,function(i){if(i.state===e||n.state+"."+i.state===e)return t=i,!1}),!t&&void 0)}),t||{name:""}};var g=function(){if(!o||o!==n.getValue("appId"))return o=n.getValue("appId"),e({method:"get",url:globals.basAppRoot+globals.menuSrc,params:{appId:o}}).then(function(e){if(e.data.isSuccess){if(c=e.data.data||{groups:[]},c.groups.push({name:"公众号管理",state:"accountEdit",hide:!0}),i&&i.updateState){var t=m(i.name);n.setValue(s,t,!0),t&&r.fireMenuSelected(t)}p(c.groups),d.fire(c)}})},h=function(e){var t;return _.forEach(c.groups,function(n){return n!==e&&(_.forEach(n.menus,function(i){if(i===e)return t=n,!1}),!t)}),t||e};return r.getMenus=function(){return c},r.fireMenuSelected=function(e,t){t=!_.isBoolean(t)||t;var o=m(e.name)||"",r=h(e);o?(n.setValue("platform_menus_defaultState",null,!0),u.fire(o,r,t),n.setValue(s,{name:o.name},!0),n.setValue(l,{name:r.name},!0)):(n.setValue("platform_menus_defaultState",!0,!0),n.setValue(s,{name:e.name},!0),n.setValue(l,{name:e.name},!0)),i=m(e.name)||"",a=h(e)},r.getCurrentMenu=function(){return i},r.getCurrentMenuGroup=function(){return a},r.selectMenu=function(e,t){if(e){var a=m(e)||r.getMenuByState(e);a&&a.name?r.fireMenuSelected(a,t):(i={name:e,updateState:!0},n.setValue(s,i,!0))}},r.registerMenuLoaded=function(e){c&&c.groups.length?e.call(this,c):g(),d.register(e)},r.unregisterMenuLoaded=function(e){d.unregister(e)},r.registerMenuSelected=function(e){i&&c.groups.length&&e.apply(this,i,h(i)),u.register(e)},r.unregisterMenuSelected=function(e){u.unregister(e)},r.reloadSystemMenus=function(){return g()},r}])}(angular),function(e){"use strict";e.module("platform").filter("nswDate",["$filter",function(e){return function(t,n){if(t){var i=t.replace(/-/g,"/"),a=new Date(i);return e("date")(a,n)}}}])}(angular),function(e){"use strict";e.module("platform").filter("nswDesc",["platformWordCountSvc",function(e){return function(t,n,i){t=t||"";var a=i?e.count(t):t.length;return n=n||a,a&&a>n&&(t=i?e.slice(t,0,n)+"...":t.slice(0,n)+"..."),t}}])}(angular),function(e){"use strict";e.module("platform").filter("nswEmoji",[function(){return function(e,t,n){return e=e||"",Emoji.trans(e)}}])}(angular),function(e){"use strict";e.module("platform").filter("nswEmotions",["$sce","platformWechatEmotionSvc",function(e,t){return function(e){return e=e||"",e="<p>"+t.codeToImg(e)+"</p>"}}])}(angular),function(e){"use strict";e.module("platform").filter("nswTrusted",["$sce",function(e){return function(t){return t=t||"",e.trustAsHtml(t)}}])}(angular),function(e){"use strict";e.module("platform").controller("imgLibCtrlx",["$scope","$modalInstance","platformImgLibSvc","platformModalSvc","nswGlobals",function(e,t,n,i,a){e.imgurl="material/image/upload?appId="+a.getValue("appId"),n.loadWechatData(),n.registerdataload(function(t){e.dataList=t}),e.setCurrentItem=function(t){e.currentItem=t},e.changeFile=function(t){e.currentItem=t,e.closeModal("true",e.currentItem)},e.ok=function(){e.closeModal("true",e.currentItem)}}])}(angular),function(e){"use strict";e.module("platform").controller("imglibWinCtrl",["$scope","platformImageLibSvc","basListCtrlSvc",function(e,t,n){n.createInstance(e,t,{}),e.modalOptions.selectedItem?e.setCurrentItem(e.modalOptions.selectedItem):e.setCurrentItem({});var i=function(){t.loadImageSize().then(function(t){e.phoneImg="手机网站图片("+t.cmsImageSize+")",e.myImg="微信管家图片("+t.wxImageSize+")"}),"wechat"!==t.getFilterType()?e.searchType("wechat",1):e.searchData()};e.searchType=function(n,i){e.tab=i,t.setFilterType(n),e.searchOptions&&(e.searchOptions.pageNum=1,e.searchOptions.filter=""),e.searchData().then(function(){t.loadImageSize().then(function(t){e.phoneImg="手机网站图片("+t.cmsImageSize+")",e.myImg="微信管家图片("+t.wxImageSize+")"});var n=t.getCurrentItem()||{},i=_.find(t.getDataList(),{fileId:n.fileId||n.url});t.setCurrentItem(i)})},e.changeFile=function(t){e.searchOptions.filter="",e.searchOptions.pageNum=1,e.setCurrentItem(t),e.searchType("wechat",1)},e.searchOptions.pageNum=1,e.searchOptions.filter="",i()}])}(angular),function(e){"use strict";e.module("platform").controller("platformModalMessageCtrl",["$scope","$timeout",function(e,t){}])}(angular),function(e){"use strict";e.module("platform").controller("platformModalTipCtrl",["$scope","$timeout",function(e,t){var n=($('[ng-controller="desktopMainCtrl"]')[0]||$(window)[0]).clientHeight>$(window).height();e.modalOptions.closeModal=function(){e.closeModal()},e.getTipIcon=function(){switch(e.modalOptions.type){case"success":return"icon-success";case"warming":return"icon-warming";default:return"icon-loading"}},$(".tip-box").closest(".modal-content").css("border",0).css("box-shadow","0 0 0").css("background-color","#C4C5CA").closest(".modal-dialog").css("box-shadow","0 0 0").css("opacity",.6),"loading"!==e.modalOptions.type&&(n&&$("html").css("overflow-y","auto"),$(".tip-box").closest(".modal-backdrop").css("display","none"),$(".tip-box").closest(".nsw.modal-dialog").css("margin",0),$(".tip-box").closest(".nsw.modal").css("width",$(".modal-content").width).css("height","59px").css("overflow","hidden").css("margin-top","150px").css("width","300px").css("margin-left","40%"),t(function(){e.closeModal(!0)},2e3))}])}(angular),function(e){"use strict";e.module("platform").controller("platformPreviewCtrl",["$scope","$timeout","platformPreviewSvc","accountDataSvc","platformModalSvc",function(t,n,i,a,o){t.isPreview=!0,t.option=e.noop,t.option.material={},t.option.tab="material","news"===t.modalOptions.type?(i.loadArticle(t.modalOptions.information.mediaId).then(function(e){t.option.material=e,t.option.create_time=e.create_time,i.setCurrentItem(e.articles[0])}),t.mobilePreviewItem={appId:t.option.material.appId,massType:"news",mediaId:t.option.material.id}):(t.option.material=e.copy(t.modalOptions.information),t.option.create_time=t.option.material.create_time,i.setCurrentItem(t.option.material.articles[0]),t.mobilePreviewItem={articles:t.option.material.articles,appId:t.option.material.appId});var r=function(e){t.currentWechtInfo=e};t.selectTab=function(e){t.option.tab=e,"article"===e&&(t.option.currentItem=i.getCurrentItem(),_.has(t.option.currentItem,"isArticle")&&t.option.currentItem.isArticle&&i.omitAttr(t.option.currentItem,"otherUrl"))},t.option.create_time||(t.option.create_time=(new Date).format("yyyy-MM-dd hh:mm:ss")),t.previewArticle=function(e){e&&i.setCurrentItem(e),t.selectTab("article")},a.registerCurrentItemChanged(function(e){r(e)}),i.registerSwichShow(function(){$(".nsw-article").animate({scrollTop:"0px"},300)}),t.$on("$destroy",function(){a.unregisterCurrentItemChanged(),i.unregisterSwichShow()})}])}(angular),function(e){"use strict";e.module("platform").controller("platformPreviewSendCtrl",["$scope","platformPreviewSvc","platformModalSvc",function(e,t,n){t.loadFans().then(function(t){e.groupTypes=t}),e.send=function(){e.formpreview.$dirty=!1,e.modalOptions.information.openId=e.options.groupType,e.modalOptions.information.mediaId||e.modalOptions.information.massType?t.sendMassMsg(e.modalOptions.information).then(function(){n.showSuccessTip("发送成功"),e.closeModal(!0)},function(){n.showWarmingTip("消息发送失败"),e.closeModal(!0)}):t.mobilePreview(e.modalOptions.information).then(function(){n.showSuccessTip("发送成功"),e.closeModal(!0)},function(){n.showWarmingTip("消息发送失败"),e.closeModal(!0)})}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAuthEnable",["platformNswAuthSvc",function(e){return{link:function(t,n,i){var a=i.nswAuthEnable,o=t.$new(!1);o.hasCode=function(t){return e.getAuth(t)};var r=function(){n.attr("disabled","disabled"),n.css("readonly","true"),n.addClass("not-authed"),"a"===n[0].tagName.toLowerCase()&&i.href&&(n.attr("data-nsw-href",i.href),n.attr("href","javascript:void(0)"))},s=function(){n.removeClass("not-authed"),n.attr("data-nsw-href",n.attr("data-nsw-href"))};e.getAuth(a)?s():r();var l=t.$watch(function(){var t=/^\${1}/;return t.test(a)?o.$eval(a.replace(t,"")):e.getAuth(a)},function(e){e?s():r()});t.$on("$destroy",function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAuthIf",["platformNswAuthSvc",function(e){return{link:function(t,n,i){var a=i.nswAuthIf,o=t.$new(!1);o.hasCode=function(t){return e.getAuth(t)};var r=function(){n.addClass("not-authed-hide")},s=function(){n.removeClass("not-authed-hide")};e.getAuth(a)||r();var l=t.$watch(function(){var t=/^\${1}/;return t.test(a)?o.$eval(a.replace(t,"")):e.getAuth(a)},function(e){e?s():r()});t.$on("$destroy",function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").factory("platformNswAuthSvc",["$http","$q","platformModalSvc","$localStorage",function(e,t,n,i){var a={};return a.getAuth=function(e){var t=i.nswAuths||[];return!!_.find(t,{authority:e})},a.loadAuthData=function(){var a=globals.basAppRoot+"/user/getAuthoritiesCode",o=t.defer();return e.get(a).then(function(e){e.data.isSuccess?(i.nswAuths=_.map(e.data.data,function(e){return{authority:e}}),o.resolve(i.nswAuths)):(n.showWarmingMessage("权限数据获取失败","提示"),o.reject("权限数据获取失败"))},function(e){console.error(e),n.showWarmingMessage("权限数据获取失败","提示"),o.reject("权限数据获取失败")}),o.promise},a}])}(angular),function(e){"use strict";e.module("platform").directive("dateRangePicker",["platformDateSvc",function(t){return{restrict:"A",scope:{options:"=",afterSelect:"&",range:"="},template:'<div class="range-picke"><input type="text" class="form-control"><i data-ng-click="deleteTime()" data-ng-if="showDelete" class="glyphicon glyphicon glyphicon-remove"></i><i class="glyphicon glyphicon-calendar fa fa-calendar" ng-class = {\'has-remove\':!showDelete} ></i></div>',replace:!0,link:function(n,i){n.showDelete=!1,n.backData={};var a=function(){var a={minDate:t.dateRange({range:365}),maxDate:(new Date).format("yyyy-MM-dd"),startDate:n.range&&n.range.start?n.range.start:t.dateRange({range:30}),endDate:n.range&&n.range.end?n.range.end:(new Date).format("yyyy-MM-dd"),locale:{format:"YYYY-MM-DD",language:"zh-CN",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十月","十二月"],applyLabel:"确认",cancelLabel:"取消"}};n.options&&n.options.showDelete&&(n.showDelete=n.options.showDelete);var o=e.extend({},a,n.options);n.options&&n.options.locale&&(o.locale=e.extend({},a.locale,n.options.locale)),i.find(".glyphicon-calendar").click(function(){i.find("input").click()}),i.find("input").daterangepicker(o,function(e,t){n.options&&n.options.locale&&n.options.locale.format?(n.backData.start=e.format(o.locale.format),n.backData.end=t.format(o.locale.format),n.afterSelect({data:n.backData})):(n.backData.start=e.format("YYYY-MM-DD"),n.backData.end=t.format("YYYY-MM-DD"),n.afterSelect({data:n.backData}))})};n.deleteTime=function(){i.find("input").val(""),n.backData.start="",n.backData.end="",n.afterSelect({data:n.backData})},n.$evalAsync(function(){a()});var o=n.$watch("range",function(e){e&&a()});n.$on("$detory",function(){o()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("dateTimePicker",["platformDateSvc",function(t){return{restrict:"A",require:"ngModel",templateUrl:globals.basAppRoute+"components/templates/date/platform-date-time-picker.html",scope:{},link:function(t,n,i,a){var o;t.showDelete="false"===!i.showDelete,t.backData={};var r=function(){var r={locale:{format:i.format||"YYYY-MM-DD HH:mm:ss",language:"zh-CN",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十月","十二月"],applyLabel:"确认",cancelLabel:"取消"},singleDatePicker:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,maxDate:"2100-12-30",minDate:(new Date).format("yyyy-MM-dd hh:mm:ss"),startDate:a.$viewValue,showDelete:t.showDelete};t.options&&t.options.showDelete&&(t.showDelete=t.options.showDelete);var s=e.extend({},r,t.options);t.options&&t.options.locale&&(s.locale=e.extend({},r.locale,t.options.locale)),n.find(".glyphicon-calendar").click(function(){o.click()}),o=n.find("input").daterangepicker(s,function(e){a.$setViewValue(e.format(s.locale.format))}),o.val(a.$viewValue)},s=function(){n.find("input").val("")};t.deleteTime=function(){t.backData.start="",s()},a.$render=function(){var e=a.$viewValue;e||s(),o&&o.val(e)},t.$evalAsync(function(){r()})}}}])}(angular),function(e){"use strict";e.module("platform").factory("platformFormBuilderSvc",["$templateCache","$compile","rowBuilderSvc","platformFormDomainSvc",function(t,n,i,a){var o={},r=function(e){var n="form-"+e+".html";return t.get(n)||""},s=function(t,n){var i=a.getDomainConfig(n.domain)||{};n=e.extend(i,n);var o=!_.isBoolean(n.hasLabel)||n.hasLabel;n.label=n.label||"";var s,l,c=r("row"),u=r("required"),d=o?r("label"):"",p=r(n.template),m=r("errorContainer"),f=(n.model||"").replace(/\./g,""),g=[],h=[],v="";n.required&&(v+="required ",s=r("error"),s=s.replace(/%errorMessage%/g,"请填写"+n.label).replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"required"),g.push(s)),n.maxLength&&(v+='ng-maxlength="'+n.maxLength+'" ',p=p.replace(/%maxLengthCount%/g,n.maxLength),s=r("error"),s=s.replace(/%errorMessage%/g,n.label+"长度为0~"+n.maxLength+"字符").replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"maxlength"),g.push(s),l=r("maxLengthValidateTip"),l=l.replace(/%maxLength%/g,n.maxLength),h.push(l)),n.maxWord&&(v+='data-max-word="'+n.maxWord+'" ',s=r("error"),s=s.replace(/%errorMessage%/g,n.label+"使用逗号、空格和分隔符，并不能超过"+n.maxWord+"个关键字").replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"maxword"),g.push(s)),d=d.replace(/%required%/g,n.required?u:"").replace(/%label%/g,n.label),c=c.replace(/%label%/g,d);var w=n.size||5,b="col-md-%s% col-lg-%s% col-sm-%s% col-xs-%s%";return m=g.length?m.replace(/%content%/g,g.join("\r\n")):"",m=m.replace(/%formName%/g,t).replace(/%name%/g,f),p=p.replace(/%size%/,b.replace(/%s%/g,w)),p=p.replace(/%type%/g,n.type||"text"),p=p.replace(/%model%/g,"data."+n.model||""),p=p.replace(/%name%/g,f||""),p=p.replace(/%validators%/g,v),p=p.replace(/%errors%/g,m),p=p.replace(/%validateTip%/g,n.hasValidateTip&&h.length?h.join(" "):""),p=p.replace(/%rows%/g,n.textRows||""),p=p.replace(/%directive%/g,n.directive||""),p=p.replace(/%options%/g,n.directive?"options":""),c=c.replace(/%content%/g,p)};return o.buildFormTemplate=function(e){if(!e)return"";e.hasLabel=!_.isBoolean(e.hasLabel)||e.hasLabel,e.hasValidateTip=!_.isBoolean(e.hasValidateTip)||e.hasValidateTip;var t=e.name,n=[];return _.forEach(e.rows,function(i){i.hasLabel=_.isBoolean(i.hasLabel)?i.hasLabel:e.hasLabel,i.hasValidateTip=_.isBoolean(i.hasValidateTip)?i.hasValidateTip:e.hasValidateTip,n.push(s(t,i))}),n.join("\r\n")},o.buildTemplate=function(e,t){return i.init(e,t),i.build()},o.buildForm=function(t){if(!t)return"";t.hasLabel=!_.isBoolean(t.hasLabel)||t.hasLabel,t.hasValidateTip=!_.isBoolean(t.hasValidateTip)||t.hasValidateTip;var n=[];return _.forEach(t.rows,function(i){var r=a.getDomainConfig(i.domain)||{};i=e.extend(r,i),i.label=i.label||"",i.name=i.name||(i.model||"").replace(/\./g,""),i.hasLabel=_.isBoolean(i.hasLabel)?i.hasLabel:t.hasLabel,i.hasValidateTip=_.isBoolean(i.hasValidateTip)?i.hasValidateTip:t.hasValidateTip,i.maxLength&&(i.validateTip=i.validateTip||"maxLength"),n.push(o.buildTemplate(t,i))}),n.join("\r\n")},o}])}(angular),function(e){"use strict";e.module("platform").directive("platformForm",["$compile","platformFormBuilderSvc",function(t,n){return{restrict:"A",required:"ngModel",replace:!0,link:function(i,a,o){i._formOptions=i.$eval(o.options)||{},i.onPropertyChanged=i.$eval(o.onPropertyChanged)||e.noop,o.$observe("onPropertyChanged",function(){i.onPropertyChanged=i.$eval(o.onPropertyChanged)||e.noop});var r=function(){if(i._formOptions){i.lookups=i._formOptions.lookups;var e=$(n.buildForm(i._formOptions));a.html(""),a.append(e),t(e)(i)}};i.$watch(i._formOptions.name+".$invalid",function(e){i._formOptions.$invalid=e}),i.onChange=function(){i.onPropertyChanged.apply(this,arguments),i._formOptions.isDirty=!0};var s=function(){i._formOptions.setData=function(e){i._formOptions.name=i._formOptions.name||"",i.data=e,i._formOptions.data=e,i[i._formOptions.name]&&i[i._formOptions.name].$setPristine(!0)},i._formOptions.setData(i._formOptions.data)},l=function(){var e,t,n=function(){e=i.$watch("_formOptions.rows",function(){r()}),t=i.$watch("_formOptions.data",function(e){i._formOptions.setData(e)})},a=function(){_.isFunction(e)&&e(),_.isFunction(t)&&t()};if(i._formOptions&&i._formOptions.name){var l=i.$watch(function(){return i.$eval(o.options)},function(e){i._formOptions=e||{},s(),r(),a(),n()});n(),i.$on("$destroy",function(){l(),a()})}};i.$evalAsync(function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformInputAutofocus",[function(){return{restrict:"A",link:function(e,t,n){t.focus()}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswDropdown",[function(){return{restrict:"A",scope:{items:"=",afterSelect:"&",dir:"@",filter:"=",reject:"="},templateUrl:globals.basAppRoute+"components/directives/dropdown/platform-nsw-dropdown-dir.html",require:"ngModel",link:function(t,n,i,a){var o=!1;t.display=i.nswDisplay,t.value=i.nswValue;var r=function(e){e=e||{},t.selected=e,e.id===-9999?t.displayText=e.name:t.displayText=_.get(e,t.display)};t.select=function(n){if(n=n||{},n.id!==-9999){var i=_.get(n,t.value);e.isDefined(i)&&(a.$setViewValue(i),r(n)),t.afterSelect({value:i,selected:n})}};var s=function(e){return e=e||t.items,t.filter&&(e=_.filter(e,t.filter)),t.reject&&(e=_.reject(e,t.reject)),e};t.execFilter=function(e){e=e||t.items,e=s(e),t.displayItems=_.filter(e,function(e){var n=_.get(e,t.display);return!t.displayText||n.indexOf(t.displayText)>=0}),o=!0},t.displaySelect=function(i,a){"up"===t.dir&&n.find(".dropmenu").css("position","inherit"),e.isUndefined(i)&&(i=!n.find(".dropmenu").hasClass("open"));var o=n.find(".dropmenu").hasClass("open");i=!!i,o=!!o,i!==o&&n.find(".nsw-dropdown-menu").dropdown("toggle"),a&&(t.displayItems=s(t.items))},a.$render=function(){var e=a.$viewValue,n={};_.set(n,t.value,e);var i=_.find(t.items,n);r(i)},n.on("click",function(e){e.stopPropagation()}),n.on("keyup",function(){t.displaySelect(!0),t.execFilter(),t.$apply()}),$("body").on("click",function(){setTimeout(function(){t.$apply()},500)}),t.$watchCollection("items",function(e,n){n&&n.length&&o?t.execFilter(e):(e=s(e),t.displayItems=e),t.displayItems=t.displayItems||[],t.displayItems.length||t.displayItems.push({name:"【无】",id:-9999});var i={};i[t.value]=a.$viewValue,r(_.find(e,i))}),t.$watch(function(){return n.find(".dropmenu").hasClass("open")},function(e){e||r(t.selected)})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.service("platformImageLibSvc",["$q","$http","basDataSvc","nswGlobals","platformModalSvc",function(e,t,n,i,a){var o="wechat",r={uri:"material/materialInfoImage",list:{listUri:function(){return"wechat"===o?"material/materialInfoImage":"cms/listFiles"},enableSearch:!0,enablePaging:!0,pageSize:8,prepareSearchParam:function(e){e.appId=i.getValue("appId"),e.projId=s.projectId},selectionMode:"single"}},s=n.createInstance(r);return s.registerListLoaded(function(e){_.forEach(e,function(e){e.name=e.name||e.fileName})}),s.getProjectId=function(){t.get(globals.basAppRoot+"/cms/getProjectLists").then(function(e){e.data.isSuccess&&(s.projectId=e.data.data,s.getSearchOptions().projectId=s.projectId)})},s.loadImageSize=function(){var n=e.defer(),o={method:"get",url:globals.basAppRoot+"cms/listImageSize",params:{appId:i.getValue("appId")}};return t(o).then(function(e){return e.data.isSuccess?n.resolve(e.data.data):(n.reject(e.data.data),a.showWarmingMessage(e.data.data,"获取数据失败")),n.promise})},s.saveFile=function(n,i){var o=e.defer(),r={method:"post",url:globals.basAppRoot+n+"/saveFile",data:i};return t(r).then(function(e){return e.data.isSuccess?o.resolve(e.data.data):(o.reject(e.data.data),a.showWarmingMessage(e.data.data,"图片保存失败！")),o.promise})},s.setFilterType=function(e){o=e},s.getFilterType=function(){return o},s.getProjectId(),s.loadData(),s}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgUpload",["platformModalSvc","platformImgUploaderSvc","nswGlobals","platformImageLibSvc",function(e,t,n,i){return{restrict:"A",require:"ngModel",transclude:!0,scope:{imgUrl:"=",changeFile:"&",fileUploaded:"&",module:"@"},template:'<div><div class="container" style="display: none"></div><div class="el" ng-transclude></div></div>',link:function(a,o,r,s){var l,c,u=null,d=function(){l=t.createUploader(),c=l.getOptions(),o.attr("id",c.nswHash),l.bind("StateChanged",function(){this.state===plupload.STARTED&&(u=e.showLoadingTip("正在上传图片!"))}).bind("UploadComplete",function(e,t){var o=_.map(t,function(e){var t={appId:n.getValue("appId"),originName:e.fileName,fileName:e.target_name,fileId:e.target_name};return l.removeItem(e),t});i.saveFile(a.module||"file",o).then(function(){a.changeFile({file:o[0],files:o}),u&&u.close()},function(){u&&u.close()})}),l.runUploader(c.nswHash)};a.$evalAsync(function(){d()}),s.$render=function(){a.file=s.$viewValue},a.$on("$destroy",function(){l.remove()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("imgLib",["$modal","$parse","platformImgLibSvc",function(e,t,n){return{restrict:"A",require:"?ngModel",scope:{imgConfig:"=",imgSize:"@",imgWidth:"@",imgHeight:"@",ext:"@",nswAlt:"@",afterSelect:"&"},link:function(e,i,a,o){a.imgLib=a.imgLib||"image";var r=a.imgConfig?t(e.imgConfig)(e):{count:1,size:parseInt(e.imgSize||"300"),width:parseInt(e.imgWidth||"800"),height:parseInt(e.imgHeight||"800"),ext:e.ext||"gif,jpg,jpeg,bmp,png"};"url"!==a.imgLib&&"image"!==a.imgLib||(r.count=1),o&&(o.$render=function(){"url"===a.imgLib?e.image={url:o.$viewValue,alt:e.nswAlt,fileName:e.nswAlt}:e.image=o.$viewValue}),i.bind("click",function(t){t.stopPropagation(),n.showImgLibModal(r,e.image).then(function(t){t&&(o&&o.$setViewValue("url"===a.imgLib?t.fileId:t),e.afterSelect({image:t}))})})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswImg",["platformImgLibSvc",function(e){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="nsw-img-dir">           <i class="fa fa-times nsw-img-icon remove" ng-show="enableRemove" ng-click="_removeImg();"></i>           <i class="fa fa-eye nsw-img-icon preview" ng-show="enablePreview" ng-click="_imgPreview(url,$event)"></i>\t           <i class="edit-icon nsw-img-icon" ng-show="nswImgEnableEdit" ng-click="_editImage()"></i>\t           <a href="javascript:void(0);">                   <img nsw-src="{{_src}}" data-ng-click="_selectImage()" class="img"></a>           <input type="text" placeholder="请写图片描述" ng-disabled="hasProgress" class="form-control alt" autocomplete="off" ng-change="_altChanged(_alt)"  ng-model="_alt" ng-show="!altReadonly"  /></li>           <span class="form-control alt" ng-show="altReadonly"  ng-bind="_alt" /></li>           <span class="c-ready-up" ng-hide="!isUpload||hasProgress">{{img.state}}</span>           <div class="progress progress-mini" ng-show="isUpload && hasProgress">               <div style="width:{{img.progress}}%;" class="progress-bar progress-bar-success"></div>           </div></div>',link:function(t,n,i){t.enableRemove=!!i.nswImgRemove,t.enablePreview="true"===i.enablePreview,t.enableAlt=!!i.nswImgAlt,t.altReadonly="true"===i.altReadonly,t.nswImgEnableEdit="true"===i.nswImgEnableEdit,t.isUpload="true"===i.isUpload,t.hasProgress="true"===i.hasProgress,t.process=parseInt(i.progress),t._alt=t.$eval(i.nswImgAlt),t._src=t.$eval(i.nswImgSrc),i.$observe("nswImgAlt",function(){t.lockAlt||(t._alt=t.$eval(i.nswImgAlt))}),i.$observe("isUpload",function(){t.isUpload="true"===i.isUpload}),i.$observe("hasProgress",function(){t.hasProgress="true"===i.hasProgress}),i.$observe("process",function(){t.process=parseInt(i.progress)}),i.$observe("nswImgAlt",function(){t.lockAlt||(t._alt=t.$eval(i.nswImgAlt))}),t._altChanged=function(e){t.lockAlt=!0,_.set(t,i.nswImgAlt,e),t._alt=e,t.setModelDirty&&t.setModelDirty(),t.lockAlt=!1},i.$observe("nswImgSrc",function(){t._src=t.$eval(i.nswImgSrc)}),t._srcChanged=function(e){_.set(t,i.nswImgSrc,e),t.setModelDirty&&t.setModelDirty()},t._editImage=function(){var n={count:1,size:300,width:800,height:800,ext:"gif,jpg,jpeg,bmp,png"};e.showImgLibModal(n,{url:t._src}).then(function(e){t._src=e.url,!_.get(t,i.nswImgAlt)&&e.fileName&&(t._alt=e.fileName,t._altChanged(e.fileName.split(".")[0])),t._srcChanged(e.url)})},t._removeImg=function(){_.set(t,i.nswImgSrc,null),i.nswImgRemove&&t.$eval(i.nswImgRemove),t.$emit("itemremove",t._src)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswImgGroup",["$timeout",function(e){return{restrict:"A",template:'<span class = "glyphicon glyphicon-menu-left loopleft" ng-show = "imgs.length>maxItems"  ng-click = "back()"></span>               <div class="loopbox col-sm-11 nsw-img-group">                   <ul>                       <li ng-repeat = "(key,img) in imgs" class="img-container">                           <div nsw-img ng-if="showAlt" nsw-img-src="{{nswImgSrc}}" data-is-upload="{{img.isUpload}}" data-has-progress="{{img.hasProgress}}" data-process="{{img.process}}" data-alt-readonly="{{altReadonly}}" nsw-img-alt="{{nswImgAlt}}" nsw-img-enable-edit="{{nswImgEnableEdit}}" nsw-img-remove="{{imgRemoveAttr}}">                           </div>                           <div nsw-img ng-if="!showAlt" nsw-img-src="{{nswImgSrc}}"data-is-upload="{{img.isUpload}}" data-has-progress="{{img.hasProgress}}" data-process="{{img.process}}" nsw-img-remove="{{imgRemoveAttr}}"></div>                       </li>                   </ul>               </div>         <span  class = "glyphicon glyphicon-menu-right loopright" ng-show = "imgs.length>maxItems"  ng-click = "mov()"></span>',scope:!0,transclude:!0,require:"ngModel",link:function(t,n,i,a){t.enableSort="true"===i.enableSort,t.maxItems=parseInt(i.maxItems||"1"),t.showAlt="true"===i.showAlt,t.altReadonly="true"===i.altReadonly,t.nswImgSrc=i.nswImgSrc||"img.url",t.nswImgAlt=i.nswImgAlt||"img.alt",t.imgRemoveAttr=i.nswImgRemove,t.nswImgEnableEdit=i.nswImgEnableEdit;var o=function(){var e=null;i.nswHeight&&n.find(".loopbox").height(i.nswHeight),i.nswWidth&&n.find(".loopbox").width(i.nswWidth),$("li.img-container",n).draggable({axis:"x",appendTo:"body",containment:"parent",revert:"invalid",helper:"clone",create:function(){$(this).css("list-style","none")},drag:function(t,n){e=$(this).scope().img,$(n.helper).css("list-style","none"),$(n.helper).css("z-index","911215")},stop:function(){e=null}}),$("li.img-container",n).droppable({accept:"li.img-container",drop:function(){var i=$(this).scope().img;if(e&&i&&e!==i){var a,o,r=_.findIndex(t.imgs,e);_.remove(t.imgs,e);var s=_.findIndex(t.imgs,i);r>s?(a=t.imgs.slice(0,s),o=t.imgs.slice(s)):(a=t.imgs.slice(0,s+1),o=t.imgs.slice(s+1)),a.push(e);var l=a.concat(o);t.imgs.length=0,_.forEach(l,function(e){t.imgs.push(e)}),t.$digest()}$(".drop-active",n).removeClass("drop-active")},over:function(){$(".nsw-img-dir",this).addClass("drop-active")},out:function(){$(".nsw-img-dir",this).removeClass("drop-active")}}),$(".loopleft").droppable({accept:"li.img-container",over:function(){t.$apply(function(){t.back()})},drop:function(){alert(1)}}),$(".loopright").droppable({accept:"li.img-container",over:function(){t.$apply(function(){t.mov()})}})};t.setModelDirty=function(){a.$setViewValue(t.imgs)},a.$render=function(){t.imgs=a.$viewValue||[],e(function(){o()})},t.$watch("imgs.length",function(){o()}),t.$on("itemremove",function(){$(".loopbox ul",n).hasClass("mov")&&t.imgs.length%t.maxItems===0&&t.back()}),t.mov=function(){$(".loopbox ul",n).addClass("mov").removeClass("back")},t.back=function(){$(".loopbox ul",n).addClass("back").removeClass("mov")}}}}])}(angular),angular.module("platform").directive("platformEcharts",[function(){"use strict";return{link:function(e,t){function n(){var n=e.config&&e.config.theme?e.config.theme:"default",i=echarts.init(t[0],n);e.config&&e.config.dataLoaded===!1&&i.showLoading(),e.config&&e.config.dataLoaded&&(i.setOption(e.option),i.resize(),i.hideLoading()),e.config&&e.config.event&&angular.isArray(e.config.event)&&angular.forEach(e.config.event,function(e){for(var t in e)i.on(t,e[t])})}e.$watch(function(){return e.config},function(e){e&&n()},!0),e.$watch(function(){
return e.option},function(e){e&&n()},!0)},scope:{option:"=ecOption",config:"=ecConfig"},restrict:"A"}}]),function(e){"use strict";e.module("platform").directive("platformEmotionEditor",["$compile","platformKindEditorDataSvc","platformWechatEmotionSvc",function(t,n,i){return{restrict:"A",scope:{turnDesign:"="},require:"ngModel",templateUrl:globals.basAppRoute+"components/directives/kindeeditor/templates/emotion-editor.html",link:function(t,a,o,r){var s,l={},c=a.find("textarea");t.options=t.$parent.$eval(o.options)||{},t.options.maximumWords=t.options.maximumWords||parseInt(o.kMaximumWords),t.name="keditor-"+n.getUUID(),t.emotions=i.getEmotions(),t.resolveImage=function(e){return i.getImagePath(e)},t.addLink=function(){l.clickToolbar("link")};var u='textarea[name="'+t.name+'"]';c.attr("name",t.name);var d=e.copy(t.options);d.items=["wxemotions"],d.width=o.width||"100%",d.height=o.height||"100%",o.width&&(a.width(o.width),d.width=o.width),o.height&&(a.height(o.height),d.height=o.height),d=_.extend({},{resizeType:1,newlineTag:"br",allowPreviewEmoticons:!1,allowImageUpload:!1,cssPath:globals.basAppRoute+"components/content/css/kindeditor/kind-editor-emotion-reset.css",colorTable:n.colorTable,htmlTags:n.htmlTags,layout:n.layout,basePath:globals.basAppRoot+"plugins/kindeditor/",emoticonsPath:globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/",isEmotion:!0},d),d.afterCreate=function(){l=this,l.toolbar.div.css("display","none"),l.statusbar.css("display","none"),g(),$(l.statusbar[0]).find(".emoticons").length||(l.statusbar.append('<span class="ke-inline-block emoticons"></span>'),l.statusbar.append('<span class="ke-inline-block counter"></span>'),$(".emoticons").on("click",function(){l.clickToolbar("emoticons")}))},d.filterEmotionNodes=function(e){var t="li|table|tr|blockquote|center|div|h1|h2|h3|h4|h5|h6|p",n=new RegExp("<("+t+"){1}[s+[^/]{0,}/>|/>]|</("+t+"){1}s*>","ig"),i=/<(?!a|\/a|img|\/img|br).*?>/gi,a=/alt=\"[^\"]+\"|style=\"[^\"]+\"|target=\"[^\"]+\"|data-ke-src=\"[^\"]+\"|class=\"[^\"]+\"/gi;return e.replace(n,"<br/>").replace(i,"").replace(a,"").replace(/\n/,"<br/>").replace(/<img[^>]*src="([^"]+)"[^>]*>/gi,function(e,t){return/kindeditor\/plugins\/emoticons\/images\//i.test(t)?e:"<br/>---不支持图片发送--- <br/>"})},d.afterChange=function(){if(t.options.maximumWords&&l.count){var e=(l.html()||"").replace(/<img[^>]*>|<hr[^>]*>|<object[^>]*>/gi,"i").replace(/<\S+>|<\S+[^>]*>|<br[^>]*>/gi,"").replace(/\n|\s/gi,"").replace(/&nbsp;/gi," ").length;t.maxLengthError=t.options.maximumWords<e,r.$setValidity("nswmaxlength",!t.maxLengthError),t.wordCount=e+"/"+t.options.maximumWords,l.statusbar&&l.statusbar[0]&&$(l.statusbar[0]).find(".counter").html(t.wordCount)}else t.wordCount="";return h(),t.$root.$$phase||t.$apply(),this};var p=function(){var e=_.find(t.emotions,{img:$(this).data("code")});l.insertHtml('<img src="'+i.getImagePath(e.img)+'" border="0" alt="'+e.desc+'" data-mo="'+e.code+'" />')},m=function(e){$(e.target).closest(".emotions").length||(a.find(".popover").popover("hide"),$(".emotion-item").off("click",p))},f=function(){$(".icon-emotions",a).popover({html:!0,placement:"right",content:$(".emotions",a)}).on("shown.bs.popover",function(){}),$(".icon-emotions",a).on("click",function(e){a.find(".popover").popover("show"),$(".emotion-item").on("click",p),e.stopPropagation()}),$("body").on("click",m),setTimeout(function(){$($("iframe",a)[0].contentWindow.document.getElementsByTagName("*")).click(m)},500)};t.$evalAsync(function(){KindEditor.create(u,d),a.find(".word-count").width(d.width),a.find(".ke-container").width(d.width),g(),$(".ke-edit-textarea",a).on("keyup",function(){h()}),f()});var g=function(){l&&l.isCreated&&(l.container.css("width","100%"),s=r.$viewValue,l.html(i.codeToImg(r.$viewValue||"")))},h=function(){if(l&&l.html){var e=l.html()||"",t=i.imgToCode(e||"");t!==(r.$viewValue||"")&&r.$setViewValue(t)}};r.$render=function(){g()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformKindeditor",["platformKindEditorDataSvc",function(t){return{restrict:"A",scope:{turnDesign:"="},require:"ngModel",template:'<div class="kind-editor">                <textarea style="visibility:hidden;"></textarea>               <div class="word-count" >                   <span class="err" data-ng-show="maxLengthError" style="text-align: left">录入字数不能超过<span data-ng-bind="options.maximumWords"></span>个字符</span>                    <span data-ng-bind="wordCount" style="min-width: 200px;float: right; text-align: right"></span>               </div>           </div>',link:function(n,i,a,o){var r,s={},l=i.find("textarea"),c=KindEditor.toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),u=KindEditor.toMap("33..40"),d={};KindEditor.each(c,function(e,t){d[e]=t}),KindEditor.each(u,function(e,t){d[e]=t}),n.options=n.$parent.$eval(a.options)||{simpleMode:"false"!==a.isSimple},n.options.maximumWords=n.options.maximumWords||parseInt(a.kMaximumWords),n.name="keditor-"+t.getUUID();var p='textarea[name="'+n.name+'"]';l.attr("name",n.name);var m=e.copy(n.options);m.items=t.wcItems,m.width=a.width||"100%",m.height=a.height||"100%",a.width&&(i.width(a.width),m.width=a.width),a.height&&(i.height(a.height),m.height=a.height),m=_.extend({},{resizeType:1,allowPreviewEmoticons:!1,allowImageUpload:!1,cssPath:globals.basAppRoute+"components/content/css/kindeditor/kind-editor-reset.css",colorTable:t.colorTable,htmlTags:t.htmlTags,layout:t.layout,basePath:globals.basAppRoot+"plugins/kindeditor/",emoticonsPath:globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/",SimpleMode:!1},m),m.afterCreate=function(){s=this,f(),$(s.statusbar[0]).find(".emoticons").length||(s.statusbar.append('<span class="ke-inline-block emoticons"></span>'),s.statusbar.append('<span class="ke-inline-block counter"></span>'),$(".emoticons").on("click",function(){s.clickToolbar("emoticons")}))},m.afterChange=function(){if(n.options.maximumWords&&s.count){var e=(s.html()||"").replace(/<img[^>]*>|<hr[^>]*>|<object[^>]*>/gi,"i").replace(/<\S+>|<\S+[^>]*>|<br[^>]*>/gi,"").replace(/\n|\s/gi,"").replace(/&nbsp;/gi," ").length;n.maxLengthError=n.options.maximumWords<e,o.$setValidity("nswmaxlength",!n.maxLengthError),n.wordCount="("+e+"/"+n.options.maximumWords+")",s.statusbar&&s.statusbar[0]&&$(s.statusbar[0]).find(".counter").html(n.wordCount)}else n.wordCount="";return g(),n.$root.$$phase||n.$apply(),this},n.$evalAsync(function(){KindEditor.create(p,m),i.find(".word-count").width(m.width),i.find(".ke-container").width(m.width),f(),$(".ke-edit-textarea",i).on("keyup",function(){g()})});var f=function(){s&&s.isCreated&&(s.container.css("width","100%"),r=o.$viewValue,s.html(o.$viewValue||""))},g=function(){if(s&&s.html){var e=s.html()||"",t=o.$viewValue||"";e!==t&&o.$setViewValue(e)}};o.$render=function(){f()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformMenu",["platformMenuDataSvc",function(e){return{restrict:"A",scope:!0,template:'<div class="c-menu-div">                <div class="c-menu-title" data-ng-bind="menus.title"></div>               <div class="c-menu-box">\t\t\t\t    <div data-ng-repeat="group in menus.groups" ng-show="!group.hide"  data-platform-menu-group data-ng-model="group"/></div>               </div>           </div>',link:function(t){var n=function(e){e&&e.groups.length&&(t.menus=e)};t.setSelectedGroup=function(e){t.selectedGroup=e,t.$broadcast("currentGroupChanged")},t.setSelectedMenu=function(e,n){t.selectedMenu=e,n&&(t.selectedGroup=n),t.$broadcast("currentGroupChanged")};var i=function(e,n){t.selectedGroup=n,t.selectedMenu=e,t.$broadcast("currentGroupChanged")};e.registerMenuSelected(i),e.registerMenuLoaded(n),t.$on("$destroy",function(){e.unregisterMenuLoaded(n)}),t.$evalAsync(function(){i(e.getCurrentMenu(),e.getCurrentMenuGroup())})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformMenuGroup",["platformMenuDataSvc","$timeout",function(e,t){return{restrict:"A",scope:!0,require:"ngModel",template:'<div>               <div class="c-menu c-mkname"  data-ng-class="getGroupClass()" data-ng-click="selectMenu(group)"><span data-ng-class="selectMenuIcon()"></span><div data-ng-bind="group.name"/></div>               <div class="c-menu-list">                   <div data-ng-repeat="menu in group.menus" data-ng-class="getMenuClass(menu)" class="c-menu-item" data-ng-click="selectMenu(menu)" data-ng-bind="menu.name"></div>               </div>           </div>',link:function(t,n,i,a){var o;a.$render=function(){t.group=a.$viewValue,t.group.selected?t.selectMenu(t.group):_.forEach(t.group.menus,function(e){e.selected&&t.selectMenu(e)})},t.navigate=function(t){e.fireMenuSelected(t)},t.selectMenuIcon=function(){var e=t.group.icon||"glyphicon glyphicon-tag";return(t.selectedMenu===t.group&&t.selectedGroup===t.group||t.selectedGroup===t.group&&t.group.menus)&&(e+=" active"),e},t.selectMenu=function(n){o=n,n.state?e.fireMenuSelected(n):n.menus&&(t.setSelectedGroup(n),t.$root.$broadcast("currentGroupChanged"))},t.getGroupClass=function(){var e="";return t.selectedGroup!==t.group||!t.group||t.group.menus&&t.group.menus.length?t.selectedGroup===t.group&&t.group&&(e="expend"):e+="selected",e},t.getMenuClass=function(e){return!e||t.selectedMenu!==e||e.menus&&e.menus.length?"":"selected"};var r=function(){var e=n.find(".c-menu");t.selectedGroup&&t.selectedGroup===t.group&&o===t.group?e.hasClass("expend")?e.next().slideUp(500,function(){e.removeClass("expend")}):t.group.menus&&t.group.menus.length&&e.next().stop(!0).slideDown(500,function(){e.addClass("expend")}):t.selectedGroup!==t.group&&e.hasClass("expend")&&e.next().stop(!0).slideUp(500,function(){e.removeClass("expend")})};t.$on("currentGroupChanged",r)}}}])}(angular),function(e){"use strict";e.module("platform").factory("platformArticleMaterialDataSvc",["materialsDataSvc","$state","$timeout","platformMenuDataSvc",function(e,t,n,i){var a={},o=function(){var i,a,o=this;o.createArticle=function(n,a){i=t.current.name,e.setCreateType(n,!0,a),e.createNew(),e.checkAuthed("phoneProj")?t.go("wechat.materials.apply"):t.go("wechat.materials.add")};var r=function(e){if(i){var o=i;a=e,n(function(){t.go(o)}),i=null}};o.getCreated=function(){var e=a;return a=null,e},e.registerItemCreated(r),o.clear=function(){if(!i)return e.unregisterItemCreated(r),!0}},r=function(e){if(a[e])return a[e];var t=new o;return a[e]=t,t},s=function(e){a[e]&&a[e].clear()&&delete a[e]};return{create:r,clear:s}}])}(angular),function(e){"use strict";e.module("platform").directive("platformArticleMaterialSelector",["$http","nswGlobals","platformModalSvc","platformArticleMaterialDataSvc",function(e,t,n,i){return{restrict:"A",require:"ngModel",scope:{remove:"&",afterSelect:"&",key:"@",srcModuleName:"@"},templateUrl:globals.basAppRoute+"components/templates/materials/platform-article-material-selector-dir.html",link:function(a,o,r,s){var l;a.key||console.error("key is required : platformArticleMaterialSelector"),a.imageUrl=globals.imageUrl.replace(/@appId/,t.getValue("appId")),a.afterImageSelected=function(e){a.material=e,a.materialId=e.id,s.$setViewValue(a.materialId),a.afterSelect({material:e})},a.switchToArticle=function(){a.createState=!0},a.createArticle=function(e){l.createArticle(e,a.srcModuleName)},a.showArtcileLib=function(){n.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{selected:{id:a.materialId},srcModuleName:a.srcModuleName}}).then(function(e){a.afterImageSelected(e)})},a.doRemove=function(){a.material={},a.materialId="",s.$setViewValue(a.materialId),a.remove()};var c=function(t){var n=globals.basAppRoot+"material/materialInfo";e({method:"get",url:n,params:{type:"news",id:t}}).then(function(e){e.data.isSuccess?(a.material=e.data.data,a.loadImageFaild=!1):a.loadImageFaild=!0})};if(s.$render=function(){var e=s.$viewValue;e&&e!==a.materialId?c(e):a.material={},a.materialId=e},a.key){l=i.create(a.key);var u=l.getCreated();u&&a.afterImageSelected(u)}a.$on("$destroy",function(){i.clear(a.key)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgMaterialSelector",["$http","nswGlobals",function(e,t){return{restrict:"A",require:"ngModel",scope:{remove:"&",afterSelect:"&"},templateUrl:globals.basAppRoute+"components/templates/materials/platform-img-material-selector-dir.html",link:function(e,n,i,a){e.imageUrl=globals.imageUrl.replace(/@appId/,t.getValue("appId")),e.afterImageSelected=function(t){e.materialId=t.fileId,a.$setViewValue(e.materialId),e.afterSelect({material:t})},e.doRemove=function(){e.material={},e.materialId="",a.$setViewValue(e.materialId),e.remove()},e.imageUploaded=function(t){e.afterImageSelected(t)},a.$render=function(){e.materialId=a.$viewValue}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPreview",["$modal","$parse","$http","platformPreviewSvc",function(t,n,i,a){return{restrict:"A",require:"?ngModel",scope:{information:"=",infoType:"="},link:function(t,n){n.bind("click",function(n){var i;t.currentItem=e.copy(t.information),t.currentItem.articles&&1===t.currentItem.articles.length?(t.currentItem.articles[0].digest=t.currentItem.articles[0].digest||window.deletHtmlTag(t.currentItem.articles[0].content.replace(/&nbsp;/gi," ")).slice(0,54),i=t.currentItem):i=t.currentItem;var o=t.infoType||"";n.stopPropagation(),a.showPreveivModal(i,o)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPreviewSend",["$modal","$parse","$http","platformPreviewSvc",function(e,t,n,i){return{restrict:"A",require:"?ngModel",scope:{information:"="},link:function(e,t){t.bind("click",function(t){var n=e.information;t.stopPropagation(),i.showPreveivSendModal(n)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgText",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/modals/platform-img-text.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("platformOnlyImg",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/modals/platform-olny-img.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("qrCode",[function(){return{restrict:"A",require:"ngModel",scope:{qrCodeUrl:"=",afterSelect:"&"},link:function(e,t,n,i){function a(){var n={mPosX:.5,mPosY:.5,mSize:.2,minVersion:6,mode:0,quiet:1,radius:0,render:"canvas",size:1417,background:"#ffffff",ecLevel:"H",fill:"#333333",fontcolor:"#ff9818",text:e.qrCodeUrl,width:"1417",height:"1417"},a=$.extend({},n,s);t.qrcode(a),0===a.mode?"normal"!==i.$viewValue&&i.$setViewValue("normal"):i.$setViewValue("personality"),e.afterSelect({data:t.find("canvas")[0].toDataURL("image/png")}),t.children("canvas").remove(),e.$root.$$phase||e.$apply()}var o,r,s={},l=function(){var e=$('<input id="image" type="file">');e[0].click(),e.change(function(){if(e[0].files&&e[0].files[0]){var t=new FileReader;t.onload=function(e){setTimeout(function(){o=$('<img id="img-buffer" src="'+e.target.result+'">')[0],s.image=o,s.mode=4,a()},250)},t.readAsDataURL(e[0].files[0])}})};i.$render=function(){r=i.$viewValue||""},t.click(function(){i.$viewValue&&"personality"!==i.$viewValue?l():(s.mode=0,a())});var c=e.$watch("qrCodeUrl",function(e,t){e&&e!==t?a():r=""});e.$on("$destroy",function(){c()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){e=e||"";for(var t=parseInt(n.nswMaxLength)||0,a=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);r>=1&&r<=126||65376<=r&&r<=65439?a++:a+=2}return 0===t||a<=t?(i.$setValidity("nswmaxlength",!0),e):(i.$setValidity("nswmaxlength",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswMaxLength",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("maxWord",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[、]+|[\|\|]+|[\$]+|[\\]+|[\s]+|[,，]+|[;；]+|[|｜]+/,o=/[、]+|[\|\|]+|[\$]+|[\\]+|[\s]+|[,，]+|[;；]+|[|｜]+/g,r=function(e){var t=parseInt(n.maxWord)||0,o=(e||"").split(a).length;return 0===t||o<=t?(i.$setValidity("maxword",!0),e):(i.$setValidity("maxword",!1),e)};i.$formatters.push(r),i.$parsers.unshift(r),i.$viewChangeListeners.push(function(){var e=i.$viewValue;e&&(e=e.replace(o,","),i.$setViewValue(e))}),n.$observe("maxword",function(){r(i.$viewValue)})}}}}]).directive("nswMaxLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){e=e||"";for(var t=parseInt(n.nswMaxLength)||0,a=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);r>=1&&r<=126||65376<=r&&r<=65439?a++:a+=2}return 0===t||a<=t?(i.$setValidity("nswmaxlength",!0),e):(i.$setValidity("nswmaxlength",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswmaxlength",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMinLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=0,o=function(e){var t=parseInt(n.nswMinLength)||0,o=0;e=e||"";for(var r=0;r<e.length;r++){var s=e.charCodeAt(r);s>=1&&s<=126||65376<=s&&s<=65439?o++:o+=2}return a=o,0===a||o>=t?(i.$setValidity("nswminlength",!0),e):void i.$setValidity("nswminlength",!1)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("nswminlength",function(){o(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("modelCompare",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(t){var a=n.modelCompare,o=e.$eval(a);return t!==o&&o?(i.$setValidity("modelcompare",!1),t):(i.$setValidity("modelcompare",!0),t)};i.$formatters.push(a),i.$parsers.unshift(a);var o=e.$watch(n.modelCompare,function(){a(i.$viewValue)});n.$observe("modelCompare",function(){a(i.$viewValue)}),e.$on("$destroy",function(){o()})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswUserValidator",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(t){var a=e.$eval(n.nswUserValidator).call(this,t),o=n.validatorName;return a?(i.$setValidity(o,!0),t):(i.$setValidity(o,!1),t)};i.$formatters.push(a),i.$parsers.unshift(a)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswBindHtml",[function(){return{restrict:"A",scope:{template:"@"},replace:!0,link:function(e,t,n){n.$observe("nswBindHtml",function(){t.html(n.nswBindHtml),t.find("a").on("click",function(e){e.preventDefault()})})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswEnter",["$parse","$rootScope",function(e,t){return{restrict:"A",compile:function(n,i){var a=e(i.nswEnter,!0);return function(e,n){n.keydown(function(n){if(13===n.keyCode){var i=function(){a(e,{$event:n}),n.stopPropagation()};t.$$phase?e.$evalAsync(i):e.$apply(i)}})}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformBreadNav",["$state","platformMenuDataSvc",function(e,t){return{restrict:"A",scope:{breadNavs:"=platformBreadNav"},templateUrl:globals.basAppRoute+"components/templates/platform-bread-nav-dir.html",link:function(e){e._breadNavs=e.breadNavs||[];var n=e._breadNavs.length-1;e._breadNavs[n]&&(e._breadNavs[n].href="#"),e.navigateTo=function(e){t.fireMenuSelected(e)},e.$watch("breadNavs",function(){e._breadNavs=e.breadNavs||[];var t=e._breadNavs.length-1;e._breadNavs[t]&&(e._breadNavs[t].href="#")})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformCatalogList",["platformModalSvc",function(e){return{restrict:"A",scope:{options:"="},templateUrl:globals.basAppRoute+"components/templates/platform-catalog-list-dir.html",link:function(t){t.options.enableCreate=_.isBoolean(t.options.enableCreate)?t.options.enableCreate:!!t.options.onCreated,t.options.enableSpeedEdit=_.isBoolean(t.options.enableSpeedEdit)?t.options.enableSpeedEdit:!!t.options.onSpeedEdit,t.options.enableLineEdit=_.isBoolean(t.options.enableLineEdit)?t.options.enableLineEdit:!!t.options.onLineEdited,t.options.enableSort=_.isBoolean(t.options.enableSort)?t.options.enableSort:!!t.options.onSorted,t.options.enableDelete=_.isBoolean(t.options.enableDelete)?t.options.enableDelete:!!t.options.onDeleted,t.displayList=[],t.options.setData=function(e){_.isArray(e)&&(t.displayList=_.sortBy(e,t.options.data.sortBy),t.options.data.selectedItem&&t.options.data.selectedItem.id?t.updateSelection(_.find(t.displayList,{id:t.options.data.selectedItem.id})):t.options.data.selectedItem&&t.options.data.selectedItem._id?t.updateSelection(_.find(t.displayList,{_id:t.options.data.selectedItem._id})):t.updateSelection(t.displayList[0]))},t.updateSelection=function(n){return t.lineEditing&&n!==t.options.data.selectedItem?void e.showWarmingTip("请先保存修改！"):(t.options.data.selectedItem=n,void t.options.onSelectedChanged.apply(this,arguments))},t.toggleLineEdit=function(e){return t.options.enableSpeedEdit?void t.options.onSpeedEdit.call(this,e):void(e===t.options.data.selectedItem&&(t.lineEditing=!t.lineEditing,t.lineEditing?t.options.data.selectedItem=e:t.options.onLineEdited.call(this,e)))},t.doSaveCreate=function(e){t.options.formOptions.$invalid||(t.options.onCreated(e),t.options.formOptions.setData({}))},t.options.setData(t.options.data.dataList);var n=t.$watch("options.data.dataList",function(e){t.options.setData(e)});t.options.formOptions&&(t.options.formOptions.data=t.options.formOptions.data||{}),t.$on("$destroy",function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformDynamicForm",["$http","$compile","$sce",function(t,n,i){return{restrict:"A",replace:!0,link:function(i,a,o){function r(e){var t=n(e)(i);a.html(t)}if(e.isDefined(o.template)){var s=i.$eval(o.template);s?r(s):i.$watch(o.template,function(e){r(e)})}else if(e.isDefined(o.templateUrl)){var l=i.$eval(o.template);t.get(l).then(function(e){r(e.data)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformGetHeight",[function(){return{restrict:"A",link:function(e,t,n){var i=e.$watch("dataList",function(){setTimeout(function(){var e=$("."+n.standard).outerHeight();e-=t.siblings().outerHeight(),t.height(e)},200)});e.$on("$destroy",function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformInput",[function(){return{restrict:"A",require:"?ngModel",template:'<input type="{{type}}" class="form-control nsw-form-input col-lg-8" data-ng-change="changed()" ng-model="model" autocomplete="off" ><span data-ng-hide="hideCounter" data-ng-bind="countTip"></span>',link:function(e,t,n,i){e.type=n.type,e.hideCounter=!n.ngMaxlength,i.$render=function(){e.model=i.$viewValue,a()},e.changed=function(){i.$setViewValue(e.model),a()};var a=function(){var t=e.model?e.model.length:0;e.countTip=t+"/"+n.ngMaxlength+"字符"}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformModalTransclude",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/platform-modal-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNavHint",["platformNavigationSvc","platformModalSvc",function(e,t){return{restrict:"A",scope:{dirtyChecker:"="},link:function(n,i){var a=function(e){if(!e.stop){var a=!!i.find(".ng-dirty").not(".hasDatepicker,.not-check-dirty").length;_.isFunction(n.dirtyChecker)&&(a=n.dirtyChecker.call(n,a)),a?e.confirm=t.showConfirmMessage("当前页面没有保存是否确认离开？","温馨提示").then(function(){return e.stop=!1,n.$emit("formDirtyInfo",e),!0},function(){return e.stop=!0,n.$emit("formDirtyInfo",e),!1}):n.$emit("formDirtyInfo",{dirty:!1})}};n.$on("checkFormDirty",function(){var e={};a(e)}),e.registerRouteWillUpdated(a),n.$on("$destroy",function(){e.unregisterRouteWillUpdated(a)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAutofocus",["$timeout",function(e){return{restrict:"A",link:function(t,n){e(function(){n[0].focus()},100)}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswBg",[function(){return{restrict:"A",link:function(e,t,n){var i=function(){var e=/^(http|https|ftp)?:\/\//,i=/^[..\\]{1}/,a=/^data:image\//,o=/^~\//,r=/^(http|https|ftp)?:\/\/mmbiz/,s=n.nswBg,l=!1;s||(s=globals.defaultImg,l=!0);var c=!1;if(s&&o.test(s))s=s.replace(o,globals.basAppRoot),l=!1;else if(s&&r.test(s))s=s.split("?")[0],l=!1;else if(s&&!e.test(s)&&!i.test(s)&&!a.test(s)){var u=globals.basImagePath;n.nswSrcPath&&(u=globals[n.nswSrcPath]),s=u+s,c=!0,l=!1}if(s){if(n.nswSrcSize&&c){var d=_.lastIndexOf(s,".");s=s.slice(0,d)+"_"+n.nswSrcSize+s.slice(d,s.length)}l?t.css({backgroundImage:'url("'+s+'")',backgroundSize:"100% 100%",backgroundPosition:"0 0 "}):t.css({backgroundImage:'url("'+s+'")',backgroundSize:"cover"})}};n.$observe("nswBg",function(){i()}),e.$evalAsync(function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswClipboard",["platformModalSvc",function(e){return{restrict:"A",link:function(t,n,i){n.on("click",function(){if("disabled"!==i.disable){var n=$("<textarea/>");n.text(i.nswClipboard),$("body").append(n),n.select();var a=!0;try{a=document.execCommand("copy")}catch(o){a=!1}n.remove(),a?e.showSuccessTip("拷贝到剪切板成功!"):e.showModal({size:"sm",templateUrl:globals.basAppRoute+"components/templates/platform-clipboard-error-dialog.html",options:{content:i.nswClipboard}}),i.onCopy&&t.$eval(i.onCopy,{$event:{data:i.nswClipboard}})}})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswComboBox",["$compile",function(){return{restrict:"A",require:"ngModel",scope:{nswChildren:"@",nswData:"=",nswDisplay:"@",nswKey:"@"},priority:1e3,templateUrl:globals.basAppRoute+"components/templates/platform-nsw-combo-box-dir.html",link:function(e,t,n,i){var a="　　　　　　　　　　　　　　　　　　",o=function r(t,n,i){return t=_.isArray(t)?t:[t||{}],i=i||0,n=n||[],_.forEach(t,function(t){var o={};o.key=t[e.nswKey],o.display=t[e.nswDisplay],o.spaces=new Array(i),o._source=t,n.push(o),t[e.nswChildren]?(o.display=a.slice(0,i)+"└　"+o.display,r(t[e.nswChildren],n,i+1)):o.display=a.slice(0,i)+"├"+o.display}),n};e.onChange=function(){var a=e.collection[$("select",t)[0].selectedIndex];a&&(i.$setViewValue(a._source),t.parent().controller("form").$setDirty()),n.ngChange&&e.$parent.$eval(n.ngChange),e.collection=o(e.nswData),i.$dirty=!0},i.$render=function(){e.model=i.$viewValue;var t={};e.model&&e.model[e.nswKey]?(t.key=e.model[e.nswKey],e.model=_.find(e.collection,t),e.collection=o(e.nswData)):e.model=null},e.isSelected=function(t){return!(!e.model||!t)&&e.model.key===t.key},e.collection=o(e.nswData),i.$render(),e.$watch("nswData",function(t){e.collection=o(t),i.$render()}),e.$evalAsync(function(){t.find("select").on("change",e.onChange)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswCommit",[function(){return{restrict:"A",link:function(e,t,n){var i=n.nswCommit||(t.closest("form")?t.closest("form").attr("name"):"");i&&e[i]&&t.bind("click",function(){e[i].$setPristine()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswDraggable",[function(){return{restrict:"A",scope:{drag:"&",drop:"&",options:"&"},link:function(e,t){e.onDrag=function(t){e.select({source:t})},e.onDrop=function(t,n){e.select({source:t,target:n})},e.$evalAsync(function(){t.draggable(e.options)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFileuploader",["$http","platformModalSvc","platformMessenger",function(t,n,i){return{restrict:"A",transclude:!0,scope:{config:"=",uploader:"="},template:'<div>             <div id="uploader" style="position: relative;left: 44%" ng-hide="uploading" data-ng-transclude/>             <div style="position:relative;z-index:12;pointer:cursor;" ng-show="uploading" nsw-progress-bar data-cancel="cancel" data-ng-model="status" data-hint="hint" data-show-hint-in="6" data-show-percentage-in="6">               <button class="btn btn-default btn-color btn-cancel progress-publish-btn" type="button" ng-click="cancel()">                   <label class="checkcancel"></label>                   <span class="btntext black">取&nbsp;消</span>               </button>             </div>              <div ng-if="uploading" class="progress-mask" style="background:#000 filter:alpha(opacity = 0.01) opacity:1;position:fixed;left:0;top:0;width:100%;height:100%;z-index:2;"></div>          </div>',link:function(i,a){var o,r=(new Date).getTime(),s=$("#uploader").html(),l=i.config?i.config:{},c={auto:!0,server:"/pccms/file/upload?taskId="+r,swf:"/pccms/plugin/ueditor/third-party/webuploader/Uploader.swf",formData:{},fileVal:"file",extensions:"zip",mimeTypes:"application/x-zip-compressed",multiple:!1,duplicate:!0,beforeFileQueued:null,fileQueued:null,uploadStart:null,uploadProgress:null,uploadSuccess:null,uploadError:null,uploadComplete:null,uploadFinished:null,error:null};e.extend(c,l);var u=function(e){t({method:"POST",url:"/pccms/progress/file?taskId="+r,data:{taskId:r}}).success(function(t){if(t.isSuccess){t=JSON.parse(t.message);var a=void 0===t.percent?0:t.percent;switch(i.hint=void 0===t.hint?"上传并解压中...":t.hint,i.status=a,parseInt(t.index)){case 0:case 3:i.status=a,i.uploading=!0;break;case 1:case 2:i.status="100",i.unziping=!1,i.uploading=!1,n.showWarmingMessage(i.hint,"温馨提示").then(function(){i.status="0"}),y(),clearInterval(e);break;case 4:case 5:i.hint="上传并解压中...",i.unziping=!0;break;default:i.status="100",i.uploading=!1,i.hint="上传并解压监控失败:"+i.hint,n.showWarmingMessage(i.hint,"温馨提示").then(function(){i.status="0"}),y(),clearInterval(e),console.error(t)}i.status=parseInt(i.status),100===i.status&&(i.hint="上传并解压中...",i.unziping=!0)}else n.showWarmingMessage("上传并解压监控失败："+t.message,"温馨提示")}).error(function(e){console.error(e),setTimeout(function(){n.showWarmingMessage("网络故障请重新上传！","温馨提示").then(function(){i.status="0"}),i.uploading=!1,y()},3e3)})};i.cancel=function(){n.showConfirmMessage("确认取消上传？","温馨提示").then(function(){i.status="0",clearInterval(o),i.unziping=!1,i.uploading=!1,y()})};var d,p=function(e){return"zip"!==e.ext.toLowerCase()?(n.showWarmingMessage("文件的类型不正确，请选择zip格式文件！","温馨提示"),!1):"function"==typeof c.beforeFileQueued?c.beforeFileQueued.apply(this,[d,e]):void 0},m=function(e){"function"==typeof c.fileQueued&&c.fileQueued.apply(this,[d,e])},f=function(e){"function"==typeof c.uploadStart&&c.uploadStart.apply(this,[d,e]),i.uploading=!0,o=setInterval(function(){u(o)},1e3)},g=function(e,t){"function"==typeof c.uploadSuccess&&c.uploadSuccess.apply(this,[d,e,t])},h=function(e){"function"==typeof c.uploadError&&c.uploadError.apply(this,[d,e])},v=function(e){"function"==typeof c.uploadComplete&&c.uploadComplete.apply(this,[d,e])},w=function(e){"function"==typeof c.uploadFinished&&c.uploadFinished.apply(this,[d,e])},b=function(e){"function"==typeof c.error&&c.error.apply(this,[d,e])},y=function(){d&&(d.stop(),d.reset(),$("#uploader",a).children().remove(),$("#uploader").html(s)),r=(new Date).getTime(),c.server="/pccms/file/upload?taskId="+r,i.hint="",d=WebUploader.create({auto:c.auto,swf:c.swf,server:c.server,pick:{id:"#uploader",label:c.label,multiple:c.multiple},fileVal:c.fileVal,accept:{title:"zip",extensions:c.extensions,mimeTypes:c.mimeTypes},duplicate:c.duplicate,button:a,formData:c.formData}),d.on("beforeFileQueued",p),d.on("fileQueued",m),d.on("uploadStart",f),d.on("uploadSuccess",g),d.on("uploadError",h),d.on("uploadComplete",v),d.on("uploadFinished",w),d.on("error",b)};y(),"function"==typeof i.uploader&&i.uploader(d),l.stopUploader=function(){o&&clearInterval(o),y()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswGroupSelector",[function(){return{restrict:"A",scope:{onSelectAll:"&",onReverseSelect:"&",listGetter:"=",selectedItemsGetter:"="},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-group-selector.html",link:function(e,t,n){e.selectAll=function(t){var n=e.selectedItemsGetter.call(this),i=e.listGetter.call(this);
e.allSelected=t,n.length=0,t&&_.forEach(i,function(e){n.push(e)}),e.onSelectAll({selectedItems:e.selectedItems})},e.reverseSelect=function(){var t=e.selectedItemsGetter.call(this),n=e.listGetter.call(this);_.forEach(n,function(e){_.find(t,e)?_.remove(t,e):t.push(e)}),e.onReverseSelect({selectedItems:e.selectedItems})};var i=e.$watchCollection(e.selectedItemsGetter,function(){var t=e.selectedItemsGetter.call(this),n=e.listGetter.call(this);e.allSelected=n.length===t.length}),a=e.$watchCollection(e.listGetter,function(){var t=e.selectedItemsGetter.call(this),n=e.listGetter.call(this);e.allSelected=n.length&&n.length===t.length});e.$on("$destroy",function(){i(),a()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswHref",[function(){return{restrict:"A",link:function(e,t,n){var i=function(){var e=/^(http|https|ftp)?:\/\//,i=/^[..\\]{1}/,a=/^data:image\//,o=/^~\//,r=/^(http|https|ftp)?:\/\/mmbiz/,s=n.nswHref;!s&&t[0]&&_.isString(t[0].tagName)&&"img"===t[0].tagName.toLowerCase()&&(s=globals.defaultImg);var l=!1;if(s&&o.test(s))s=s.replace(o,globals.basAppRoot);else if(s&&r.test(s))s=s.split("?")[0];else if(s&&!e.test(s)&&!i.test(s)&&!a.test(s)){var c=globals.basImagePath;n.nswSrcPath&&(c=globals[n.nswSrcPath]),s=c+s,l=!0}if(s){if(n.nswSrcSize&&l){var u=_.lastIndexOf(s,".");".gif"!==s.slice(u,s.length)&&(s=s.slice(0,u)+"_"+n.nswSrcSize+s.slice(u,s.length))}t.attr("href",s)}};n.$observe("nswHref",function(){i()}),e.$evalAsync(function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswHtml",["$http","$compile","$sce",function(e,t,n){return{restrict:"A",replace:!0,link:function(e,t,n){var i=function(){t.html(n.nswHtml)};n.$observe("nswHtml",function(){i()}),e.$evalAsync(function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswLazyscroll",[function(){return{restrict:"A",link:function(e,t,n){var i=parseInt(n.step)||1,a=parseInt(n.currentStep)||0,o=function(){var o=t.scrollTop(),r=parseInt(o/i)+(o%i>0?1:0);r!==a&&n.nswStepChange&&(e.$eval(n.nswStepChange).call(this,{target:t,step:i,current:r}),a=r,e.$digest())};n.$observe("count",function(e){$(t.find(".step-target")).height(i*e)}),t.scroll(o)}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformNswListMaterial",[function(){return{restrict:"A",scope:{material:"=",remove:"&",edit:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-list-material-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("platformNswMaterial",[function(){return{restrict:"A",scope:{material:"=",remove:"&",edit:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-material-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("nswProgressBar",[function(){return{restrict:"A",require:"ngModel",transclude:!0,scope:{showPercentageIn:"@",showHintIn:"@",hint:"=",cancel:"="},template:'<div class="index-progress">               <div class="progress" >                   <div class="progress-bar progress-bar-success"  role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"  ng-style="style">                      <div class="progress-content">                          <span ng-bind="hint"></span>                          <span ng-bind="progress"></span>                       </div>                   </div>                </div>               <div id="transclude" data-ng-transclude />           </div>',link:function(e,t,n,i){i.$render=function(){e.progress=i.$viewValue+"%";var t=parseInt(e.showHintIn||"6"),n=parseInt(e.showPercentageIn||"6");e.displayHint=i.$viewValue>=t&&i.$viewValue<=100,e.displayPercentage=i.$viewValue>=n&&i.$viewValue<=100,i.$viewValue>=100?$("#transclude").hide():$("#transclude").show(),$(".progress-bar.progress-bar-success").css("width",e.progress)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswSortable",[function(){return{restrict:"A",scope:{nswSortableEnable:"=",updated:"&",items:"=",child:"@"},link:function(e,t,n){var i;e.onUpdated=function(n,i){var a=[];_.forEach(t.children(),function(t){var n=$(t).scope();if(n){var i=n.$eval(e.child);_.find(e.items,i)&&(a.push(i),_.remove(e.items,i))}}),_.forEach(a,function(t){e.items[e.items.length]=t}),e.updated({source:e.items}),e.$digest()},e.onDrop=function(t,n){e.select({source:t,target:n})},e.$evalAsync(function(){e.options=e.options||{},e.options.items=">*",n.exclude&&(e.options.items+=":not("+n.exclude+")"),e.options.update=e.onUpdated,e.options.disabled=!e.nswSortableEnable,i=t.sortable(e.options)}),e.$watch("nswSortableEnable",function(t){e.options=e.options||{},i&&i.sortable({disabled:!t})})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswSrc",[function(){return{restrict:"A",link:function(e,t,n){var i=function(){var e=/^(http|https|ftp)?:\/\//,i=/^[..\\]{1}/,a=/^data:image\//,o=/^~\//,r=/^(http|https|ftp)?:\/\/mmbiz/,s=n.nswSrc;!s&&t[0]&&_.isString(t[0].tagName)&&"img"===t[0].tagName.toLowerCase()&&(s=globals.defaultImg);var l=!1,c=new RegExp(globals.basImagePath,"i");if(s&&o.test(s))s=s.replace(o,globals.basAppRoot);else if(s&&r.test(s))s=s.split("?")[0];else if(!s||e.test(s)||i.test(s)||a.test(s))c.test(s)&&(l=!0);else{var u=globals.basImagePath;n.nswSrcPath&&(u=globals[n.nswSrcPath]),s=u+s,l=!0}s&&(n.nswSrcSize&&l&&(s=s+"?imageMogr2/thumbnail/"+n.nswSrcSize.replace(/\*/g,"x")),t.attr("src",s))};n.$observe("nswSrc",function(){i()}),e.$evalAsync(function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswStatusButton",[function(){return{restrict:"A",replace:!1,scope:!0,require:"ngModel",templateUrl:globals.basAppRoute+"components/templates/platform-nsw-status-button-dir.html",link:function(e,t,n,i){e.isChecked=!!i.$viewValue,i.$render=function(){e.isChecked=!!i.$viewValue},e.onClick=function(a){a.stopPropagation(),t.attr("disabled")||(e.isChecked=!e.isChecked,i.$setViewValue(e.isChecked),n.ngClick&&e.$parent.$eval(n.ngClick))}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPagenation",[function(){return{restrict:"A",scope:{searchOptions:"=",nswRefresh:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-pagenation-dir.html",link:function(e){e.pagesList=[],e.hasVal=!0,e.searchOptions.pageNum=e.searchOptions.pageNum||1;var t=e.$watch("searchOptions.totalRows",function(t){t?e.hasVal=!0:e.hasVal=!1}),n=e.$watch("searchOptions.totalPages",function(t){e.pagesList=[];for(var n=1;n<=t;n++)e.pagesList.push(n)});e.goNext=function(){e.searchOptions.pageNum<e.searchOptions.totalPages&&(e.searchOptions.pageNum++,e.nswRefresh({options:e.searchOptions}))},e.getPrevious=function(){e.searchOptions.pageNum>1&&(e.searchOptions.pageNum--,e.nswRefresh({options:e.searchOptions}))},e.goPage=function(){_.isNumber(e.searchOptions.pageNum)&&e.nswRefresh({options:e.searchOptions})},e.$on("$destroy",function(){n(),t()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswPopover",function(){return{restrict:"A",link:function(e,t){t.parent().hover(function(){t.popover("show")},function(){t.popover("hide")})}}})}(angular),function(e){"use strict";e.module("platform").directive("nswPopovertip",["$compile",function(e){return{restrict:"A",scope:!0,transclude:!0,template:'<div data-toggle="popover" data-placement="{{dir}}">               <div class="hide container" data-ng-transclude></div>            </div>',link:function(t,n,i){var a=n.find(".container").html();t.dir=i.dir;var o=function(){n.find("[data-toggle='popover']").popover("show")},r=function(){n.find("[data-toggle='popover']").popover("hide")},s=function(){n.siblings().on("mouseover",o),n.siblings().on("mouseout",r)},l=function(){n.siblings().off("mouseover",o),n.siblings().off("mouseout",r)},c=function(){l();var i=e(a)(t);n.children().popover({html:!0,content:i}),s()},u="";t.$evalAsync(function(){c(),t.$watch(function(){var e=u!==n.html();return u=n.html(),e},function(){c()})})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformQrCode",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$render=function(){if(i.$viewValue){var e=parseInt(n.width)||150,a=parseInt(n.height)||150;t.children().remove(),t.qrcode({text:i.$viewValue,width:e,height:a})}}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("utils",["$rootScope","$location","$http","$modal",function(e,t,n,i){function a(e,t,n,a,o){i.open({template:'<div class="defa-font"><div class="modal-header"><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><p ng-bind-html="msg"></p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()"><span class="glyphicon glyphicon-ok"></span> '+(o?o:"确定")+"</button></div></div>",controller:["$scope","$modalInstance",function(n,i){n.title=e,n.msg=t,n.ok=function(){i.close()}}],backdrop:"static",size:a?a:"sm"}).result.then(function(){void 0!==n&&n()})}function o(e,t,n,a,o){i.open({template:'<div class="defa-font"><div class="modal-header"><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><p>{{msg}}</p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()"><span class="glyphicon glyphicon-ok"></span> 确定</button><button class="btn btn-default" ng-click="cancel()"><span class="glyphicon glyphicon-remove"></span> 取消</button></div></div>',controller:["$scope","$modalInstance",function(n,i){n.title=e,n.msg=t,n.ok=function(){i.close()},n.cancel=function(){i.dismiss()}}],backdrop:"static",size:o?o:"sm"}).result.then(function(){n()},function(){void 0!==a&&a()})}function r(e,t,n,a,o,r){var s=[];s[s.length]='<div class="modal-header">',s[s.length]='    <h3 class="modal-title">'+e+"</h3>",s[s.length]="</div>",s[s.length]='<div class="modal-body">'+t+"</div>",s[s.length]='<div class="modal-footer">',s[s.length]='    <button class="btn btn-primary" type="button" ng-click="ok()">'+(r?r:"确定")+"</button>",s[s.length]='    <button class="btn btn-default" type="button" ng-click="cancel()">取消</button>',s[s.length]="</div>",i.open({template:s.join(""),controller:["$scope","$modalInstance",function(i,o){i.title=e,i.msg=t,i.ok=function(){var e=!1;if(void 0===n)e=!0;else if("function"==typeof n){var t=n();(t||void 0===t)&&(e=!0)}e&&o.close()},i.cancel=function(){var e=!1;if(void 0===a)e=!0;else if("function"==typeof a){var t=a();(t||void 0===t)&&(e=!0)}e&&o.dismiss()}}],backdrop:"static",size:o?o:""})}function s(e){i.open({template:'<div class="c-dialog-img-preview"><i class="fa fa-times" ng-click="close();"></i><img src="'+e+'"/></div>',controller:["$scope","$modalInstance",function(e,t){e.close=function(){t.close()}}],backdrop:"static",size:""})}return{alertBox:a,confirmBox:o,openWin:r,imgPreview:s,helpBox:function(e,t){i.open({template:'<div class="defa-font"><div class="modal-body help"><img class="w-100" nsw-src="{{asset(image)}}" /></div><div class="modal-footer"><button class="btn btn-default" ng-click="close()"><span class="glyphicon glyphicon-remove"></span> 关闭</button></div></div>',controller:["$scope","$modalInstance",function(t,n){t.image=e,t.close=function(){n.close()}}],backdrop:"static",size:t?t:"md"})}}}]).directive("templateLib",["$modal","$parse","platformModalSvc",function(e,t,n){return{restrict:"A",link:function(e,t,i){t.click(function(){n.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"/components/templates/platform-template-view.html",controller:"templateLib",size:"lg"})})}}}]).controller("templateLib",["$scope","$http","utils",function(e,t,n){t({method:"GET",url:"/pccms/editorTpl/editorTplList?pageNum=1&pageSize=1000"}).success(function(t){e.templateLib=t.data.list}),e.imgPreview=function(e,t){n.imgPreview(e),t.stopPropagation()},e.selectImg=function(t){e.selected=t},e.commit=function(){e.closeModal(!0,{template:e.selected,replace:e.checked})},e.checked=!0}])}(angular),function(e){"use strict";e.module("platform").directive("platformUeditor",[function(){return{restrict:"A",require:"ngModel",scope:{simple:"@",maxWord:"@"},template:'<div ueditor ng-model="model" config="config" ng-change="change()"></div>',link:function(e,t,n,i){var a={initialFrameWidth:"100%",maximumWords:2e4,initialFrameHeight:450,themePath:globals.basAppRoot+"plugin/ueditor/themes/",langPath:globals.basAppRoot+"plugin/ueditor/lang/",serverUrl:"",UEDITOR_HOME_URL:globals.basAppRoot+"plugin/ueditor/"},o={maximumWords:150,initialFrameWidth:"90%",initialFrameHeight:100,themePath:globals.basAppRoot+"plugin/ueditor/themes/",langPath:globals.basAppRoot+"plugin/ueditor/lang/",serverUrl:"",UEDITOR_HOME_URL:globals.basAppRoot+"plugin/ueditor/",toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","|","forecolor","backcolor","|","fontfamily","fontsize","|","justifyleft","justifycenter","justifyright","justifyjustify","|","link"]]};setTimeout(function(){e.config=Boolean(e.simple)?o:a,e.config.maximumWords=Number(e.maxWord)}),e.change=function(){i.$setViewValue(e.model)},e.$render=function(){e.model=i.$viewValue}}}}])}(angular),function(e){"use strict";e.module("platform").directive("beyond",function(){return{restrict:"ACE",replace:!0,link:function(e,t){var n=$(t.find(".form-control[ng-model],.form-control[data-ng-model],.editor[ng-model],.editor[data-ng-model]")[0]),i=n.data("$ngModelController");if(i){var a=function(){var n=i.$viewValue;t.find(".mess-zx").html(n&&n.length?n.length:0),e.$root.$$phase||e.$apply()};e.$evalAsync(function(){var e=i.$render;i.$render=function(){e.apply(this,arguments),a()},a()}),n.on("keyup",function(){a()}),i.$viewChangeListeners.push(a)}}}})}(angular),function(e){"use strict";e.module("platform").directive("platformWaterfall",["$timeout",function(e){return{restrict:"A",link:function(t,n){var i=function(){for(var e=0,t=n.find("li"),i=t.outerWidth(),a=3,o=0;o<t.length;o++)o<a?$(t[o]).css({top:"0px",left:o*(i+17)+"px"}):$(t[o]).css({top:$(t[o-a]).position().top+$(t[o-a]).outerHeight()+12+"px",left:$(t[o-a]).position().left}),$(t[o]).position().top+$(t[o]).outerHeight()>e&&(e=$(t[o]).position().top+$(t[o]).outerHeight());n.css({height:e+"px",visibility:"visible"})},a=t.$watch("dataList",function(t){t&&t.length&&e(function(){i()},10)},!0);t.$on("ngRepeatFinished",function(){i()}),t.$on("destory",function(){a()})}}}]).directive("onFinishRenderFilters",["$timeout","nswGlobals",function(e,t){return{restrict:"A",link:function(t){t.$last===!0&&e(function(){t.$emit("ngRepeatFinished")},50)}}}])}(angular),function(e){"use strict";e.module("platform").directive("getKeyWord",[function(){return{restrict:"A",scope:{keyWord:"="},require:"ngModel",link:function(e,t,n,i){i.$render=function(){var n=i.$viewValue.toString();if(e.keyWord){var a=new RegExp(e.keyWord,"ig");n=n.replace(a,"<font color='red'>"+e.keyWord+"</font>")}t.html(n)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("signKeyWord",[function(){return{restrict:"A",scope:{keyWord:"="},require:"ngModel",link:function(e,t,n,i){i.$render=function(){var n=i.$viewValue.toString();if(e.keyWord){var a=new RegExp(e.keyWord,"ig");n=n.replace(a,"<font color='red'>"+e.keyWord+"</font>")}t.html(n)}}}}])}(angular),function(e){"use strict";e.module("platform").factory("adlibBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("adlib"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||"")},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").service("baseTemplateBuilder",["$templateCache",function(t){return function(){var n={};n.nameFormat="form-%name%.html",n.init=function(e,t){n.form=e,n.editor=t,a()},n.getTemplate=function(e,i){e=n.nameFormat.replace(/%name%/g,e);var a=t.get(e);return n.template=i?n.template:a,a},n.buildTemplateKey=function(e,t){n.template=n.template.replace(e,t)},n.buildConfigurations=function(){return e.forEach(n.configuration,function(e){n.buildTemplateKey(e.key,e.value)}),n.template},n.addConfiguration=function(e){_.isUndefined(e)||(_.isArray(e)||(e=[e]),_.isRegExp(arguments[0])&&!_.isUndefined(arguments[0])&&(e=[{key:arguments[0],value:arguments[1]}]),_.forEach(e,function(e){n.configuration.unshift(e)}))};var i="col-md-%s% col-lg-%s% col-sm-%s% col-xs-%s%",a=function(){n.configuration=[{key:/%formName%/g,value:n.form.name||""},{key:/%name%/g,value:n.editor.name||""},{key:/%default%/g,value:n.editor["default"]||""},{key:/%lookup%/g,value:n.editor.lookup||""},{key:/%size%/g,value:i.replace(/%s%/g,n.editor.size)},{key:/%type%/g,value:n.editor.type||""},{key:/%model%/g,value:"data."+n.editor.model||""},{key:/%directive%/g,value:n.editor.directive||""},{key:/%options%/g,value:n.editor.options||""},{key:/%maxLength%/g,value:n.editor.maxLength||""},{key:/%maxWord%/g,value:n.editor.maxWord||""},{key:/%label%/g,value:n.editor.label||""},{key:/%placeholder%/g,value:n.editor.placeholder||""},{key:/%validators%/g,value:n.editor.validateDirectives||""},{key:/%id%/g,value:n.editor.id||""}]};return n}}])}(angular),function(e){"use strict";e.module("platform").factory("checkboxBuilderSvc",["baseTemplateBuilder",function(e){var t={},n=new e;return t.init=function(e,t){n.init(e,t);var i=n.getTemplate("checkbox",!0);n.getTemplate("radioGroup");var a=[];_.forEach(n.editor.options,function(e){var t=i.replace(/%checked%/g,!!e.checked).replace(/%key%/g,e[n.editor.key]).replace(/%model%/g,"data."+e.parent+"."+e.model).replace(/%display%/g,e[n.editor.display]);a.push(t)}),n.addConfiguration(/%content%/g,a.join("\r\n"))},t.build=function(){return n.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").service("htmleditorBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("htmleditor"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||""),a.addConfiguration(/%simple%/g,!!i.isSimple)},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").service("inputBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("input"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||"")},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").factory("labelBuilderSvc",["baseTemplateBuilder",function(e){var t={},n=new e;return t.init=function(e,t){if(n.init(e,t),n.getTemplate("label"),t.hasLabel){var i=t.required?n.getTemplate("required",!0):"";n.addConfiguration(/%required%/g,i)}else n.template="",n.configuration=[]},t.build=function(){return n.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("radioBuilderSvc",["baseTemplateBuilder",function(e){var t={},n=new e;return t.init=function(e,t){n.init(e,t);var i=n.getTemplate("radio",!0);n.getTemplate("radioGroup");var a=[];_.forEach(n.editor.options,function(e){var t=i.replace(/%checked%/g,!!e.checked).replace(/%key%/g,e[n.editor.key]).replace(/%display%/g,e[n.editor.display]);a.push(t)}),n.addConfiguration(/%content%/g,a.join("\r\n"))},t.build=function(){return n.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("rowBuilderSvc",["baseTemplateBuilder","$injector","labelBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("row");var o=t.get(i.template+"BuilderSvc");o.init(e,i),n.init(e,i);var r=n.build(),s=o.build();a.addConfiguration(/%label%/g,r),a.addConfiguration(/%content%/g,s)},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").service("selectBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("select"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||""),a.addConfiguration(/%key%/g,i.key||""),a.addConfiguration(/%display%/g,i.display||"")},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").factory("singleimageBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("single-image"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||"")},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").service("textareaBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,n){var i={},a=new e;return i.init=function(e,i){a.init(e,i),a.getTemplate("textarea"),t.init(e,i),n.init(e,i),a.addConfiguration(/%errors%/g,t.build()),a.addConfiguration(/%validateTip%/g,n.build()),a.addConfiguration(/%validators%/g,i.validateDirectives||""),a.addConfiguration(/%rows%/g,i.rows||"3")},i.build=function(){return a.buildConfigurations()},i}])}(angular),function(e){"use strict";e.module("platform").factory("validationBuilderSvc",["baseTemplateBuilder",function(e){var t={},n=new e;return t.init=function(e,t){n.getTemplate("errorContainer"),n.init(e,t);var i=n.getTemplate("error",!0);t.validates=t.validates||[],t.required&&!_.find(t.validates,{type:"required"})&&t.validates.push({type:"required",message:"请填写%label%",directive:"data-ng-required=true"}),t.maxLength&&!_.find(t.validates,{type:"nswmaxlength"})&&t.validates.push({type:"nswmaxlength",message:"%label%长度为0~%maxLength%字符",directive:'data-nsw-max-length="'+t.maxLength+'"'}),t.maxWord&&!_.find(t.validates,{type:"maxword"})&&t.validates.push({type:"maxword",message:"%label%使用逗号、空格和分隔符，并不能超过%maxWord%个关键字",directive:'data-maxword="'+t.maxWord+'"'});var a=[];_.forEach(n.editor.validates,function(e){var t=i.replace(/%error%/g,e.type).replace(/%errorMessage%/g,e.message);a.push(t)}),t.validateDirectives=_.map(t.validates,"directive").join(" "),n.addConfiguration(/%content%/g,a.join("\r\n"))},t.build=function(){return n.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("validationTipBuilderSvc",["baseTemplateBuilder",function(e){var t=new e,n={};return n.init=function(e,n){t.init(e,n),n.hasValidateTip&&n.validateTip?t.getTemplate(n.validateTip+"-tip"):(t.template="",t.configuration=[])},n.build=function(){return t.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").factory("nswimagePluginSvc",["platformImgLibSvc","nswGlobals","$rootScope",function(e,t,n){var i={};return i.init=function(){KindEditor.plugin("nswimage",function(){var t=this,n="nswimage",i=null;t.lang({nswimage:"从图片库中选择图片"});var a=function(e){for(;e&&!e.isBlock();)e=e.parent();return e},o=function(e){return!(e||"").replace(/\s{1,}|\u200B{1,}/gi,"")},r=function(e){var t=e.fileId;/^[http|https]/g.test(e.fileId)||(t=globals.basImagePath+t);var n=window.KindEditor("<img/>");return n.css("max-width","100%"),n.attr("src",t),n.attr("data-ke-src",t),n.attr("align",e.align),n.attr("title",e.name||e.fileName),n.attr("alt",e.name||e.fileName),n},s=function(e,n,i,a){return"body"===e.name&&(1===e.children().length?"p"===e.first().name?e=e.first():e.first().isBlock()?(e=e.first(),e.append("<p></p>"),e=e.last()):(e.append("<p></p>"),e=e.last()):(e.append("<p></p>"),e=e.last()),t.cmd.range.setStart(e,0),t.cmd.range.setEnd(e,0)),"p"===e.name&&_.forEach(e.children(),function(e){"#text"===e.nodeName&&o(e.nodeValue)&&e.remove()}),"p"!==e.name||KindEditor("img",e).length?(e.after("<p></p>"),e=e.next()):"p"===e.name&&e.first()&&"br"===e.first().name&&e.first().remove(),e.css("text-align","center"),e.css("text-indent","0px"),e.css("padding-top","14px"),e.css("margin","0px"),i&&e.attr(i),e.append(n),e},l=function(e){var n=!o(t.cmd.range.startContainer.textContent),l=KindEditor.range(t.container.doc);l.selectNode(KindEditor(t.cmd.range.endContainer)[0]);var c=t.cmd.range.compareBoundaryPoints(KindEditor.END_TO_START,l)>=0;n=n&&!c;var u=r(e);if(!n){var d=a(KindEditor(t.cmd.range.startContainer)),p=s(d,u,i,e.align);return t.cmd.range.setStartAfter(u[0]),p}t.cmd.range.insertNode(u[0]),t.cmd.range.setStartAfter(u[0])},c=function(e,n){i=null,l(e),t.sync(),KindEditor(n).fire("mouseup"),t.blur()},u=function(t){return e.showImgLibModal({count:1,size:300,width:800,height:800,ext:"gif,jpg,jpeg,bmp,png"}).then(function(e){c(e,t)})};t.plugin.nswmultiimage={edit:function(){u($(this.container[0]).find("iframe")[0].contentDocument)}},t.clickToolbar(n,t.plugin.nswmultiimage.edit)})},i}])}(angular),function(e){"use strict";e.module("platform").factory("nswmultiimagePluginSvc",["platformModalSvc","nswGlobals",function(e,t){var n={};return n.init=function(){KindEditor.plugin("nswmultiimage",function(){var t=this,n="nswmultiimage",i=null;t.lang({nswmultiimage:"批量图片上传"});var a=function(e){t.exec("insertimage",e.url,e.fileName,null,null,null,null,null);for(var n=t.cmd.commonNode({img:"*"}),a=n.parent();a&&a.name&&"body"!==a.name&&"p"!==a.name;)a=a.parent();if(a&&"p"===a.name||(n.after("<p></p>"),a=n.next(),a.append(n),i&&a.attr(i),a.css("text-indent","0px"),a.css("text-align","center")),a){null===i&&(i=a.attr()),n.after('<p class="image-holder" style="display: none">HOLDER</p>');var o=n.next();t.cmd.range.selectNode(o[0])}},o=function(e,t){for(i=null,_.forEach(e,a);KindEditor.query(".image-holder",t);)KindEditor.query(".image-holder",t).remove()},r=function(t){return e.showModal({templateUrl:globals.basAppRoot+"/partials/imglibWin.html",controller:"imglibWinCtrl",size:"lg",options:{showAlign:!0,imgConfig:{count:15,size:3e3,width:800,height:600,ext:"gif,jpg,jpeg,bmp,png"},backImgList:[]}}).then(function(e){o(e,t)})};t.plugin.nswmultiimage={edit:function(){r($(this.container[0]).find("iframe")[0].contentDocument)}},t.clickToolbar(n,t.plugin.nswmultiimage.edit)})},n}])}(angular),function(e,t){"use strict";e.module("platform").factory("nswPreviewPluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("nswpreview",function(e){var t=this,n="nswpreview";t.lang({nswpreview:"PC预览"}),t.clickToolbar(n,function(){var i='<div style="padding:10px 20px;"><iframe class="ke-textarea" frameborder="0" style="width:100%;height:550px;"></iframe></div>',a=t.createDialog({name:n,width:"80%",title:t.lang(n),body:i}),o=e("iframe",a.div),r=e.iframeDoc(o);r.open(),r.writeln('<base href="'+globals.basImagePath+'">'),r.writeln('<link href="'+globals.basAppRoute+'components/content/css/kindeditor/kind-editor-reset.css" rel="stylesheet">'),r.write(t.fullHtml()),r.close(),e(r.body).css("background-color","#FFF"),o[0].contentWindow.focus()})})},e}])}(angular,void 0),function(e,t){"use strict";e.module("platform").factory("nswPreviewPhonePluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("nswpreviewphone",function(e){var t=this,n="nswpreviewphone";t.lang({nswpreviewphone:"手机预览"}),t.clickToolbar(n,function(){var i='<div style="padding:10px 20px;" class="phone-box"><iframe class="ke-textarea" frameborder="0" style="width:320px;height:480px;"></iframe></div>',a=t.createDialog({name:n,width:350,title:t.lang(n),body:i}),o=e("iframe",a.div),r=e.iframeDoc(o);r.open(),r.writeln('<base href="'+globals.basImagePath+'">'),r.writeln('<link href="'+globals.basAppRoute+'components/content/css/kindeditor/kind-editor-reset.css" rel="stylesheet">'),r.write(t.fullHtml()),r.close(),e(r.body).css("background-color","#FFF"),o[0].contentWindow.focus()})})},e}])}(angular,void 0),function(e){"use strict";e.module("platform").factory("reformatPluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("reformat",function(e){function t(e){for(var t=e.first();t&&t.first();)t=t.first();return t}var n=this,i="reformat",a=e.toMap("blockquote,center,div,h1,h2,h3,h4,h5,h6,p");n.lang({reformat:"自动排版"}),n.clickToolbar(i,function(){var i=e.dialog({width:240,title:"温馨提示",body:'<div style="margin:10px;"><strong>对齐文本功能将取消之前你设置好的所有文本样式</strong></div>',closeBtn:{name:"关闭",click:function(){i.remove()}},yesBtn:{name:"确定",click:function(){function o(t){if("div"===t.name&&t.hasAttr("style")&&t.hasAttr("class")||"#text"===t.name||"body"===t.name){var n=t.html();return""===n?"body"!==t.name&&o(e(s.body)):(n="<p style='text-indent:2em;'>"+n.replace(/(<br[^>]*\/>)/gi,"</p><p style='text-indent:2em;'>")+"</p>",n=n.replace(/<p style='text-indent:2em;'><\/p>/g,""),t.html(n),!0)}}n.focus();var r,s=n.edit.doc,l=e(s.body).first(),c=[],u=[];if(l&&o(l)!==!0){for(;l;){r=l.next();var d=t(l);if("<br />"===l.html())r=l.next(),l.remove();else{if(d&&"img"===d.name){if(d&&"img"===d.name){var p=!0;e(l).scan(function(e){if("IMG"!==e.nodeName&&"#text"!==e.nodeName)return p=!1,!1}),p&&l.css("text-indent",0)}}else a[l.name]?(l.html(l.html().replace(/^(\s|&nbsp;|　)+/gi,"")),l.css("text-indent","2em")):u&&u.push(l),(!r||a[r.name]||a[l.name]&&!a[r.name])&&(u.length>0&&c.push(u),u=[]);l=r}}e.each(c,function(t,n){var i=null;i=e('<p style="'+("img"===n[0].name?"text-align:center":"text-indent:2em")+';"></p>',s),n[0].before(i),e.each(n,function(e,t){i.append(t)})})}n.addBookmark(),i.remove()}},noBtn:{name:"取消",click:function(){i.remove()}}})})})},e}])}(angular),function(e){"use strict";e.module("platform").factory("selectmodularPluginSvc",["platformModalSvc",function(e){var t={};return t.init=function(){KindEditor.plugin("selectmodular",function(t){var n=this,i="selectmodular";n.lang({selectmodular:"文章模板"});var a=function(e,t){t?n.html(e):n.insertHtml(e)},o=function(){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"/components/templates/platform-template-view.html",controller:"templateLib",size:"lg"}).then(function(e){e&&e.template&&a(e.template.htmlContent||"",e.replace)})};n.plugin.spechars={edit:function(){o()}},n.clickToolbar(i,n.plugin.spechars.edit)})},t}])}(angular),function(){"use strict";angular.module("platform").factory("spechartsPluginSvc",[function(){function e(e){return e.split(",")}var t={},n=[{name:"tsfh",title:"特殊字符",content:e("、,。,·,ˉ,ˇ,¨,〃,々,—,～,‖,…,‘,’,“,”,〔,〕,〈,〉,《,》,「,」,『,』,〖,〗,【,】,±,×,÷,∶,∧,∨,∑,∏,∪,∩,∈,∷,√,⊥,∥,∠,⌒,⊙,∫,∮,≡,≌,≈,∽,∝,≠,≮,≯,≤,≥,∞,∵,∴,♂,♀,°,′,″,℃,＄,¤,￠,￡,‰,§,№,☆,★,○,●,◎,◇,◆,□,■,△,▲,※,→,←,↑,↓,〓,〡,〢,〣,〤,〥,〦,〧,〨,〩,㊣,㎎,㎏,㎜,㎝,㎞,㎡,㏄,㏎,㏑,㏒,㏕,︰,￢,￤,℡,ˊ,ˋ,˙,–,―,‥,‵,℅,℉,↖,↗,↘,↙,∕,∟,∣,≒,≦,≧,⊿,═,║,╒,╓,╔,╕,╖,╗,╘,╙,╚,╛,╜,╝,╞,╟,╠,╡,╢,╣,╤,╥,╦,╧,╨,╩,╪,╫,╬,╭,╮,╯,╰,╱,╲,╳")},{name:"lmsz",title:"罗马字符",content:e("ⅰ,ⅱ,ⅲ,ⅳ,ⅴ,ⅵ,ⅶ,ⅷ,ⅸ,ⅹ,Ⅰ,Ⅱ,Ⅲ,Ⅳ,Ⅴ,Ⅵ,Ⅶ,Ⅷ,Ⅸ,Ⅹ,Ⅺ,Ⅻ")},{name:"szfh",title:"数字字符",content:e("⒈,⒉,⒊,⒋,⒌,⒍,⒎,⒏,⒐,⒑,⒒,⒓,⒔,⒕,⒖,⒗,⒘,⒙,⒚,⒛,⑴,⑵,⑶,⑷,⑸,⑹,⑺,⑻,⑼,⑽,⑾,⑿,⒀,⒁,⒂,⒃,⒄,⒅,⒆,⒇,①,②,③,④,⑤,⑥,⑦,⑧,⑨,⑩,㈠,㈡,㈢,㈣,㈤,㈥,㈦,㈧,㈨,㈩")},{name:"rwfh",title:"日文字符",content:e("ぁ,あ,ぃ,い,ぅ,う,ぇ,え,ぉ,お,か,が,き,ぎ,く,ぐ,け,げ,こ,ご,さ,ざ,し,じ,す,ず,せ,ぜ,そ,ぞ,た,だ,ち,ぢ,っ,つ,づ,て,で,と,ど,な,に,ぬ,ね,の,は,ば,ぱ,ひ,び,ぴ,ふ,ぶ,ぷ,へ,べ,ぺ,ほ,ぼ,ぽ,ま,み,む,め,も,ゃ,や,ゅ,ゆ,ょ,よ,ら,り,る,れ,ろ,ゎ,わ,ゐ,ゑ,を,ん,ァ,ア,ィ,イ,ゥ,ウ,ェ,エ,ォ,オ,カ,ガ,キ,ギ,ク,グ,ケ,ゲ,コ,ゴ,サ,ザ,シ,ジ,ス,ズ,セ,ゼ,ソ,ゾ,タ,ダ,チ,ヂ,ッ,ツ,ヅ,テ,デ,ト,ド,ナ,ニ,ヌ,ネ,ノ,ハ,バ,パ,ヒ,ビ,ピ,フ,ブ,プ,ヘ,ベ,ペ,ホ,ボ,ポ,マ,ミ,ム,メ,モ,ャ,ヤ,ュ,ユ,ョ,ヨ,ラ,リ,ル,レ,ロ,ヮ,ワ,ヰ,ヱ,ヲ,ン,ヴ,ヵ,ヶ")},{name:"xlzm",title:"希腊字母",content:e("Α,Β,Γ,Δ,Ε,Ζ,Η,Θ,Ι,Κ,Λ,Μ,Ν,Ξ,Ο,Π,Ρ,Σ,Τ,Υ,Φ,Χ,Ψ,Ω,α,β,γ,δ,ε,ζ,η,θ,ι,κ,λ,μ,ν,ξ,ο,π,ρ,σ,τ,υ,φ,χ,ψ,ω")},{name:"ewzm",title:"俄文字符",content:e("А,Б,В,Г,Д,Е,Ё,Ж,З,И,Й,К,Л,М,Н,О,П,Р,С,Т,У,Ф,Х,Ц,Ч,Ш,Щ,Ъ,Ы,Ь,Э,Ю,Я,а,б,в,г,д,е,ё,ж,з,и,й,к,л,м,н,о,п,р,с,т,у,ф,х,ц,ч,ш,щ,ъ,ы,ь,э,ю,я")
},{name:"pyzm",title:"拼音字母",content:e("ā,á,ǎ,à,ē,é,ě,è,ī,í,ǐ,ì,ō,ó,ǒ,ò,ū,ú,ǔ,ù,ǖ,ǘ,ǚ,ǜ,ü")},{name:"yyyb",title:"英语字符",content:e("i:,i,e,æ,ʌ,ə:,ə,u:,u,ɔ:,ɔ,a:,ei,ai,ɔi,əu,au,iə,εə,uə,p,t,k,b,d,g,f,s,ʃ,θ,h,v,z,ʒ,ð,tʃ,tr,ts,dʒ,dr,dz,m,n,ŋ,l,r,w,j,")},{name:"zyzf",title:"其他字符",content:e("ㄅ,ㄆ,ㄇ,ㄈ,ㄉ,ㄊ,ㄋ,ㄌ,ㄍ,ㄎ,ㄏ,ㄐ,ㄑ,ㄒ,ㄓ,ㄔ,ㄕ,ㄖ,ㄗ,ㄘ,ㄙ,ㄚ,ㄛ,ㄜ,ㄝ,ㄞ,ㄟ,ㄠ,ㄡ,ㄢ,ㄣ,ㄤ,ㄥ,ㄦ,ㄧ,ㄨ,▁,▂,▃,▄,▅,▆,▇,�,█,▉,▊,▋,▌,▍,▎,▏,▓,▔,▕,▼,▽,◢,◣,◤,◥,☉,⊕,〒,〝,〞")}];return t.init=function(){KindEditor.plugin("spechars",function(e){var t=this,i="spechars";t.lang({spechars:"特殊字符"}),t.plugin.spechars={edit:function(){var a='<div style="padding:10px;">';a+='<div class="tabs spec-char"></div>';for(var o=0;o<n.length;o++){var r=n[o];a+='<div class="tabbody tab'+o+'" style="display:none;">';for(var s=0;s<r.content.length;s++)a+="<span>"+r.content[s]+"</span>";a+="</div>"}a+="</div>";var l=t.createDialog({name:i,width:620,height:500,title:"特殊字符",body:a}),c=l.div,u=e.tabs({src:e(".tabs",c),afterSelect:function(e){}});u.div.addClass("spec-char"),e(".ke-tabs",c).css("margin-bottom","0");for(var o=0;o<n.length;o++){var d=n[o];u.add({title:d.title,style:"padding:0px 5px",panel:e(".tab"+o,c)})}e(".tabbody span",c).bind("click",function(){t.hideDialog().focus(),t.insertHtml(e(this).text()).hideMenu().focus()}),u.select(0)}},t.clickToolbar(i,t.plugin.spechars.edit)})},t}])}(),function(e){"use strict";e.module("platform").factory("basDataSvc",["basDataListSvc","basDataItemSvc","basDataProcessorSvc","basDataValidationSvc","basDataCacheSvc","basDataAuthSvc",function(e,t,n,i,a,o){var r={},s=[],l=0,c=function(){l+=1;var e=3-l.toString().length;return e=e<0?0:e,"00".slice(0,e)+l},u=function(r,s){e(r,s),t(r,s),n(r,s),i(r,s),a(r,s),o(r,s)},d=function(e){var t=this,n={};n.init=[],n.options=e,n.options.item=n.options.item||{},n.options.list=n.options.list||{},t.$$serviceId=c(),u(t,n),_.forEach(n.init,function(e){e.call(this)})};return r.createInstance=function(e){var t=new d(e);return s.push(t),t},r}])}(angular),function(e){"use strict";e.module("platform").factory("basDetailCtrlSvc",["$state","$q","nswGlobals","platformModalSvc","platformNavigationSvc","platformNswAuthSvc","$stateParams",function(t,n,i,a,o,r,s){var l={},c=function(t,l,c){c=c||{},t.appId=i.getValue("appId"),t.currentItem=l.getCurrentItem(),t.tabs={},t.options={},t.options.tabs=c.tabs,t.imageUrl=l.getImageUrl(),t.params=s;var u,d=function(){c&&c.listState&&o.goState(c.listState)},p=function(n){c&&c.notCopyCurrent?t.currentItem=n:t.currentItem=e.copy(n)};t.goState=o.goState,t.resetForm=function(){l.resetCurrentItem()},t.create=function(){l.createNew()},t.setCurrentItem=function(e){l.loadItemById(e).then(function(e){l.setCurrentItem(e)})},t.save=function(i,o,r){var s=n.defer();c.failed=c.failed||{},c.success=c.success||{};var p=c.tip||{};p.loading=p.loading||{},_.isObject(i)&&(o=i,i=!0),i=!!_.isUndefined(i)||i,u=l.getCurrentItem();var m,f=null,g=!(c&&c.failed&&c.failed.title);return m=c&&c.tip&&_.isFunction(c.tip.showLoading)?c.tip.showLoading.call(this):c&&c.tip&&c.tip.showLoading,f=t.currentItem.$$new?l.saveCreate(t.currentItem,{displayTip:g,showLoading:m,loadingTip:p.loading.message},r):l.updateItem(t.currentItem,{displayTip:g,showLoading:m,loadingTip:p.loading.message},r),f.then(function(t){if(o&&o.$setPristine(),_.isObject(t)&&_.has(t,"id")&&e.extend(u,t),!g){var n=_.isString(t)?t:"数据保存成功";n=c.success.tip?c.success.tip:n,a.showSuccessTip(n)}setTimeout(function(){i&&d()}),s.resolve(t)},function(e){if(!g){var t=_.isString(e)?e:"数据保存失败";t=c.failed.tip?c.failed.tip:t,a.showWarmingMessage(t,c.failed.title)}s.reject(e)}),s.promise},t.selectTab=function(e){_.forEach(t.tabs,function(e,n){t.tabs[n]=!1}),t.tabs[e]=!0,t.tab=e},t.omitAttr=l.omitAttr,t.goBack=function(){d()},t.checkAuthed=function(e){return r.getAuth(e)},l.registerCurrentItemChanged(p),t.$on("$destroy",function(){l.unregisterCurrentItemChanged(p)})};return l.createInstance=function(e,t,n){return new c(e,t,n)},l}])}(angular),function(e){"use strict";e.module("platform").factory("basListCtrlSvc",["$state","nswGlobals","platformModalSvc","platformNavigationSvc","platformNswAuthSvc","NgTableParams",function(t,n,i,a,o,r){var s={},l=function(t,s,l){l=l||{},t.appId=n.getValue("appId"),t.currentItem=s.getCurrentItem(),t.dataList=s.getDataList(),t.searchOptions=s.getSearchOptions(),t.tabs={},t.imageUrl=s.getImageUrl(),t.options={},t.maxSize=l.maxSize||5,t.detailState=l.detailState,t.tableParams=new r({},{counts:[],dataset:[]});var c=function(e){var n=(e||{}).length||0;t.tableParams.count(n)},u=function(e){t.currentItem=e},d=function(n){t.dataList=n,e.extend(t.searchOptions,s.getSearchOptions()),t.tableParams.settings({dataset:t.dataList}),c(n)},p=function(e){t.tableParams.settings({dataset:t.dataList}),c(e)},m=function(){l&&l.detailState&&a.goState(l.detailState)};t.goState=a.goState,t.setCurrentItem=function(e){s.setCurrentItem(e)},t.selectAll=function(e){e=!!e,_.forEach(t.dataList,function(n){t.isItemSelected(n)!==e&&t.selectItem(n)})},t.selectReverse=function(){_.forEach(t.dataList,function(e){t.selectItem(e)})},t.isEmpty=function(){return!t.dataList.length},t.selectItem=function(e){s.selectItem(e)},t.isItemSelected=function(e){return!!_.find(s.getSelectedItems(),{id:e.id})||!!_.find(s.getSelectedItems(),{_id:e._id})},t.hasSelectedItems=function(){return s.getSelectedItems().length},t.isCurrentItem=function(e){return t.currentItem===e},t.searchData=function(e){return s.loadData(e)},t.resetSearchData=function(n){return e.extend(t.searchOptions,{pageNum:1,filter:""}),s.loadData(n)},t.save=function(e){s.updateItem(e)},t.create=function(){s.createNew(),m()},t.edit=function(e){s.setCurrentItem(e),m()},t.remove=function(e,t,n){var a=_.isString(t)?t:"确认删除？";t?i.showConfirmMessage(a,"删除提示").then(function(){s.removeItem(e,n)}):s.removeItem(e,n)},t.removeItems=function(e,t,n){var a=_.isString(t)?t:"确认删除？";e=_.isArray(e)?e:[e],t?i.showConfirmMessage(a,"删除提示").then(function(){s.removeItems(e,n)}):s.removeItems(e,n)},t.selectTab=function(e){_.forEach(t.tabs,function(e,n){t.tabs[n]=!1}),t.tabs[e]=!0,t.tab=e},t.goBack=function(){},t.getList=function(){return t.dataList},t.getSelectedItems=function(){return s.getSelectedItems()},t.checkAuthed=function(e){return o.getAuth(e)};var f=function(){s.resetSearchOptions(),t.tableParams.settings({dataset:[]}),s.loadData()};t.omitAttr=s.omitAttr,s.registerCurrentItemChanged(u),s.registerListLoaded(d),a.registerRouteUpdated(f),s.registerMultiRemoved(p),s.registerItemRemoved(p),t.$on("$destroy",function(){s.unregisterCurrentItemChanged(u),s.unregisterListLoaded(d),s.resetSearchOptions(),a.unregisterRouteUpdated(f),s.unregisterMultiRemoved(p),s.unregisterItemRemoved(p)})};return s.createInstance=function(e,t,n){return new l(e,t,n)},s}])}(angular),function(e){"use strict";e.module("platform").factory("basMainControllerSvc",[function(){var e={},t=function(e,t){e.$on("$destroy",function(){})};return e.createInstance=function(e,n){return new t(e,n)},e}])}(angular),function(e){"use strict";e.module("platform").factory("nswGlobals",["$localStorage","platformMessenger","$sessionStorage",function(t,n,i){var a={},o={},r=new n;return t.globals=t.globals||{},i.globals=t.globals||{},a.setValue=function(e,n,s){return _.set(o,e,n),r.fire(e,n),s&&(_.set(t.globals,e,n),s&&_.set(i.globals,e,n)),a},a.getValue=function(n){if(o.hasOwnProperty(n))return o[n];var r=i.globals[n]||t.globals[n];return e.isDefined(r)&&a.setValue(n,r,!0),r},a.registerPropertyChanged=function(e){r.register(e)},a.unregisterPropertyChanged=function(e){r.unregister(e)},a}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlAuth",["platformNswAuthSvc",function(e){return{scope:{nswClick:"&"},link:function(t,n,i){i.ngtableCtrlAuth=i.ngtableCtrlAuth||"";var a=function(){return e.getAuth(i.ngtableCtrlAuth)},o=function(){a()&&(n.css("cursor","pointer"),n.click(function(){t.nswClick()}))};t.$evalAsync(function(){o()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlBackup",[function(){return{scope:{},replace:!0,template:'<div class="table-backup" ng-click="_backUp()"></div>',link:function(e,t){var n=function(){return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop},i=function(){$(window).scroll(a)},a=function(){n()>$(window).height()?t.show():t.hide()};e._backUp=function(){$("html, body").animate({scrollTop:0},"fast")},i()}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlCheck",[function(){return{scope:!0,require:"ngModel",replace:!0,template:'<i class="icon" ng-click="_check()" ng-class="{true:\'icon-sm-checkbox-on\', false:\'icon-sm-checkbox-off\'}[checkStat]"></i>',link:function(e,t,n,i){function a(){var t=e.$parent.row;l(t)}var o="tree"===n.ngtableCtrlCheck,r=null;e.checkStat=!!i.$viewValue,n.check=n.check||!1;var s=function(){return r?r:r=e.$eval(n.list)},l=function(e){var t=s(),n=e.path.split(",");_.forEach(t,function(t){var i=t.path.split(",");i.length>n.length&&i[i.length-2]===e._id&&(t.isChecked=e.isChecked,l(t))})};e._check=function(){return n.check?void e.$eval(n.check):(e.checkStat=!e.checkStat,i.$setViewValue(e.checkStat),void(o&&a()))},i.$render=function(){e.checkStat=i.$viewValue||!1}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlLabelCheck",[function(){var e='<label ng-click="_check()"><i class="icon" ng-class="{true:\'icon-sm-checkbox-on\', false:\'icon-sm-checkbox-off\'}[checkStat]"></i><span ng-class="spanc">{{label}}</span></label>';return{scope:!0,require:"ngModel",replace:!0,template:e,link:function(e,t,n,i){e.label=n.label,e.spanc=n.spanclass,e.checkStat=!!i.$viewValue,n.check=n.check||!1,e._check=function(){return n.check?void e.$eval(n.check):(e.checkStat=!e.checkStat,void i.$setViewValue(e.checkStat))},i.$render=function(){e.checkStat=i.$viewValue||!1}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlLabelRadio",[function(){var e='<label ng-click="_check()"><i class="icon" ng-class="{true:\'icon-sm-radio-on\', false:\'icon-sm-radio-off\'}[checkStat]"></i><span ng-class="spanc">{{label}}</span></label>';return{scope:!0,require:"ngModel",replace:!0,template:e,link:function(e,t,n,i){e.label=n.label,e.spanc=n.spanclass,e.checkStat=!!i.$viewValue,n.check=n.check||!1,n.radioClick=n.radioClick||"";var a=function(){n.radioClick&&e.$eval(n.radioClick)};e._check=function(){return n.check?void e.$eval(n.check):(e.checkStat=!e.checkStat,i.$setViewValue(e.checkStat),void a())},i.$render=function(){e.checkStat=i.$viewValue||!1}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlSort",[function(){return{scope:!0,template:'<span><i class="page-icon icon-arrowup" ng-if="row.indexType == 1 || row.indexType == 2"   ng-click="_sortUp()"></i><i class="page-icon icon-arrowdown" ng-if="row.indexType == 2 || row.indexType == -1"   ng-click="_sortDown()"></i></span>',link:function(e,t,n){n.sortUp=n.sortUp||"",n.sortDown=n.sortDown||"";var i=function(t){t&&e.$eval(t)};e._sortUp=function(){i(n.sortUp)},e._sortDown=function(){i(n.sortDown)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableCtrlState",[function(){return{scope:!0,require:"ngModel",template:'<i class="icon" ng-class="{true:\'icon-sm-radio-green\', false:\'icon-sm-radio-off\'}[isChecked]" ng-click="onClick($event)"></i>',link:function(e,t,n,i){n.stateClick=n.stateClick||"",e.isChecked=!!i.$viewValue,i.$render=function(){e.isChecked=!!i.$viewValue},e.onClick=function(a){a.stopPropagation(),t.attr("disabled")||(e.isChecked=!e.isChecked,i.$setViewValue(e.isChecked),n.stateClick&&e.$parent.$eval(n.stateClick))}}}}])}(angular),function(e){"use strict";e.module("platform").directive("tableDragwidth",[function(){return{scope:!0,link:function(e,t,n){n.notIndex=n.notIndex||"1,2";var i,a={element:{},width:0,pagex:0},o=function(e){var n=a.width+(e.pageX-a.pagex),i=t.find("tbody").find("td").eq($(a.element).index());n<40&&(n=40),i.width(n)},r=function(e){e.stopPropagation(),this.removeEventListener("mousemove",o,!1)},s=function(e){a.element=this.parentElement,a.width=this.parentElement.offsetWidth||0,a.pagex=e.pageX||0,document.body.addEventListener("mousemove",o,!1),document.body.addEventListener("mouseup",r,!1)},l=function(){i.find(".table-dragel").on("mousedown",s)},c=function(){var e='<span class="table-dragel"></span>';i=t.find(".ng-table-sort-header").find("th"),i.length&&(n.notIndex+=","+i.length,i.not(function(e){return e+=1,n.notIndex.indexOf(e.toString())!==-1?e:""}).append(e),l())},u=function(){t.addClass("table-drag"),c()};e.$evalAsync(function(){setTimeout(function(){u()},2e3)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableRadioGroup",[function(){var e='<label ng-class="labelc" ng-repeat="item in list" ng-click="_click(item)"><i class="icon" ng-class="{true:\'icon-sm-radio-on\', false:\'icon-sm-radio-off\'}[item.checked]"></i><span ng-class="spanc">{{item.label}}</span></label>';return{replace:!0,require:"ngModel",template:e,scope:!0,link:function(e,t,n,i){function a(){_.forEach(e.list,function(e){e.checked=e.value===i.$viewValue})}e.list=e.$eval(n.options)||[],e.spanc=n.spanclass,e.labelc=n.labelclass,e._click=function(t){_.forEach(e.list,function(e){e.checked=!1}),t.checked=!0,i.$setViewValue(t.value),n.selected&&e.$eval(n.selected,{selectedItem:t})},a(),i.$render=function(){a()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableToolbarCheck",[function(){return{scope:{selector:"=",selectAll:"&",isAllSelected:"&",reverseSelect:"&"},template:'<div nsw-checkbox="" ng-click="selectAll()" class="clearFix nsw-tool-checkbox" nsw-checked="isAllSelected()"></div><a href="javascript:;" ng-click="selectAll()">全选</a><span>|</span><a href="javascript:;" ng-click="reverseSelect()">反选</a>',link:function(e){e.selector&&(e.selectAll=e.selector.selectAll,e.isAllSelected=e.selector.isAllSelected,e.reverseSelect=e.selector.reverseSelect)}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableTreeColumn",[function(){return{scope:!0,require:"ngModel",template:'<!--<span class="t-indent"></span>--><span class="t-title">{{title}}</span><span class="t-indent t-tree-icon" ng-click="_toggleRowFun()" ng-class="{\'down\': collapsed, \'right\': !collapsed}" ng-show="item.children || item.hasChildren"></span><a class="t-fastedit" ng-show="_fastEditCode()" title="快速编辑" ng-click="_fastEdit(item)"><i class="page-icon icon-edit"></i></a>',link:function(e,t,n,i){n.fastAuth=n.fastAuth||"",n.ngtableTreeColumn=n.ngtableTreeColumn||"row",e.item=e.$eval(n.ngtableTreeColumn)||{},e.collapsed=!0,_.isEmpty(e.originCollapsed._pids)||(e.collapsed=_.find(e.originCollapsed,function(t,n){return n===e.item._id})),e.tindent=function(e){if(e){var n=e.path.split(",");_.remove(n,function(e){return!e}),(e.children||e.hasChildren)&&n.pop();for(var i="",a=0;a<n.length;a++)i+='<span class="t-indent"></span>';t.prepend(i)}},e._toggleRowFun=function(){e.collapsed=!e.collapsed,e.toggleData(e.item,e.collapsed)},e._fastEdit=function(){e.$eval(n.fastEdit)},e._fastEditCode=function(){return!n.fastAuth||e.checkAuthed(n.fastAuth)};var a=function(){e._fastEditCode()&&(t.find(".t-title").css("cursor","pointer"),t.find(".t-title").click(function(){e.$eval(n.nswClick)}))},o=function(){var n=(e.item.path||"").replace(/^,|,$/g,"").split(",");1===n.length&&t.find(".t-title").css("font-weight","bold")};e.$evalAsync(function(){e.title=i.$viewValue||"",a(),o()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngtableTreeRow",[function(){return{replace:!0,require:"ngModel",transclude:!0,template:'<tr ng-show="showData(rowData)" data-ng-transclude></tr>',controller:["$scope",function(e){e.toggleData=function(t,n){var i=e.originCollapsed._pids;n?i[t._id]=-1:i[t._id]=t._id,e.originCollapsed[t._id]=n}}],link:function(e,t,n,i){e.$parent._pid={},e.showData=function(t){var n=e.originCollapsed._pids,i=!0;return _.forEach(n,function(e,a){var o;t.path&&(o=t.path.split(",")),_.forEach(o,function(e,t){o[t]===n[a]&&(i=!1)})}),i},i.$render=function(){e.rowData=i.$viewValue}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswInteger",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){var a=function(e){var t=/^-?\d+$/;return _.isEmpty(e)||t.test(e)?(i.$setValidity("nswInteger",!0),e):void i.$setValidity("nswInteger",!1)};i.$parsers.push(a),i.$formatters.push(a),n.$observe("nswinteger",function(){a(i.$viewValue)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){for(var t=e||"",a=parseInt(n.nswMaxLength)||0,o=0,r=0;r<t.length;r++){var s=t.charCodeAt(r);s>=1&&s<=126||65376<=s&&s<=65439?o++:o+=2}return 0===a||o<=a?(i.$setValidity("nswmaxlength",!0),e):(i.$setValidity("nswmaxlength",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswMaxLength",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxValue",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){if(i){var a=parseInt(n.nswMaxValue);a=isNaN(a)?0:a;var o=function(e){if(e=e||""){var t=Number(e);t<=a?i.$setValidity("maxvalue",!0):i.$setValidity("maxvalue",!1)}else i.$setValidity("maxvalue",!0);return e};i.$parsers.unshift(o),i.$formatters.push(o),n.$observe("maxvalue",function(){o(i.$viewValue)})}}}})}(angular),function(e){"use strict";e.module("platform").directive("maxWordLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){e=e||[];var t=parseInt(n.maxWordLength)||0,a=parseInt(n.wordLength)||32,o=!0;e.forEach(function(e){for(var t=e||"",n=0,i=0;i<e.length;i++){var r=t.charCodeAt(i);r>=1&&r<=126||65376<=r&&r<=65439?n++:n+=2}if(n>a)return void(o=!1)});var r=e.length;return(0===t||r<=t)&&o?(i.$setValidity("maxwordlength",!0),e):(i.$setValidity("maxwordlength",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),i.$viewChangeListeners.push(function(){i.$viewValue}),n.$observe("maxWordLength",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("maxWord",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[\|\|]+|[,，]+/,o=/[\|\|]+|[,，]+/g,r=function(e){var t=parseInt(n.maxWord)||0,o=(e||"").split(a).length;return 0===t||o<=t?(i.$setValidity("maxword",!0),e):(i.$setValidity("maxword",!1),e)};i.$formatters.push(r),i.$parsers.unshift(r),i.$viewChangeListeners.push(function(){var e=i.$viewValue;e&&(e=e.replace(o,","),i.$setViewValue(e))}),n.$observe("maxword",function(){r(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaximum",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){var t=e,a=Number(n.nswMaximum).valueOf()||0;return t<=a?(i.$setValidity("nswmaximum",!0),e):(i.$setValidity("nswmaximum",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswMaximum",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMinLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){var t=0,a=parseInt(n.nswMinLength)||0,o=0;e=e||"";for(var r=0;r<e.length;r++){var s=e.charCodeAt(r);s>=1&&s<=126||65376<=s&&s<=65439?o++:o+=2}return t=o,0===t||o>=a?i.$setValidity("nswminlength",!0):i.$setValidity("nswminlength",!1),e};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswminlength",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("modelCompare",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(t){var a=n.modelCompare,o=e.$eval(a),r=o.$viewValue;return t!==r&&r?(i.$setValidity("modelcompare",!1),t):(i.$setValidity("modelcompare",!0),t)};i.$formatters.push(a),i.$parsers.unshift(a);var o=e.$watch(n.modelCompare,function(){a(i.$viewValue)});n.$observe("modelCompare",function(){a(i.$viewValue)}),e.$on("$destroy",function(){o()})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("ngMin",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){var a=function(t){var a=e.$eval(n.ngMin)||0;return!_.isEmpty(t)&&t<a?void i.$setValidity("ngMin",!1):(i.$setValidity("ngMin",!0),t)};i.$parsers.push(a),i.$formatters.push(a),n.$observe("ngmin",function(){a(i.$viewValue)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNoEmpty",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[\|\|]+|[,，]+/,o=function(e){var t=!1;return _.forEach(e,function(n,i){if(!_.trim(n)&&0!==i&&i!==e.length-1)return void(t=!0)}),t},r=function(e){var t=(e||"").split(a);return e&&o(t)?(i.$setValidity("nswnoempty",!1),e):(i.$setValidity("nswnoempty",!0),e)};i.$formatters.push(r),i.$parsers.unshift(r)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswDomain",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswdomain",!0),e):(i.$setValidity("nswdomain",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("nswDomain",function(){o(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswEmail",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswemail",!0),e):(i.$setValidity("nswemail",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswEnNumber",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/([0-9]*[a-zA-Z]+[0-9]*)*/,o=function(e){e=e||"";var t;return t=!(!e.match(a)||e.match(a)[0]!==e),!e||t?(i.$setValidity("nswennumber",!0),e):(i.$setValidity("nswennumber",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFax",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswfax",!0),e):(i.$setValidity("nswfax",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFaxFix",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^\d+[-|\d]*\d+$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswfaxfix",!0),e):(i.$setValidity("nswfaxfix",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFixedPhone",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswfixedphone",!0),e):(i.$setValidity("nswfixedphone",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswInt",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^-?[1-9]{1}[0-9]*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswint",!0),e):(i.$setValidity("nswint",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswLatitude",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^0$|^-?0\.\d*[1-9]$|^-?[1-9](\.\d*[1-9])?$|^-?[1-8]\d(\.\d*[1-9])?$|^-?90$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswlatitude",!0),e):(i.$setValidity("nswlatitude",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswLongitude",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^0$|^-?0\.\d*[1-9]$|^-?[1-9](\.\d*[1-9])?$|^-?[1-9]\d(\.\d*[1-9])?$|^-?1[0-7]\d(\.\d*[1-9])?$|^-?180$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswlongitude",!0),e):(i.$setValidity("nswlongitude",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxDate",["platformDateSvc",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,i,a){if(a){var o=function(t){var n=e.stringToDate(i.nswMaxDate);return t?e.stringToDate(t)<n?a.$setValidity("nswmaxdate",!0):a.$setValidity("nswmaxdate",!1):a.$setValidity("nswmaxdate",!0),t};a.$parsers.unshift(o),a.$formatters.push(o),i.$observe("nswMaxDate",function(){o(a.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxVal",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){var t=Number(e)||0,a=parseInt(n.nswMaxVal)||0;return 0===a||t<=a?(i.$setValidity("nswmaxval",!0),e):(i.$setValidity("nswmaxval",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswMaxVal",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMinDate",["platformDateSvc",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,i,a){if(a){var o=function(t){var n=e.stringToDate(i.nswMinDate);return t?e.stringToDate(t)>n?a.$setValidity("nswmindate",!0):a.$setValidity("nswmindate",!1):a.$setValidity("nswmindate",!0),t};a.$parsers.unshift(o),a.$formatters.push(o),i.$observe("nswMinDate",function(){o(a.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMinVal",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(e){var t=Number(e)||0,a=Number(n.nswMinVal)||0;return t>=a?(i.$setValidity("nswminval",!0),e):(i.$setValidity("nswminval",!1),e)};i.$formatters.push(a),i.$parsers.unshift(a),n.$observe("nswMinVal",function(){a(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMobile",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/(\d+-)*\d+$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswmobile",!0),e):(i.$setValidity("nswmobile",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMoney",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^[0-9]+(\.)?(\d{1,2})?$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswmoney",!0),e):(i.$setValidity("nswmoney",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("nswMoney",function(){o(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNotSymbol",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[^!@#$%^&*()+{}":><?.,`'\\\/！=\]\[【】，。、；‘、\-’@#￥%……&*（）——+？》《：“~]*/g,o=function(e){e=e||"";var t;return t=!(!e.match(a)||e.match(a)[0]!==e),!e||t?(i.$setValidity("nswnotsymbol",!0),e):(i.$setValidity("nswnotsymbol",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNotZh",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^[^\u4e00-\u9fa5]*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswnotzh",!0),e):(i.$setValidity("nswnotzh",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNumber",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^-?[0-9]{1}[0-9]*\.?[0-9]*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswnumber",!0),e):(i.$setValidity("nswnumber",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("nswNumber",function(){o(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswPassword",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^(?=.*[a-zA-Z])(?=.*[0-9]).[^\u4e00-\u9fa5]*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswpassword",!0),e):(i.$setValidity("nswpassword",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswPhone400",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/(^400-[016789]\d{2}-\d{4})|(^400[016789]-\d{3}-\d{3})|(^400-[016789]\d{3}-\d{3})|((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswphone400",!0),e):(i.$setValidity("nswphone400",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswPhone",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^1(3|4|5|7|8)\d{9}$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswphone",!0),e):(i.$setValidity("nswphone",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswQq",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^\d{5,15}$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswqq",!0),e):(i.$setValidity("nswqq",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswUint",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^[1-9]{1}[0-9]*$/,o=function(e){var t=a.test(e);return!e||t?(i.$setValidity("nswuint",!0),e):(i.$setValidity("nswuint",!1),e)};i.$formatters.push(o),i.$parsers.unshift(o),n.$observe("nswUint",function(){o(i.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswUnique",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/[\|\|]+|[,，]+/,o=function(e){var t=e.length;return!(t>1&&t>_.uniq(e).length&&_.trim(e[0])&&_.trim(e[t-1]))},r=function(e){var t=(e||"").split(a);return!e||o(t)?(i.$setValidity("nswunique",!0),e):(i.$setValidity("nswunique",!1),e)};i.$formatters.push(r),i.$parsers.unshift(r)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswUserValidator",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=function(t){var a=e.$eval(n.nswUserValidator).call(this,t),o=n.validatorName;return a?(i.$setValidity(o,!0),t):(i.$setValidity(o,!1),t)};i.$formatters.push(a),i.$parsers.unshift(a)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswOuterLink",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){t.on("keyup",function(){var e=/(^www\.)|(\w\.com)|(\w\.cn)|(\w\.net)|(\w\.org)|(\w\.edu)|(\w\.gov)/i,t=/^http/i,n=event.keyCode;8===n||t.test(i.$viewValue)||e.test(i.$viewValue)&&(i.$setViewValue("http://"+i.$viewValue),i.$render())})}}}])}(angular),function(e){"use strict";e.module("platform").directive("startEndChar",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){var a=/^[,|，|\|\|]+|[,|，|\|\|]+$/,o=function(e){var t=a.test(e);return e&&t?(i.$setValidity("startendchar",!1),e):(i.$setValidity("startendchar",!0),e)};i.$formatters.push(o),i.$parsers.unshift(o)}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("nswWordLength",[function(){return{restrict:"A",require:"?ngModel",link:function(t,n,i,a){var o=e.isDefined(i.nswWordLength),r=/[\|]+|[,，]+/,s=function(e,t){
for(var n=0,i=0;i<e.length;i++){var a=e.charCodeAt(i);a>=1&&a<=126||65376<=a&&a<=65439?n++:n+=2}return n<=t},l=function(e){var t=parseInt(i.nswWordLength)||0,n=(e||"").split(r),o=!1;return _.forEach(n,function(e){return o=s(e,t)}),a.$setValidity("wordlength",o),e};o&&(a.$formatters.push(l),a.$parsers.unshift(l)),i.$observe("nswWordLength",function(){l(a.$viewValue)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFormRow",[function(){return{restrict:"A",transclude:!0,scope:!0,templateUrl:globals.basAppRoute+"components/nsw-form/container/nsw-form-row.html",link:function(t,n,i){t.input={},t.inputVisible=!1,t.hasLabel="false"!==i.hasLabel,t.hasValidate="true"!==i.noneValidate||"false"!==i.hasValidateTip,t.newBlankEditor=e.isDefined(i.newBlankEditor);var a=function(){return $(n.find("[ng-model], [data-ng-model]")[0])},o=function(){var e=a();if(e[0])return e.data("$ngModelController")},r=function(){t.label=i.nswLabel||i.nswFormRow;var e=t.label.split("|");t.label=e[0],t.label2=e[1]},s=function(){var e=o();e&&(t.errors=e.$error)},l=function(){var e=o(),n=t.input&&t.input.element&&(t.input.element.attr("required")||t.input.element.attr("nsw-min-length"));_.extend(t.input,{ngModel:e,element:a(),label:t.label,isRequired:n})},c=t.$watch(function(){return!!$("[ng-model],[data-ng-model]",n).length},function(e){t.inputVisible=e,r(),s(),l()}),u=t.$watch(function(){return(o()||{}).$error},function(){l()},!0);r(),s(),l(),i.$observe("noneValidate",function(){t.hasValidate="true"!==i.noneValidate}),t.$on("$destroy",function(){c(),u()})}}}])}(angular),function(e){"use strict";var t=0,n='<style>div[name="%formName%"] .form-row-label label{width:%labelWidth%px;min-height: 1px;word-wrap: break-word;}</style>';e.module("platform").directive("nswForm",[function(){return{templateUrl:globals.basAppRoute+"components/nsw-form/container/nsw-form.html",transclude:!0,link:function(e,i,a){var o="true"===a.autoFixed;e.$$nsw_form_name="nswForm"+t++;var r=function(){$(".labelWidthClass",i).html("");var t=Number(a.labelWidth)||_.max(_.map($(".form-row-label",i),function(e){return $(e).css({width:"auto"}),$(e).width()}));t=t<10?50:t,e.$$nswFormLabelWidth=t;var r=n.replace(/%formName%/g,e.$$nsw_form_name).replace(/%labelWidth%/g,t+15);if($(".labelWidthClass",i).html(r),i.parents(".nsw-tab").hasClass("ng-hide")||$(".tab-footer").css("paddingLeft",t+15),o){var s=$(".form-row",i).width(),l=s-t-15;$(".form-row-content",i).not(".form-row-content *").width(l||700)}$(".modal-footer",i).css("paddingLeft",t+15)};e.$evalAsync(function(){r()});var s=e.$watch(function(){return $(".form-row-label",i).length},r);e.$on("tabSelected",function(){setTimeout(r)}),e.$on("platformFormChanged",function(){setTimeout(r)}),e.$on("$destroy",function(){s()})}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataAuthSvc",["platformNswAuthSvc",function(e){return function(t,n){t.checkAuthed=function(t){return e.getAuth(t)}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataCacheSvc",["platformMessenger","$localStorage",function(e,t){return function(n,i){var a=new e;n.saveCache=function(){if(!i.options.cache||!i.options.name||!i.options.cache.getCache)return null;var e=i.options.cache.getCache.call(n);return t.moduleCache=t.moduleCache||{},t.moduleCache[i.options.name]=e,e},n.loadCache=function(){if(!i.options.cache||!i.options.name||!i.options.cache.applyCache)return null;t.moduleCache=t.moduleCache||{};var e=t.moduleCache[i.options.name]||{};return i.options.cache.applyCache.call(this,e),a.fire(e),e},n.registerCacheLoaded=function(e){a.register(e)},n.unregisterCacheLoaded=function(e){a.register(e)},i.init.push(function(){n.loadCache()})}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataItemSvc",["$http","$q","platformMessenger","platformModalSvc","nswGlobals",function(t,n,i,a,o){return function(r,s){s.currentItem={};var l=s.options.item["default"],c=s.options.item.afterCreated||e.noop,u=s.options.item.prepareCreate||e.noop,d=s.options.item.prepareUpdate||e.noop,p=s.options.item.prepareRemove||e.noop,m=s.options.item.prepareLoad||e.noop,f=s.options.item.itemReseted||e.noop,g=s.options.item.createUri||s.options.uri,h=s.options.item.updateUri||s.options.uri,v=s.options.item.removeUri||s.options.uri,w=s.options.item.loadUri||s.options.uri;s.itemCreated=new i,s.itemUpdated=new i,s.itemRemoved=new i,s.itemLoaded=new i,s.currentItemChanged=new i,r.setCurrentItem=function(e){s.currentItem=e,s.currentItemChanged.fire(e)},r.getCurrentItem=function(){return s.currentItem},r.resetCurrentItem=function(){l=s.options.item["default"],e.extend(s.currentItem,l),f(s.currentItem)},r.createNew=function(){l=s.options.item["default"],_.has(l,"appId")&&(l.appId=o.getValue("appId"));var t=e.copy(l);return t.$$new=!0,c.call(r,t),r.setCurrentItem(t),t},r.saveCreate=function(i,o,l){l=l||"",i=i||s.currentItem,o=o||{},o.displayTip=!!_.isUndefined(o.displayTip)||o.displayTip;var c=n.defer(),d=e.copy(i);_.omit(d,"$$new");var p={method:"post",url:globals.basAppRoot+g,data:d,headers:{logContent:encodeURI(l)}};u&&u(r,p),t(p).then(function(t){if(t.data.isSuccess){if(_.omit(i,"$$new"),e.extend(i,t.data.data),o.displayTip){var n=_.isString(t.data.data)?t.data.data:"保存成功";a.showSuccessTip(n)}s.searchOptions.totalRows++,s.dataList.length>=s.searchOptions.pageSize?(s.searchOptions.filter="",s.searchOptions.pageNum=1,r.loadData()):s.dataList.push(t.data.data),c.resolve(t.data.data),s.itemCreated.fire(t.data.data)}else o.displayTip&&a.showWarmingMessage(t.data.data,"失败提示"),c.reject(t.data.data);return t.data},function(e){c.reject(e)});var m=_.isBoolean(o.showLoading)?o.showLoading:o.displayTip;return m&&a.showLoadingTip(o.loadingTip||"保存中...").close(c.promise),c.promise},r.updateItem=function(i,o,l){l=l||"",i=i||s.currentItem,o=o||{},o.displayTip=!!_.isUndefined(o.displayTip)||o.displayTip;var c=n.defer(),u={method:"put",url:globals.basAppRoot+h,data:i,headers:{logContent:encodeURI(l)}};d&&d(r,u),t(u).then(function(t){t.data.isSuccess?(e.extend(i,t.data.data),o.displayTip&&a.showSuccessTip("保存成功"),c.resolve(t.data.data),s.itemUpdated.fire(t.data.data)):(o.displayTip&&a.showWarmingMessage(t.data.data,"保存失败"),c.reject(t.data.data))},function(e){c.reject(e)});var p=_.isBoolean(o.showLoading)?o.showLoading:o.displayTip;return p&&a.showLoadingTip(o.loadingTip||"保存中...").close(c.promise),c.promise},r.removeItem=function(e,n){n=n||"",e=e||s.currentItem;var i={method:"delete",url:globals.basAppRoot+v,params:{id:e.id},headers:{logContent:encodeURI(n)}};p&&p(r,i,e);var o=t(i).then(function(t){return t.data.isSuccess?(s.itemRemoved.fire(e),a.showSuccessTip(t.data.data),s.searchOptions.totalRows--,s.options.list.enablePaging&&s.searchOptions.totalPages>1&&r.loadData()):a.showWarmingMessage(t.data.data,"删除失败"),t.data});return a.showLoadingTip("数据移除中!").close(o),o},r.loadItemById=function(e){var n={method:"get",url:globals.basAppRoot+w,params:{id:e}};m&&m(r,n);var i=t(n).then(function(e){return e.data.isSuccess?(s.itemLoaded.fire(e.data.data),e.data.data):void a.showWarmingMessage(e.data.data,"数据获取失败")});return a.showLoadingTip("数据加载中!").close(i),i},r.omitAttr=function(e){var t=_.toArray(arguments);e=t.shift(0),_.forEach(t,function(t){e&&e.hasOwnProperty(t)&&delete e[t]})},r.getImageUrl=function(){return globals.imageUrl.replace(/@appId/,o.getValue("appId"))},r.registerItemCreated=function(e){s.itemCreated.register(e)},r.unregisterItemCreated=function(e){s.itemCreated.unregister(e)},r.registerItemUpdated=function(e){s.itemUpdated.register(e)},r.unregisterItemUpdated=function(e){s.itemUpdated.unregister(e)},r.registerItemRemoved=function(e){s.itemRemoved.register(e)},r.unregisterItemRemoved=function(e){s.itemRemoved.unregister(e)},r.registerItemLoaded=function(e){s.itemLoaded.register(e)},r.unregisterItemLoaded=function(e){s.itemLoaded.unregister(e)},r.registerCurrentItemChanged=function(e){s.currentItem&&!_.isEmpty(s.currentItem)&&e.call(this,s.currentItem,!0),s.currentItemChanged.register(e)},r.unregisterCurrentItemChanged=function(e){s.currentItemChanged.unregister(e)}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataListSvc",["$http","$q","platformMessenger","platformModalSvc","nswGlobals",function(t,n,i,a,o){return function(n,r){var s=!!r.options.list.enablePaging,l=!!r.options.list.enableSearch,c=r.options.list.pageSize||10,u=r.options.list.listUri||r.options.uri,d=r.options.list.listMethod||"get",p=r.options.list.selectionMode||"multi",m=!e.isDefined(r.options.requireAppId)||r.options.requireAppId,f=r.options.list.multiRemoveUri||r.options.item.removeUri||r.options.uri,g=r.options.list.prepareMultiRemove,h=r.options.list.prepareSearchParam;r.dataList=[],r.searchOptions={},r.currentSearchOptions=null,r.dataProcessors=[],r.selectedItems=[],r.listLoaded=new i,r.beforeListLoad=new i,r.multiRemoved=new i;var v=function(e){e=_.isString(e)?{id:e}:e;var t=_.indexOf(r.dataList,{id:e.id});_.remove(r.dataList,{id:e.id}),r.currentItem.id===e.id?r.dataList.length>t?n.setCurrentItem(r.dataList[t]):r.dataList.length===t&&t>0&&n.setCurrentItem(r.dataList[t-1]):n.setCurrentItem({}),0===r.dataList.length&&r.searchOptions.pageNum--,_.remove(r.selectedItems,{id:e.id})};r.resetFilterOptions=function(){r.searchOptions=r.searchOptions||{},_.forEach(r.searchOptions,function(e,t){r.searchOptions.hasOwnProperty(t)&&delete r.searchOptions[t]}),s&&_.extend(r.searchOptions,{totalRows:0,pageNum:1,totalPages:0,pageSize:c,maxSize:5,title:"",advanced:{},advancedSearch:!1})},r.getSearchParam=function(t){var i=e.copy(r.searchOptions);return i=_.omit(i,"advanced"),i=_.omit(i,"advancedSearch"),i=_.omit(i,"totalRows"),i=_.omit(i,"maxSize"),r.currentSearchOptions&&r.currentSearchOptions.filter!==i.filter&&(r.searchOptions.pageNum=i.pageNum=1),r.currentSearchOptions=i,e.extend(r.currentSearchOptions,i),h&&h.call(n,r.currentSearchOptions,t),i},n.resetSearchOptions=function(){r.resetFilterOptions()},n.getSearchOptions=function(){return r.searchOptions},n.loadSearchData=function(n){var i={};n=n||{},n.displayTip=!!_.isUndefined(n.displayTip)||n.displayTip,l&&(i=r.getSearchParam(n),e.extend(i)),m&&(i.appId=o.getValue("appId"));var c=_.isFunction(u)?u.call(this,i):u,p={method:d,url:globals.basAppRoot+c};"get"===p.method?p.params=i:p.data=i,r.beforeListLoad.fire();var f=t(p).then(function(e){var t=e.data;if(t.isSuccess){t=t.data,r.searchOptions.totalRows=0;var i=t.dataList||t.listData;return s&&i&&(r.dataList=i,r.searchOptions.totalPages=t.totalPages||t.pageCount,r.searchOptions.totalRows=t.totalRows||t.totalCount,r.searchOptions.pageNum=t.pageNumber||r.searchOptions.pageNum||1,r.selectedItems.length=0),s||(r.dataList=t,r.searchOptions.totalRows=r.dataList.length),r.listLoaded.fire(r.dataList),r.dataList}n.displayTip&&a.showWarmingMessage(t.data,"温馨提示")},function(){console.log("系统异常或网络不给力！")});return n.displayTip&&a.showLoadingTip("数据加载中!").close(f),f},n.loadData=function(e){return n.loadSearchData(e)},n.removeItems=function(e){e=e||n.getSelectedItems();var i=_.map(e,"id"),s={method:"delete",url:globals.basAppRoot+f,params:{ids:i},headers:{logContent:encodeURI("批量操作")}};m&&(s.params.appId=o.getValue("appId")),g&&g(n,s,e);var l=t(s).then(function(t){return t.data.isSuccess?(r.multiRemoved.fire(e),a.showSuccessTip(t.data.data),r.searchOptions.totalRows-=e.length,_.forEach(_.map(e,"id"),v),r.options.list.enablePaging&&r.searchOptions.totalPages>=1&&n.loadData()):a.showWarmingMessage(t.data.data,"删除失败"),t.data});return a.showLoadingTip("数据移除中!").close(l),l},n.selectItem=function(e){"single"===p?(r.selectedItems[0]=e,n.setCurrentItem(e)):_.find(r.selectedItems,e)?_.remove(r.selectedItems,e):r.selectedItems.push(e)},n.getSelectedItems=function(){return r.selectedItems},n.getDataList=function(){return r.dataList},n.setDataList=function(e){return r.dataList.length=0,_.forEach(e,function(e,t){r.dataList[t]=e}),_.forEach(r.dataList,function(e){r.processData(e,r.dataList)}),n},n.registerListLoaded=function(e){r.dataList&&e.call(this,r.dataList,!0),r.listLoaded.register(e)},n.unregisterListLoaded=function(e){r.listLoaded.unregister(e)},n.registerBeforeListLoad=function(e){r.beforeListLoad.register(e)},n.unregisterBeforeListLoad=function(e){r.beforeListLoad.unregister(e)},n.registerMultiRemoved=function(e){r.multiRemoved.register(e)},n.unregisterMultiRemoved=function(e){r.multiRemoved.unregister(e)},r.init.push(function(){n.registerItemRemoved(v),r.resetFilterOptions()})}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataProcessorSvc",["$injector","platformMessenger",function(e,t){return function(n,i){var a=[],o=new t,r=new t;_.forEach(i.options.processors,function(t){a.push({name:t,instance:e.get(t)})}),i.processData=function(e,t){_.forEach(a,function(i){var a={service:n,item:e,data:t};if(o.fire(a),a.ignore||(i.instance.process.call(n,e,t),r.fire(a)),a.stop)return!1})}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataValidationSvc",[function(){return function(e,t){t.validators=[],e.checkValidations=function(n){var i,a={},o=[];return t.validating=!0,n=n||t.currentItem,_.forEach(n,function(i,r){_.forEach(t.validators,function(t){var s=t.validate.call(e,n,r,i);t.isAsync?o.push(s.then(function(e){return a[r].result=e,e})):a[r].result=s})}),o&&o.length?o.all(function(){i.resolve(a),t.validating=!1}):(i.resolve(a),t.validating=!1),i}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswButton",["$timeout","platformWordCountSvc",function(e,t){return{restrict:"AE",require:"ngModel",templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-text.html",link:function(n,i,a,o){n.size=a.size||"size-md";var r=function(){return $(i.find(".form-control")[0])},s=function(){var e=r();return e?(n.inputCount=t.count(e.val()||o.$viewValue),void(n.maxCount=a.nswMaxLength)):void(n.inputCount=t.count(o.$viewValue||""))},l=function(){o.$error.hasOwnProperty("nswmaxlength")&&e(function(){s()})};o.$render=function(){n.model=o.$viewValue,s()},n.valueChanged=function(){o.$setViewValue(n.model),l()},n.clearValue=function(){n.model="",o.$setViewValue(null),l()},n.$evalAsync(function(){i.on("keyup",l),s()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswCheckboxBox",[function(){return{restrict:"AE",scope:{label:"@",nswChecked:"="},require:"?ngModel",templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-checkbox-box.html",link:function(e,t,n,i){i?i.$render=function(){e.model=!!i.$viewValue}:e.$watch("nswChecked",function(t){e.model=t}),e.valueChanged=function(){i&&(e.model=!e.model,i.$setViewValue(e.model))},e.getStateClass=function(){return e.model&&"checked"}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswCheckbox",[function(){return{restrict:"AE",scope:{label:"@",nswChecked:"="},require:"?ngModel",templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-checkbox.html",link:function(e,t,n,i){i?i.$render=function(){e.model=!!i.$viewValue}:e.$watch("nswChecked",function(t){e.model=t}),e.valueChanged=function(){i&&(e.model=!e.model,i.$setViewValue(e.model))},e.getStateClass=function(){return e.model&&"checked"}}}}])}(angular),function(angular){"use strict";angular.module("platform").directive("nswFormValidateTip",["$translate",function($translate){return{restrict:"A",scope:{settings:"="},templateUrl:globals.basAppRoute+"/components/nsw-form/templates/nsw-form-validate-tip.html",link:function(scope){scope.errors={};var isModelValid=function(){return scope.settings&&scope.settings.ngModel},formatTranslateKey=function(e){return e.replace(/([a-z]*)([A-Z])([a-z]*)/g,function(e,t,n,i){return t+"-"+_.lowerCase(n)+i})},translateValidations=function(e){if(isModelValid()){var t=_.map(e,function(e,t){return t});return $translate(t)}},isDefinedAttr=function(e){var t=scope.settings.element;return!_.isUndefined(t.attr(e))},translateTip=function(e,t){t=t||"";var n=scope.settings.element;return t.replace(/(%[^%]+%)/gi,function(e,t){t=t.replace(/%/gi,""),t=formatTranslateKey(t);var i="nsw-"+t,a="data-"+t,o="data-nsw-"+t;return"label"===t?scope.settings.label:isDefinedAttr(t)?n.attr(t):isDefinedAttr(i)?n.attr(i):isDefinedAttr(a)?n.attr(a):isDefinedAttr(o)?n.attr(o):void console.warn("platformNswFormValidateTip:validation error code ["+t+"] not found!")})},translateExp=function translateExp(error){return error.replace(/#\{([^}]+)}/g,function(src,$0){var translated=translateTip($0,function(e){return e=e.replace(/(%[^%]+%)/gi,""),"'"+e+"'"});return eval(translated)})},updateErrorTips=function(){if(isModelValid()){var e=scope.settings.ngModel.$error;scope.errors={},translateValidations(e).then(function(t){_.forEach(t,function(t,n){var i=translateExp(t);i=translateTip(n,i),scope.errors[n]={name:n,tip:i,invalid:e[n]}})})}},watcher=scope.$watchCollection(function(){if(isModelValid()){var e=scope.settings.ngModel.$error;return _.map(e,function(e){return e})}},function(e){e&&updateErrorTips()});updateErrorTips(),scope.$on("$destroy",function(){watcher()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswInlineButton",[function(){}])}(angular),function(e){"use strict";e.module("platform").directive("nswLookup",["$timeout",function(t){return{restrict:"AE",require:"ngModel",scope:{items:"=",afterSelect:"&",dir:"@",filter:"&"},templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-lookup.html",controller:["$scope",function(t){var n=this,i=[];n.isFiltered=!1,n.isOpen=t.isOpen,t.execOutterFitler=function(e){return e=e||t.currentItems,_.forEach(i,function(t){e=_.filter(e,t)}),e},t.registerFitler=function(e){i.push(e)},t.select=function(n){if(n.id!==-9999){var i=_.get(t.getSource(n),t.value);e.isDefined(i)&&(t.viewValue(i),t.setSelected(n)),t.afterSelect({value:i,item:t.getSource(n)})}},t.execFilter=function(e){e=e||t.currentItems,e=t.execOutterFitler(e),t.displayItems=_.filter(e,function(e){e=t.getSource(e);var n=_.get(e,t.display);return!t.displayText||n.indexOf(t.displayText)>=0}),n.isFiltered=!0},t.filterSelect=function(){t.execFilter(),t.showSelectWidge(!0)},t.getFocusedStyle=function(e){return t.focusedItem===t.getSource(e)&&"focused"},n.focusIndex=function(e){return _.isUndefined(e)?e=t.focusedItem?_.findIndex(t.displayItems,t.focusedItem):0:(e<0?e=0:e>=t.displayItems.length&&(e=t.displayItems.length-1),t.focusedItem=t.getSource(t.displayItems[e])),e},t.focusNextListItem=function(){var e=n.focusIndex();n.focusIndex(e+1)},t.focusPreviousListItem=function(){var e=n.focusIndex();n.focusIndex(e-1)},n.formatDisplayItems=function(e,i){_.isFunction(n.listFormatter)&&(e=n.listFormatter(e)),t.currentItems=e,i&&i.length&&n.isFiltered?t.execFilter(e):(e=t.execOutterFitler(e),t.displayItems=e),t.displayItems=t.displayItems||[],t.displayItems.length||t.displayItems.push({name:"【无】",id:-9999});var a={};a[t.value]=t.viewValue();var o=_.map(e,t.getSource);t.setSelected(_.find(o,a))},t.getSource=function(e){return e},n.override=function(e,n){t[e]=n},n.getScope=function(){return t},t.$watchCollection("items",n.formatDisplayItems),n.listFormatter=e.noop(),n.execFilter=t.execFilter,n.select=t.select,n.registerFitler=t.registerFitler}],link:function(n,i,a,o){n.size=a.size||"size-md",n.display=a.nswDisplay||"name",n.value=a.nswValue||"_id",n.isOpen=function(){return"none"!==i.find("ul.nsw-dropdown-menu.dropdown-menu").css("display")},n.viewValue=function(t){return e.isDefined(t)?void o.$setViewValue(t):o.$viewValue},n.setSelected=function(e){e=e||{},n.selected=e,e.id===-9999?n.displayText=e.name:(e=n.getSource(e),n.displayText=_.get(e,n.display),n.focusedItem=e)},a.filter&&n.registerFitler(function(e,t){return n.filter({item:e,index:t})}),o.$render=function(){var e=o.$viewValue,t={};if(e){_.set(t,n.value,_.isObject(e)?e[n.value]:e);var i=n.getSource(_.find(n.currentItems,t));i&&i.id===-9999?n.displayText=i.name:(n.selected=i,n.displayText=_.get(i,n.display))}},n.render=function(){o.$render()},n.clearValue=function(e){n.setSelected(null),o.$setViewValue(null),n.displayText="",n.focusedItem=null,n.execFilter(),e&&e.stopPropagation()},i.find("input,.nsw-dropdown").on("click",function(e){n.showSelectWidge(!r),e.stopPropagation()}),i.on("keydown",function(e){if(!n.isOpen())return void n.showSelectWidge(!0);switch(e.which){case 40:n.focusNextListItem(),e.stopPropagation();break;case 38:n.focusPreviousListItem(),e.stopPropagation();break;case 13:n.select(n.focusedItem),n.showSelectWidge(),e.stopPropagation()}n.$apply()}),$("body").on("click",function(){$(".dropdown.open").length&&setTimeout(function(){n.$apply()},500)});var r=!1;n.showSelectWidge=function(e,t){"up"===n.dir&&i.find(".dropmenu").css("position","inherit"),(e&&!r||_.isUndefined(e)&&!r)&&i.find(".nsw-dropdown-menu").dropdown("toggle"),t&&(n.displayItems=n.execFilter(n.currentItems))},n.$evalAsync(function(){i.find(".dropmenu").on("shown.bs.dropdown",function(){t(function(){r=!0})}),i.find(".dropmenu").on("hidden.bs.dropdown",function(){t(function(){r=!1})})}),n.$watch(function(){return n.isOpen()},function(e){e||n.setSelected(n.selected)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswLookupTree",[function(){return{restrict:"AE",require:"nswLookup",link:function(e,t,n,i){e.display=n.nswDisplay||"name",e.value=n.nswValue||"_id",e.nswChildren=n.nswChildren||"children";var a="　　　　　　　　　　　　　　　　　　";i.listFormatter=function r(t,n,i,o){return t=_.isArray(t)?t:[t||{}],i=i||0,n=n||[],_.forEach(t,function(t){var s={};s[e.value]=t[e.value],s[e.display]=t[e.display],s.spaces=new Array(i),s._source=t,s.parent=o,n.push(s),t[e.nswChildren]?(s[e.display]=s[e.display]?a.slice(0,i)+"└ "+s[e.display]:"",r(t[e.nswChildren],n,i+1,s)):s[e.display]=s[e.display]?a.slice(0,i)+"├ "+s[e.display]:""}),n},i.override("getSource",function(e){return(e||{})._source||e});var o=function(e,t){t=t||[],e.parent&&(t.push(e.parent._source),o(e.parent,t))};i.override("execFilter",function(t){var n=i.getScope(),a=[];t=t||n.currentItems,t=n.execOutterFitler(t);var r=_.filter(t,function(t){var i=n.getSource(t),r=_.get(i,e.display),s=!n.displayText||r.indexOf(n.displayText)>=0;return s&&o(t,a),s});n.displayItems=_.filter(t,function(t){var n={};return n[e.value]=t[e.value],_.find(a,n)||_.find(r,n)}),i.isFiltered=!0})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswRadioBox",[function(){return{restrict:"AE",scope:{label:"@"},require:["ngModel","?ngValue"],templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-radio-box.html",link:function(e,t,n,i){var a=i[0];e.$parent.$watch(n.ngValue,function(t){e.value=t}),a.$render=function(){e.model=a.$viewValue},e.useValue=function(){e.model=e.value,_.isUndefined(e.model)||a.$setViewValue(e.model)},e.getStateClass=function(){return a.$viewValue===e.value&&"checked"}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswRadio",[function(){return{restrict:"AE",scope:{label:"@"},require:["ngModel","?ngValue"],templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-radio.html",link:function(e,t,n,i){var a=i[0];e.$parent.$watch(n.ngValue,function(t){e.value=t}),a.$render=function(){e.model=a.$viewValue},e.useValue=function(){e.model=e.value,_.isUndefined(e.model)||a.$setViewValue(e.model)},e.getStateClass=function(){return a.$viewValue===e.value&&"checked"}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTextShort",[function(){return{restrict:"AE",require:"ngModel",replace:!0,scope:{size:"@",shortTitle:"@"},transclude:!0,templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-text-short.html",link:function(e,t,n,i){e.options={},e.options.size=e.size||"size-sm",e.maxCount=n.nswMaxLength,e.setViewValue=function(){i.$setViewValue(e.options.shortModel)},i.$render=function(){e.options.shortModel=i.$viewValue,e.hasShortTitle=!!i.$viewValue};var a=function(){e.hasShortTitle&&$(t).off("click",a),e.hasShortTitle||(e.hasShortTitle=!0,e.$apply(),$(t).off("click",a))};$(t).on("click",a)}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTextSuffix",["$timeout","platformWordCountSvc",function(e,t){return{restrict:"AE",require:"ngModel",templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-text-suffix.html",link:function(n,i,a,o){n.size=a.size||"size-md",n.maxCount=a.nswMaxLength,n.isOverCount=!1;var r=function(){n.inputCount=t.count(o.$viewValue||""),n.isOverCount=n.inputCount>n.maxCount},s=function(){o.$error.hasOwnProperty("nswmaxlength")&&e(function(){r()})};o.$render=function(){n.model=o.$viewValue,r()},n.valueChanged=function(){o.$setViewValue(n.model),s()},n.clearValue=function(){n.model="",o.$setViewValue(null),s()},n.$evalAsync(function(){i.on("keyup",s),r()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswText",["$timeout","platformWordCountSvc",function(e,t){return{restrict:"AE",require:"ngModel",scope:{inputBlurFun:"&",hasCounter:"@"},templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-text.html",link:function(n,i,a,o){n.hasWordCounter="false"!==n.hasCounter,n.hideClearBtn=a.$attr.hideClearBtn,n.size=a.size||"size-md",n.placeholder=a.placeholder||"",n.isOverCount=!1,n.maxCount=a.nswMaxLength;var r=function(){return $(i.find(".form-control")[0])},s=function(){var e=r();return e?(n.inputCount=t.count(e.val()||o.$viewValue),void(n.isOverCount=n.inputCount>n.maxCount)):void(n.inputCount=t.count(o.$viewValue||""))},l=function(){e(function(){s()})},c=function(){_.isUndefined(a.readonly)||r().attr("readonly",!0)};o.$render=function(){n.model=o.$viewValue,s(),n.$root&&(n.$$phase||n.$root.$$phase)||n.$apply()},n.valueChanged=function(){o.$setViewValue(n.model),l()},n.clearValue=function(){n.model="",o.$setViewValue(null),l()},a.$observe("readonly",function(){c()}),c(),n.$evalAsync(function(){i.on("keyup",l),s()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTextarea",["$timeout","platformWordCountSvc",function(e,t){return{restrict:"AE",require:"ngModel",scope:{rows:"@"},templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-textarea.html",link:function(n,i,a,o){n.size=a.size||"size-md",n.maxCount=a.nswMaxLength,n.isOverCount=!1,n.placeholder=a.placeholder||"";var r=function(){n.inputCount=t.count(o.$viewValue||"");var e=i.find(".input-counter"),a=(e.width()+3)*-1,r=-70;a=_.min([r,a]),e.css("right",a),n.isOverCount=n.inputCount>n.maxCount},s=function(){e(function(){r()})};o.$render=function(){n.model=o.$viewValue,r()},n.valueChanged=function(){o.$setViewValue(n.model),s()},n.$evalAsync(function(){i.on("keyup",s),r()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTimePicker",[function(){return{restrict:"A",require:"ngModel",templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-time-picker.html",scope:{options:"="},link:function(t,n,i,a){var o;t.showDelete="false"!==i.showDelete,t.backData={},t.size=i.size||"size-sm";var r=function(){var r={locale:{format:i.format||"YYYY-MM-DD HH:mm",language:"zh-CN",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十月","十二月"],applyLabel:"确认",cancelLabel:"取消"},singleDatePicker:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,showDelete:t.showDelete};t.options&&t.options.showDelete&&(t.showDelete=t.options.showDelete);var s=e.extend({},r,t.options);if(t.$eval(i.currentTime)){var l=moment(a.$viewValue),c=moment();l.isAfter(c)&&(s.minDate=c.format(s.locale.format))}t.options&&t.options.locale&&(s.locale=e.extend({},r.locale,t.options.locale)),n.find(".glyphicon-calendar").click(function(){o.click()}),o=n.find("input").daterangepicker(s,function(e){a.$setViewValue(moment(e).format(s.locale.format)),t.$apply()}),o.val(a.$viewValue)},s=function(){n.find("input").val("")};t.deleteTime=function(){t.backData.start="",s()},a.$render=function(){var e=a.$viewValue;e?r():s(),o&&o.val(e)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTplSelector",[function(){return{restrict:"AE",require:"ngModel",scope:{tempList:"=",type:"@",selected:"&",formName:"="},templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-tpl-selector.html",link:function(e,t,n,i){e.options={},e.selectedItems={};var a,o;e.selectPageTpl=function(t){_.map(e.selectedItems,function(e,t,n){n[t]=!1}),e.selectedItems[t._id]=!0,t&&t._id&&(_.find(o,{type:t.type})?a.id=t._id:(a={id:t._id,type:t.type},o.push(a))),i.$setViewValue(o),e.formName.$setDirty(),e.selected()};var r=function(t){e.options.tempList&&(_.find(e.options.tempList,{_id:t})?e.selectedItems[t]=!0:(e.selectPageTpl(e.options.tempList[0]),e.formName.$setDirty()))};i.$render=function(){o=i.$viewValue||[],_.map(e.selectedItems,function(e,t,n){n[t]=!1}),o&&o.length>2&&(o=[]),o&&o.length?(_.forEach(o,function(t,n){t.type===e.type&&(a=o[n])}),a&&a.id?r(a.id):r()):r()};var s=e.$watch("tempList",function(t){e.options.tempList=t||[],_.isArray(t)&&i.$viewValue&&i.$render()});e.$on("$destroy",function(){s()})}}}])}(angular),function(e){"use strict";function t(e,t,n){this.$http=e,this.$q=t,this.loadTemplate=function(i){var a=t.defer(),o=n.get(i);return o?a.resolve(o):e.get(globals.basAppRoute+i).then(function(e){a.resolve(e.data),n.put(i,e.data)}),a.promise},this.loadTemplates=function(e){var n=[],i=this;return _.forEach(e,function(e){n.push(i.loadTemplate(e))}),t.all(n)}}t.$inject=["$http","$q","$templateCache"],e.module("platform").service("nswTabCacheSvc",t)}(angular),function(e){"use strict";e.module("platform").directive("nswTab",["$compile","$http","$controller","nswTabCacheSvc",function(t,n,i,a){return{restrict:"A",transclude:!0,scope:{templateController:"@nswController",templateUrl:"@templateUrl",title:"@",active:"=",order:"@",enableRemove:"@",required:"@nswRequired",nswTab:"@",onSelect:"&select",onRemove:"&remove"},require:"^?nswTabset",template:'<div class="nsw-tab"  ng-show="tab.active" ng-transclude=""></div>',link:function(n,o,r,s){n.tab={ifShow:!0};var l,c=function(){n.templateUrl=n.templateUrl||s.getTabInfo(n.nswTab).templateUrl,n.active=n.active||s.getTabInfo(n.nswTab).active,n.templateController=n.templateController||s.getTabInfo(n.nswTab).controller};if(s){var u=s.getParent(),d={},p=!1,m=e.noop,f=e.noop,g=e.noop,h=function(){n.tab={title:n.title||s.getTabInfo(n.nswTab).title,defaultTitle:n.title||s.getTabInfo(n.nswTab).title,required:"true"===n.required,order:Number(n.order)||s.count(),name:n.nswTab,active:!1,isShow:!0,ifShow:!0,enableRemove:"true"===n.enableRemove},s.addTab(n.tab),s.isPerLoad()&&l()};l=function(){c(),!p&&n.templateUrl&&(p=!0,u=u.$new(),n.templateController&&(d.$scope=u,d.$tab=n.tab,i(n.templateController,d)),a.loadTemplate(n.templateUrl).then(function(e){e="<div>"+e+"</div>";var n=$(e);t(n)(u),$(".nsw-tab",o).children().remove(),$(".nsw-tab",o).append(n)}))},n.$on("tabSelected",function(e,t){t===n.tab&&(l(),n.onSelect({tab:t}))}),n.$on("tabRemoved",function(e,t){t===n.tab&&(n.onRemove({tab:t}),$(".nsw-tab",o).children().remove())}),n.getTabInfo=s.getTabInfo,h(),r.$observe("title",function(){!s.getTabInfo(n.nswTab).title&&n.title&&(n.tab.title=n.title)}),r.$observe("required",function(){n.tab.required="true"===n.required});var v=n.$watch(function(){return s.getTabInfo(n.nswTab).title},function(e){e&&(n.tab.title=n.title=e)});r.ngIf&&(g=s.getParent().$watch(r.ngIf,function(e){n.tab.ifShow=e,e?l():(s.removeTab(n.tab,!0),$(".nsw-tab",o).children().remove(),n.templateController&&u.$destroy())})),r.ngShow&&(m=s.getParent().$watch(r.ngShow,function(e){n.tab.isShow=e})),r.ngHide&&(f=s.getParent().$watch(r.ngHide,function(e){n.tab.isShow=!e})),n.$watch("active",function(e){e&&s.selectTab(n.tab)}),n.$on("$destroy",function(){m(),f(),g(),v(),s.removeDestoriedTab(n.tab),$(".nsw-tab",o).children().remove(),n.templateController&&u.$destroy()})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswTabset",["$timeout",function(t){return{restrict:"A",scope:{onSelect:"&select",onInit:"&",perLoad:"@",options:"=",async:"="
},transclude:!0,templateUrl:globals.basAppRoute+"components/nsw-form/templates/nsw-tabset-dir.html",link:function(n,i,a,o,r){var s=.9;n.isOverflow=!1;var l=null,c={load:!1,watcher:null,isAsync:e.isDefined(a.async)},u=function(){return _.sum(_.map($("ul.nav>li",i),function(e){return $(e).width()}))},d=function(e){var t=$("ul.nav",i).width();n.isOverflow=t<e,n.isOverflow?$(".tab-nav-container",i).width($(".tab-nav-header",i).width()-100):(n.goFirst(),$(".tab-nav-container",i).width($(".tab-nav-header",i).width()))};l=n.$watch(function(){return u()},function(e){d(e),c.isAsync&&c.load&&d(e)}),c.isAsync&&(c.watcher=n.$watch("async",function(e){e&&(c.load=!0,d(u()))})),n.goLast=function(){t(function(){var e=u();$(".tab-nav-container").scrollLeft(e),n.isLast=!0,n.isFirst=!1})},n.goFirst=function(){$(".tab-nav-container").scrollLeft(0),n.isFirst=!0,n.isLast=!1},n.goNext=function(){var e=$("ul.nav").width(),t=u(),i=$(".tab-nav-container").scrollLeft(),a=i+e*s;a<t?($(".tab-nav-container").animate({scrollLeft:a},"slow"),n.isFirst=!1):n.goLast()},n.goPrev=function(){var e=$("ul.nav").width(),t=$(".tab-nav-container").scrollLeft(),i=t-e*s;i>0?($(".tab-nav-container").animate({scrollLeft:i},"slow"),n.isLast=!1):n.goFirst()},$("[tab-footer],[data-tab-footer]",i).hide(),n.$evalAsync(function(){r(n.$parent,function(e){var t=$("[tab-header],[data-tab-header]",e),n=$("[tab-body],[data-tab-body]",e),a=$("[tab-footer],[data-tab-footer]",e);t.length||a.length||n.length||(n=i.children());var o=$('<div class="nsw-tab-views-header"></div><div class="nsw-tab-views"></div><div class="nsw-tab-views-footer"></div>');$(".nsw-tab-views-header",o).append(t),$(".nsw-tab-views",o).append(n),$(".nsw-tab-views-footer",o).append(a),setTimeout(function(){$("[tab-footer],[data-tab-footer]",i).show()},500),i.append(o)}),$(".tab-nav-container",i).width($(".tab-nav-header",i).width())}),n.$on("$destroy",function(){c.isAsync&&c.watcher(),l()})},controller:["$scope","platformModalSvc",function(e,t){e.tabs=[];var n=this;n.getTabInfo=function(t){return e.options=e.options||{},e.options[t]||{}},n.count=function(){return e.tabs.length},n.addTab=function(t){if(t.name=t.name||"tab_"+e.tabs.length,!_.find(e.tabs,{name:t.name}))return t.isShow=!0,e.tabs.push(t),e.tabs=_.sortBy(e.tabs,"order"),1===e.tabs.length&&n.selectTab(t),e.goLast&&e.goLast(),t},n.removeDestoriedTab=function(t){var i=_.findIndex(e.tabs,t);i!==-1&&(_.remove(e.tabs,t),t.active&&(e.tabs[i]?n.selectTab(e.tabs[i]):n.selectTab(e.tabs[i-1])))},e.removeTab=n.removeTab=function(i,a){a?(e.$root.$broadcast("tabRemoved",i),n.removeDestoriedTab(i)):t.showConfirmMessage("确认删除？","提示").then(function(){e.$root.$broadcast("tabRemoved",i),n.removeDestoriedTab(i)})},n.getParent=function(){return e.$parent},n.selectTab=e.selectTab=function(t){_.forEach(e.tabs,function(e){e.active=e===t}),e.onSelect({tab:t}),e.$root.$broadcast("tabSelected",t)},n.isPerLoad=function(){return"true"===e.perLoad},e.tabStateClass=function(e){return e.active?"active":e.disabled?"disabled":void 0},e.onInit({tabset:n})}]}}])}(angular);